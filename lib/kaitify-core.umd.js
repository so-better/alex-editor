!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["kaitify-core"]={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,i)=>((e,n,i)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i)(e,"symbol"!=typeof n?n+"":n,i);const i={formatNumber(e){return this.isNumber(e)?e.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):e},isNumber:e=>"number"==typeof e&&!isNaN(e),add:(...e)=>e.reduce(((e,t)=>{let n=0,i=0,o=0;try{n=e.toString().split(".")[1].length}catch(r){}try{i=t.toString().split(".")[1].length}catch(r){}return o=Math.pow(10,Math.max(n,i)),(e*o+t*o)/o})),subtract:(...e)=>e.reduce(((e,t)=>{let n=0,i=0,o=0;try{n=e.toString().split(".")[1].length}catch(r){}try{i=t.toString().split(".")[1].length}catch(r){}return o=Math.pow(10,Math.max(n,i)),(e*o-t*o)/o})),mutiply:(...e)=>e.reduce(((e,t)=>{let n=0,i=e.toString(),o=t.toString();try{n+=i.split(".")[1].length}catch(r){}try{n+=o.split(".")[1].length}catch(r){}return Number(i.replace(".",""))*Number(o.replace(".",""))/Math.pow(10,n)})),divide:(...e)=>e.reduce(((e,t)=>{let n=0,i=0,o=e.toString(),r=t.toString();try{n=o.split(".")[1].length}catch(s){}try{i=r.split(".")[1].length}catch(s){}return Number(o.replace(".",""))/Number(r.replace(".",""))*Math.pow(10,i-n)}))},o={insert(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if("string"!=typeof t)throw new TypeError("The second argument must be a string");if(!i.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,n)+t+e.substring(n,e.length)},delete(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!i.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!i.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,t)+e.substring(t+n,e.length)},replace(e,t,n,o){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!i.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!i.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");if("string"!=typeof o)throw new TypeError("The fourth argument must be a string");return e.substring(0,t)+o+e.substring(n,e.length)},trim(e,t){if("string"!=typeof e)throw new TypeError("The first argument must be a string");let n=e.replace(/(^\s+)|(\s+$)/g,"");return t&&(n=n.replace(/\s/g,"")),n}},r={isWindow:e=>e&&e instanceof Window,getElementPoint(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(this.isElement(t)||(t=document.body),!this.isContains(t,e))throw new Error("The second argument and the first argument have no hierarchical relationship");let n=e,i=0,o=0;for(;this.isElement(e)&&this.isContains(t,e)&&t!==e;)i+=e.offsetTop,o+=e.offsetLeft,e=e.offsetParent;return{top:i,left:o,right:t.offsetWidth-o-n.offsetWidth,bottom:t.offsetHeight-i-n.offsetHeight}},isContains(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e===t||(e.contains?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t)))},isParentNode(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e!==t&&t.parentNode===e},children(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");return[...e.querySelectorAll(t||"*")].filter((t=>t.parentNode===e))},siblings(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!e.parentNode)return[];return[...e.parentNode.querySelectorAll(t||"*")].filter((t=>t.parentNode===e.parentNode&&t!=e))},rem2px(e){if(!i.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return i.mutiply(e,parseFloat(t))},px2rem(e){if(!i.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return i.divide(e,parseFloat(t))},width(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientWidth,n=parseFloat(this.getCssStyle(e,"padding-left")),o=parseFloat(this.getCssStyle(e,"padding-right"));return i.subtract(t,n,o)},height(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientHeight,n=parseFloat(this.getCssStyle(e,"padding-top")),o=parseFloat(this.getCssStyle(e,"padding-bottom"));return i.subtract(t,n,o)},removeClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;o.trim(t).split(/\s+/).forEach((e=>{n.remove(e)}))},addClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;o.trim(t).split(/\s+/).forEach((e=>{n.add(e)}))},hasClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;return o.trim(t).split(/\s+/).every((e=>n.contains(e)))},scrollTopBottomTrigger(e,t){"string"==typeof e&&e&&(e=document.body.querySelector(e));let n=window;this.isElement(e)&&e!=document.body&&e!=document.documentElement&&(n=e),"function"==typeof e&&(t=e);let o=!0;n.addEventListener("scroll",(()=>{if(this.getScrollTop(n)<=0){if(!o)return;"function"==typeof t&&(o=!1,t({state:"top",target:n}))}else{let e={state:"bottom",target:n},r=0;if(r=n==window?window.innerHeight:n.clientHeight,i.add(this.getScrollTop(n),r)+1>=this.getScrollHeight(n)&&r!=this.getScrollHeight(n)){if(!o)return;"function"==typeof t&&(o=!1,t(e))}else o=!0}}))},getScrollWidth(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth,t},getScrollHeight(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight,t},setScrollTop(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let o=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise((e=>{if(r<=0)t?document.documentElement.scrollTop=document.body.scrollTop=o:n.scrollTop=o,e();else{let s=10,a=i.divide(r,s),l=this.getScrollTop(n),c=i.divide(i.subtract(o,l),a),d=setInterval((()=>{a>0?(a--,t?document.documentElement.scrollTop=document.body.scrollTop=l=i.add(l,c):n.scrollTop=l=i.add(l,c)):(clearInterval(d),e())}),s)}}))},getScrollTop(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,t},getScrollLeft(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,t},setScrollLeft(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let o=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise((e=>{if(r<=0)t?document.documentElement.scrollLeft=document.body.scrollLeft=o:n.scrollLeft=o,e();else{let s=10,a=i.divide(r,s),l=this.getScrollLeft(n),c=i.divide(i.subtract(o,l),a),d=setInterval((()=>{a>0?(a--,t?document.documentElement.scrollLeft=document.body.scrollLeft=l=i.add(l,c):n.scrollLeft=l=i.add(l,c)):(clearInterval(d),e())}),s)}}))},getCssStyle(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n="";return n=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e)[t]:e.currentStyle[t],n},getCssSelector(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a selector string");if(/^#{1}/.test(e))return{type:"id",value:e.substr(1)};if(/^\./.test(e))return{type:"class",value:e.substr(1)};if(/^\[(.+)\]$/.test(e)){let t="attribute",n="",i=o.trim(e,!0).substring(1,o.trim(e,!0).length-1).split("=");return 1==i.length&&(n=i[0]),2==i.length&&(n={attributeName:i[0],attributeValue:i[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:t,value:n}}return{type:"tag",value:e}},getElementBounding(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.getBoundingClientRect();return{top:t.top,bottom:i.subtract(document.documentElement.clientHeight||window.innerHeight,t.bottom),left:t.left,right:i.subtract(document.documentElement.clientWidth||window.innerWidth,t.right)}},isElement:e=>e&&e instanceof Node&&1===e.nodeType,string2dom(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be an HTML string");const t=document.createElement("template");return t.innerHTML=e,1==t.content.children.length?t.content.children[0]:Array.from(t.content.children)}},s="_dap-datas",a={remove(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[s]||{};null==t||""===t?e[s]={}:(delete n[t],e[s]=n)},has(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");return(e[s]||{}).hasOwnProperty(t)},get(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[s]||{};return null==t||""===t?n:n[t]},set(e,t,n){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");let i=e[s]||{};i[t]=n,e[s]=i}},l={matchingText(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=null;if("Chinese"==t&&(n=/^[\u4e00-\u9fa5]+$/),"chinese"==t&&(n=/[\u4e00-\u9fa5]/),"email"==t&&(n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/),"username"==t&&(n=/^[a-zA-Z0-9_]{4,16}$/),"int+"==t&&(n=/^\d+$/),"int-"==t&&(n=/^-\d+$/),"int"==t&&(n=/^-?\d+$/),"pos"==t&&(n=/^\d*\.?\d+$/),"neg"==t&&(n=/^-\d*\.?\d+$/),"number"==t&&(n=/^-?\d*\.?\d+$/),"phone"==t&&(n=/^1[0-9]\d{9}$/),"idCard"==t&&(n=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/),"url"==t&&(n=/^(https?|ftp):\/\/(-\.)?([^\s\/?\.#-]+\.?)+(\/[^\s]*)?$/),"IPv4"==t&&(n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),"hex"==t&&(n=/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/),"rgb"==t&&(n=/^rgb\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\)$/),"rgba"==t&&(n=/^rgba\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(0?\.\d|1(\.0)?|0)\)$/),"QQ"==t&&(n=/^[1-9][0-9]{4,10}$/),"weixin"==t&&(n=/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/),"plate"==t&&(n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/),!n)throw new Error("The second parameter is out of scope");return n.test(e)},getUrlParams(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1);if(!n){let e=window.location.hash.split("?");2==e.length&&(n=e[1])}let i=n.match(t);return i?decodeURIComponent(i[2]):null},isEmptyObject(e){return!!this.isObject(e)&&0==Object.keys(e).length},equal(e,t){if(typeof e!=typeof t)return!1;if(this.isObject(e)&&this.isObject(t)){let n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(n.length!=i.length)return!1;let o=n.length,r=!0;for(let s=0;s<o;s++){let i=n[s],o=e[i],a=t[i];if(!this.equal(o,a)){r=!1;break}}return r}return e===t},isObject:e=>!("object"!=typeof e||!e),copyText(e){if(!e||"string"!=typeof e)throw new TypeError("No text to copy is defined");if(!navigator.clipboard)throw new Error("navigator.clipboard must be obtained in a secure environment, such as localhost, 127.0.0.1, or https, so the method won't work");return navigator.clipboard.writeText(e)},clone(e){if(this.isObject(e)){if(Array.isArray(e))return e.map((e=>this.clone(e)));let t={};for(let n in e)t[n]=this.clone(e[n]);return t}return e}},c=e=>{let t=e.split(/[\s]+/g),n=[];return t.forEach((e=>{let t=e.split("."),i={eventName:t[0]};t.length>1&&(i.guid=t[1]),n.push(i)})),n},d=(e,t,n)=>{let i=a.get(e,"dap-defined-events")||{},o=Object.keys(i),r=o.length;for(let s=0;s<r;s++){let r=o[s];i[r].type==t&&(n?r==t+"."+n&&(e.removeEventListener(i[r].type,i[r].fn,i[r].options),i[r]=void 0):(e.removeEventListener(i[r].type,i[r].fn,i[r].options),i[r]=void 0))}i=(e=>{let t={};return Object.keys(e).forEach((n=>{e[n]&&(t[n]=e[n])})),t})(i),a.set(e,"dap-defined-events",i)},h={on(e,t,n,i){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!n||"function"!=typeof n)throw new TypeError("The third argument must be a function");l.isObject(i)||(i={});c(t).forEach((t=>{((e,t,n,i,o)=>{let r=a.get(e,"dap-defined-events")||{};n||(n=a.get(e,"dap-event-guid")||0,a.set(e,"dap-event-guid",n+1)),r[n=t+"."+n]&&r[n].type==t&&e.removeEventListener(t,r[n].fn,r[n].options),e.addEventListener(t,i,o),r[n]={type:t,fn:i,options:o},a.set(e,"dap-defined-events",r)})(e,t.eventName,t.guid,n.bind(e),i)}))},off(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=a.get(e,"dap-defined-events");if(!n)return;if(!t){let t=Object.keys(n),i=t.length;for(let o=0;o<i;o++){let i=t[o];e.removeEventListener(n[i].type,n[i].fn,n[i].options)}return a.remove(e,"dap-defined-events"),void a.remove(e,"dap-event-guid")}c(t).forEach((t=>{d(e,t.eventName,t.guid)}))},get(e){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let t=a.get(e,"dap-defined-events");if(t)return t}},u={getImageUrl(e){if(!(e&&e instanceof File))throw new TypeError("The argument must be a File object");return window.URL.createObjectURL(e)},dataFileToBase64:e=>new Promise(((t,n)=>{e&&e instanceof File||n(new TypeError("The argument must be a File object"));let i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>{let e=i.result;t(e)}})),dataBase64toFile(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.split(","),i=n[0].match(/:(.*?);/)[1],o=atob(n[1]),r=o.length,s=new Uint8Array(r);for(;r--;)s[r]=o.charCodeAt(r);return new File([s],t,{type:i})},compressImage(e,t){const n={width:void 0,quality:.8,mimeType:"jpeg",maxSize:0,minSize:0};l.isObject(t)&&(i.isNumber(t.width)&&(n.width=t.width),i.isNumber(t.quality)&&t.quality>=0&&t.quality<=1&&(n.quality=t.quality),"jpeg"!=t.mimeType&&"webp"!=t.mimeType||(n.mimeType=t.mimeType),i.isNumber(t.maxSize)&&(n.maxSize=t.maxSize),i.isNumber(t.minSize)&&(n.minSize=t.minSize));const o=(e,t,i)=>{let r=e.toDataURL("image/"+n.mimeType,i),s=this.dataBase64toFile(r,t);if(n.maxSize>0&&s.size>1024*n.maxSize){i=i<=0?0:Number((i-.01).toFixed(2));const n=o(e,t,i);r=n.url,s=n.file,i=n.quality}return{file:s,url:r,quality:i}};return new Promise(((t,i)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{let s=r.result,a=new Image;a.src=s,a.onload=()=>{if(n.minSize>0&&e.size<=1024*n.minSize)return void t({file:e,url:s,quality:1,width:a.width,height:a.height});let i=document.createElement("canvas"),r=i.getContext("2d");i.width=n.width||a.width,i.height=n.width?n.width/(a.width/a.height):a.height,r.drawImage(a,0,0,i.width,i.height);let l=e.name.lastIndexOf(".");const c=e.name.substring(0,l)+"."+n.mimeType;let d=o(i,c,n.quality);t({...d,width:i.width,height:i.height})},a.onerror=()=>{i(new Error("Failed to load image file"))}},r.onerror=()=>{i(new Error("Failed to load image file"))}}))}},p={language:()=>window.navigator.browserLanguage||window.navigator.language,device(){const e=window.navigator.userAgent;return{PC:!e.match(/AppleWebKit.*Mobile.*/),Mobile:!!e.match(/AppleWebKit.*Mobile.*/),iPhone:e.includes("iPhone"),Phone:e.includes("Android")&&/(?:Mobile)/.test(e)||e.includes("iPhone")||/(?:Windows Phone)/.test(e),iPad:e.includes("iPad"),Tablet:e.includes("iPad")||e.includes("Android")&&!/(?:Mobile)/.test(e)||e.includes("Firefox")&&/(?:Tablet)/.test(e),WindowsPhone:/(?:Windows Phone)/.test(e)}},browser(){const e=window.navigator.userAgent;return{Edge:!!e.match(/Edg\/([\d.]+)/),weixin:e.includes("MicroMessenger"),QQ:e.includes("QQ"),QQBrowser:e.includes("MQQBrowser"),UC:e.includes("UCBrowser"),Chrome:e.includes("Chrome"),Firefox:e.includes("Firefox"),sougou:e.toLocaleLowerCase().includes("se 2.x")||e.toLocaleLowerCase().includes("metasr")||e.toLocaleLowerCase().includes("sogou"),Safari:e.includes("Safari")&&!e.includes("Chrome")}},browserKernel(){const e=window.navigator.userAgent;return e.includes("Presto")?"opera":e.includes("AppleWebKit")?"webkit":e.includes("Gecko")&&!e.includes("KHTML")?"gecko":""},os(){const e=window.navigator.userAgent;return{Windows:e.includes("Windows"),Windows_CPU:e.toLocaleLowerCase().includes("win64")||e.toLocaleLowerCase().includes("wow64")?"x64":e.toLocaleLowerCase().includes("win32")||e.toLocaleLowerCase().includes("wow32")?"x32":"",Windows_Version:e.includes("Windows NT 6.1")||e.includes("Windows 7")?"Win7":e.includes("Windows NT 6.3")||e.includes("Windows NT 6.2")||e.includes("Windows NT 8")?"Win8":e.includes("Windows NT 10")||e.includes("Windows NT 6.4")?"Win10":"",Mac:e.includes("Macintosh"),Mac_Version:function(){if(e.includes("Macintosh")){const t=e.match(/Mac OS X ([^\s]+)\)/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ios_Version:function(){if(e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){const t=e.match(/CPU.+OS ([^\s]+) like Mac OS X/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),Android:e.includes("Android"),Android_Version:function(){const t=e.match(/Android ([^\s]+);/);return t&&t[1]?t[1].split(/_|\./).join("."):""}(),Linux:e.includes("Linux"),HarmonyOS:e.includes("HarmonyOS"),Ubuntu:e.includes("Ubuntu")}}},f="data-kaitify-node",g=(e,t)=>t.isText()?{tag:e.textRenderTag,namespace:t.namespace,attrs:t.hasMarks()?l.clone({...t.marks,[f]:t.key}):{[f]:t.key},styles:t.hasStyles()?l.clone(t.styles):{},textContent:t.textContent}:{tag:t.tag,namespace:t.namespace,attrs:t.hasMarks()?l.clone({...t.marks,[f]:t.key}):{[f]:t.key},styles:t.hasStyles()?l.clone(t.styles):{},children:t.hasChildren()?t.children.map((t=>g(e,t))):[]},m=e=>/^[\uFEFF]+$/g.test(e),y=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),v=(e,t)=>3==t.nodeType?r.isContains(e,t.parentNode):r.isContains(e,t),b=(e=0)=>new Promise((t=>{setTimeout((()=>{t()}),e)}));class x{constructor(){n(this,"key",(()=>{let e=a.get(window,"data-kaitify-knode-key")||0;return e++,a.set(window,"data-kaitify-knode-key",e),e})()),n(this,"type"),n(this,"tag"),n(this,"textContent"),n(this,"marks"),n(this,"styles"),n(this,"locked",!1),n(this,"fixed",!1),n(this,"namespace"),n(this,"children"),n(this,"parent"),n(this,"clone",((e=!0)=>{const t=x.create({type:this.type,tag:this.tag,marks:l.clone(this.marks),styles:l.clone(this.styles),namespace:this.namespace,textContent:this.textContent,locked:this.locked,fixed:this.fixed});return e&&this.hasChildren()&&this.children.forEach((n=>{const i=n.clone(e);t.hasChildren()?t.children.push(i):t.children=[i],i.parent=t})),t})),n(this,"firstTextClosedInNode",(e=>{if(!this.isText()&&!this.isClosed())return!1;if(this.isEqual(e))return!1;if(e.isContains(this)){const t=x.flat(e.children).filter((e=>e.isText()||e.isClosed()));return this.isEqual(t[0])}return!1})),n(this,"getFocusNodes",((e="all")=>{const t=[];return!this.isClosed()||"all"!=e&&"closed"!=e||t.push(this),!this.isText()||"all"!=e&&"text"!=e||t.push(this),this.hasChildren()&&this.children.forEach((n=>{t.push(...n.getFocusNodes(e))})),t}))}isBlock(){return"block"==this.type}isInline(){return"inline"==this.type}isClosed(){return"closed"==this.type}isText(){return"text"==this.type}getBlock(){return this.isBlock()?this:this.parent.getBlock()}getInline(){return this.isInline()?this:this.parent?this.parent.getInline():null}hasChildren(){return!this.isText()&&!this.isClosed()&&(Array.isArray(this.children)&&!!this.children.length)}isEmpty(){return this.isText()?!this.textContent:!(!this.isInline()&&!this.isBlock())&&(!this.hasChildren()||this.children.every((e=>e.isEmpty())))}isZeroWidthText(){return this.isText()&&!this.isEmpty()&&m(this.textContent)}isPlaceholder(){return this.isClosed()&&"br"==this.tag}hasMarks(){return!!this.marks&&(!!l.isObject(this.marks)&&!l.isEmptyObject(this.marks))}hasStyles(){return!!this.styles&&(!!l.isObject(this.styles)&&!l.isEmptyObject(this.styles))}getUneditable(){return this.hasMarks()&&"false"==this.marks.contenteditable?this:this.parent?this.parent.getUneditable():null}allIsPlaceholder(){if(this.hasChildren()){const e=this.children.filter((e=>!e.isEmpty()));return e.length&&e.every((e=>e.isPlaceholder()))}return!1}toEmpty(){if(!this.isEmpty()){if(!this.isText())return this.isClosed()?(this.type="text",void(this.textContent=void 0)):void(this.hasChildren()&&this.children.forEach((e=>{e.toEmpty()})));this.textContent=void 0}}isEqualStyles(e){return!this.hasStyles()&&!e.hasStyles()||!!(this.hasStyles()&&e.hasStyles()&&l.equal(this.styles,e.styles))}isEqualMarks(e){return!this.hasMarks()&&!e.hasMarks()||!!(this.hasMarks()&&e.hasMarks()&&l.equal(this.marks,e.marks))}isInCodeBlockStyle(){const e=this.getBlock();if("pre"==e.tag)return!0;const t=e.hasStyles()&&e.styles.whiteSpace||"";return!!["pre","pre-wrap"].includes(t)||!!e.parent&&e.parent.isInCodeBlockStyle()}isEqual(e){return!!x.isKNode(e)&&this.key==e.key}isContains(e){return!!this.isEqual(e)||!this.isClosed()&&!this.isText()&&(!!e.parent&&this.isContains(e.parent))}fullClone(){const e=x.create({type:this.type,tag:this.tag,marks:l.clone(this.marks),styles:l.clone(this.styles),namespace:this.namespace,textContent:this.textContent,locked:this.locked,fixed:this.fixed});return e.key=this.key,this.hasChildren()&&this.children.forEach((t=>{const n=t.fullClone();e.hasChildren()?e.children.push(n):e.children=[n],n.parent=e})),e}lastTextClosedInNode(e){if(!this.isText()&&!this.isClosed())return!1;if(this.isEqual(e))return!1;if(e.isContains(this)){const t=x.flat(e.children).filter((e=>e.isText()||e.isClosed()));return this.isEqual(t[t.length-1])}return!1}getPrevious(e){const t=e.findIndex((e=>e.isEqual(this)));if(t<=0)return null;const n=e[t-1];return n.isEmpty()?t-1==0?null:n.getPrevious(e):n}getNext(e){const t=e.findIndex((e=>e.isEqual(this)));if(t<0||t==e.length-1)return null;const n=e[t+1];return n.isEmpty()?t+1==e.length-1?null:n.getNext(e):n}isMatch(e){if(e.tag&&(this.isText()||e.tag!=this.tag))return!1;if(e.marks){if(!Object.keys(e.marks).every((t=>!!this.hasMarks()&&(!0===e.marks[t]?this.marks.hasOwnProperty(t):this.marks[t]==e.marks[t]))))return!1}if(e.styles){if(!Object.keys(e.styles).every((t=>!!this.hasStyles()&&(!0===e.styles[t]?this.styles.hasOwnProperty(t):this.styles[t]==e.styles[t]))))return!1}return!0}getMatchNode(e){return this.isMatch(e)?this:this.parent?this.parent.getMatchNode(e):null}static create(e){var t;const n=new x;return n.type=e.type,n.tag=e.tag,n.textContent=e.textContent,n.fixed=e.fixed||!1,n.locked=e.locked||!1,n.marks=l.clone(e.marks),n.styles=l.clone(e.styles),n.namespace=e.namespace,n.children=null==(t=e.children)?void 0:t.map((e=>{const t=x.create(e);return t.parent=n,t})),n}static createZeroWidthText(e){return x.create({type:"text",textContent:"\ufeff",marks:null==e?void 0:e.marks,styles:null==e?void 0:e.styles,namespace:null==e?void 0:e.namespace,locked:null==e?void 0:e.locked})}static createPlaceholder(){return x.create({type:"closed",tag:"br"})}static isKNode(e){return e instanceof x}static flat(e){const t=[],n=e.length;for(let i=0;i<n;i++)if(t.push(e[i]),e[i].hasChildren()){const n=x.flat(e[i].children);t.push(...n)}return t}static searchByKey(e,t){let n=null;const i=t.length;for(let o=0;o<i;o++){const i=t[o];if(i&&i.key==Number(e)){n=i;break}if(i&&i.hasChildren()){const t=x.searchByKey(e,i.children);if(t){n=t;break}}}return n}}const w=[{tag:"p"},{tag:"div"},{tag:"table"},{tag:"ul"},{tag:"ol"},{tag:"h1"},{tag:"h2"},{tag:"h3"},{tag:"h4"},{tag:"h5"},{tag:"h6"},{tag:"blockquote"},{tag:"pre"},{tag:"address",parse:!0},{tag:"article",parse:!0},{tag:"aside",parse:!0},{tag:"nav",parse:!0},{tag:"section",parse:!0},{tag:"li"},{tag:"tfoot",fixed:!0},{tag:"tbody",fixed:!0},{tag:"thead",fixed:!0},{tag:"tr",fixed:!0},{tag:"th",fixed:!0},{tag:"td",fixed:!0},{tag:"colgroup",fixed:!0}],T=[{tag:"span"},{tag:"a"},{tag:"label"},{tag:"code"},{tag:"b"},{tag:"strong"},{tag:"sup"},{tag:"sub"},{tag:"i"},{tag:"u"},{tag:"del"},{tag:"font"}],S=[{tag:"br"},{tag:"col"},{tag:"img"},{tag:"hr"},{tag:"video"},{tag:"audio"}];class k{constructor(){n(this,"start"),n(this,"end")}focused(){return!!this.start&&!!this.end}collapsed(){return!!this.focused()&&(this.start.node.isEqual(this.end.node)&&this.start.offset==this.end.offset)}}class E{constructor(){n(this,"records",[]),n(this,"redoRecords",[])}cloneSelection(e,t){const n=new k;if(t.focused()){const i=x.searchByKey(t.start.node.key,e),o=x.searchByKey(t.end.node.key,e);i&&o&&(n.start={node:i,offset:t.start.offset},n.end={node:o,offset:t.end.offset})}return n}setState(e,t){const n=e.map((e=>e.fullClone())),i=this.cloneSelection(n,t);this.records.push({nodes:n,selection:i}),this.redoRecords=[]}setUndo(){if(this.records.length>1){const e=this.records.pop();this.redoRecords.push(e);const t=this.records[this.records.length-1],n=t.nodes.map((e=>e.fullClone()));return{nodes:n,selection:this.cloneSelection(n,t.selection)}}return null}setRedo(){if(this.redoRecords.length>0){const e=this.redoRecords.pop();this.records.push(e);const t=e.nodes.map((e=>e.fullClone()));return{nodes:t,selection:this.cloneSelection(t,e.selection)}}return null}updateSelection(e){const t=this.records[this.records.length-1],n=this.cloneSelection(t.nodes,e);this.records[this.records.length-1].selection=n}}const N=(e,t)=>{t.hasChildren()&&(t.children.forEach((n=>{n.isClosed()||(n.marks={...n.marks||{},...t.marks||{}},n.styles={...n.styles||{},...t.styles||{}}),e.addNodeBefore(n,t),N(e,n)})),t.children=[])},C=({node:e})=>{if(e.hasChildren()&&!e.isEmpty()){const t=e.children.filter((e=>!e.isEmpty()&&!e.isPlaceholder())),n=t.filter((e=>e.isBlock()));n.length&&(e.isInline()||n.length!=t.length)&&n.forEach((e=>{e.type="inline"}))}},P=({editor:e,node:t})=>{if(!t.isEmpty()&&t.tag&&["b","strong","sup","sub","i","u","del","font"].includes(t.tag)){const n=t.styles||{},i=t.marks||{};switch(t.tag){case"b":case"strong":t.styles={...n,fontWeight:"bold"};break;case"sup":t.styles={...n,verticalAlign:"super"};break;case"sub":t.styles={...n,verticalAlign:"sub"};break;case"i":t.styles={...n,fontStyle:"italic"};break;case"u":t.styles={...n,textDecorationLine:"underline"};break;case"del":t.styles={...n,textDecorationLine:"line-through"};break;case"font":t.styles={...n,fontFamily:i.face||""},delete i.face,t.marks=i}t.tag=e.textRenderTag,N(e,t)}},I=({editor:e,node:t})=>{if(t.hasChildren()){const n=t.children.filter((e=>!e.isEmpty())),i=n.filter((e=>e.isPlaceholder()));t.isInline()&&i.length?i.forEach((e=>{e.toEmpty()})):n.length>1&&i.length==n.length?(e.selection.focused()&&(t.isContains(e.selection.start.node)&&e.setSelectionBefore(i[0],"start"),t.isContains(e.selection.end.node)&&e.setSelectionBefore(i[0],"end")),t.children=[i[0]]):n.length>1&&i.length&&i.forEach((e=>{e.toEmpty()}))}},M=({editor:e,node:t})=>{if(t.isText()&&!t.isEmpty()&&t.textContent.split("").some((e=>m(e)))){let n=t.textContent,i=0;for(;i<n.length;){const r=n.charAt(i);i>0&&m(r)&&m(n.charAt(i-1))?(e.isSelectionInNode(t,"start")&&e.selection.start.offset>=i+1&&(e.selection.start.offset-=1),e.isSelectionInNode(t,"end")&&e.selection.end.offset>=i+1&&(e.selection.end.offset-=1),n=o.delete(n,i,1)):i++}t.textContent=n}},O=({editor:e,node:t})=>{if((t.isBlock()||t.isInline())&&t.hasChildren()&&t.children.length>1){let n=0;for(;t.hasChildren()&&n<=t.children.length-2;){e.getAllowMergeNode(t.children[n],"nextSibling")?(e.applyMergeNode(t.children[n],"nextSibling"),t.hasChildren()&&1==t.children.length&&e.applyMergeNode(t.children[0],"parent")):n++}}},A=({editor:e,node:t})=>{(t.isBlock()||t.isInline())&&t.hasChildren()&&1==t.children.length&&e.getAllowMergeNode(t.children[0],"parent")&&(e.applyMergeNode(t.children[0],"parent"),e.getAllowMergeNode(t,"prevSibling")?e.applyMergeNode(t,"prevSibling"):e.getAllowMergeNode(t,"nextSibling")&&e.applyMergeNode(t,"nextSibling"))},_=(e,t)=>{let n=[];if(e.length&&t.length){let i=0,o=0,r=e.length-1,s=t.length-1;for(;i<=r&&o<=s;){if(t[o])if(t[s])if(e[i].key==t[o].key)n.push(...D(e[i],t[o])),i++,o++;else if(e[r].key==t[s].key)n.push(...D(e[r],t[s])),r--,s--;else if(e[i].key==t[s].key)n.push({type:"move",newNode:e[i],oldNode:t[s]},...D(e[i],t[s])),i++,s--;else if(e[r].key==t[o].key)n.push({type:"move",newNode:e[r],oldNode:t[o]},...D(e[r],t[o])),r--,o++;else{let o=t.findIndex((t=>t&&t.key===e[i].key));o>=0?(n.push({type:"move",newNode:e[i],oldNode:t[o]},...D(e[i],t[o])),t[o]=null):n.push({type:"insert",newNode:e[i],oldNode:null}),i++}else s--;else o++;if(o>s)for(;i<=r;i++)n.push({type:"insert",newNode:e[i],oldNode:null});else if(i>r)for(;o<=s;o++)t[o]&&n.push({type:"remove",oldNode:t[o],newNode:null})}}else e.length?n=e.map((e=>({type:"insert",newNode:e,oldNode:null}))):t.length&&(n=t.map((e=>({type:"remove",oldNode:e,newNode:null}))));return n},D=(e,t)=>{const n=[];return e.isEmpty()||t.isEmpty()?n.push({type:"empty",oldNode:t,newNode:e}):e.type!=t.type||e.locked!=t.locked||e.fixed!=t.fixed?n.push({type:"replace",newNode:e,oldNode:t}):e.isText()||e.tag==t.tag?e.hasChildren()&&!t.hasChildren()||t.hasChildren()&&!e.hasChildren()?n.push({type:"replace",newNode:e,oldNode:t}):(e.isText()&&e.textContent!=t.textContent&&n.push({type:"update",oldNode:t,newNode:e,update:"textContent"}),e.isEqualMarks(t)||n.push({type:"update",newNode:e,oldNode:t,update:"marks"}),e.isEqualStyles(t)||n.push({type:"update",newNode:e,oldNode:t,update:"styles"}),e.hasChildren()&&t.hasChildren()&&n.push(..._(e.children,t.children))):n.push({type:"replace",newNode:e,oldNode:t}),n},R=function(e){e.forEach((e=>{if(!e.isText()){const t={},n={};if(e.hasMarks()&&(e.marks.contenteditable&&(t.contenteditable=e.marks.contenteditable),e.marks.name&&(t.name=e.marks.name),e.marks.disabled&&(t.disabled=e.marks.disabled),"video"==e.tag&&e.marks.autoplay&&(t.autoplay=e.marks.autoplay),"video"==e.tag&&e.marks.loop&&(t.loop=e.marks.loop),"video"==e.tag&&e.marks.muted&&(t.muted=e.marks.muted),"video"==e.tag&&e.marks.controls&&(t.controls=e.marks.controls),"a"==e.tag&&e.marks.href&&(t.href=e.marks.href),"a"==e.tag&&e.marks.target&&(t.target=e.marks.target),"col"==e.tag&&e.marks.width&&(t.width=e.marks.width),["td","th"].includes(e.tag)&&e.marks.colspan&&(t.colspan=e.marks.colspan),["td","th"].includes(e.tag)&&e.marks.rowspan&&(t.rowspan=e.marks.rowspan)),e.hasStyles()&&(e.isBlock()&&e.styles.textIndent&&(n.textIndent=e.styles.textIndent),e.isBlock()&&e.styles.textAlign&&(n.textAlign=e.styles.textAlign),e.isBlock()&&e.styles.lineHeight&&(n.lineHeight=e.styles.lineHeight)),"function"==typeof this.pasteKeepMarks){const n=this.pasteKeepMarks.apply(this,[e]);Object.assign(t,n)}if("function"==typeof this.pasteKeepStyles){const t=this.pasteKeepStyles.apply(this,[e]);Object.assign(n,t)}e.marks=t,e.styles=n,e.hasChildren()&&R.apply(this,[e.children])}}))},z=async function(e){const t=e.getData("text/html"),n=e.getData("text/plain"),i=e.files;if(t&&this.allowPasteHtml){const e=this.htmlParseNode(t).filter((e=>!e.isEmpty()));R.apply(this,[e]);if("function"!=typeof this.onPasteHtml||await this.onPasteHtml.apply(this,[e,t])){this.insertNode(e[0]);for(let t=e.length-1;t>=1;t--)this.addNodeAfter(e[t],e[0]);this.setSelectionAfter(e[e.length-1],"all")}}else if(n){("function"!=typeof this.onPasteText||await this.onPasteText.apply(this,[n]))&&this.insertText(n)}else if(i.length){const e=i.length;for(let t=0;t<e;t++)if(i[t].type.startsWith("image/")){if("function"!=typeof this.onPasteImage||await this.onPasteImage.apply(this,[i[t]])){const e=await u.dataFileToBase64(i[t]),n=x.create({type:"closed",tag:"img",marks:{src:e,alt:i[t].name||""}});this.insertNode(n)}}else if(i[t].type.startsWith("video/")){if("function"!=typeof this.onPasteVideo||await this.onPasteVideo.apply(this,[i[t]])){const e=await u.dataFileToBase64(i[t]),n=x.create({type:"closed",tag:"video",marks:{src:e,alt:i[t].name||""}});this.insertNode(n)}}else"function"==typeof this.onPasteFile&&this.onPasteFile.apply(this,[i[t]])}},B=function(){if(!this.$el)return;if(this.isComposition)return;if(this.internalCauseSelectionChange)return;this.updateSelection()&&(this.history.updateSelection(this.selection),"function"==typeof this.onSelectionUpdate&&this.onSelectionUpdate.apply(this,[this.selection]))},F=async function(e){const t=e;"insertCompositionText"!==t.inputType&&"insertFromComposition"!==t.inputType&&(t.preventDefault(),this.isEditable()&&this.selection.focused()&&("insertText"==t.inputType&&t.data?(this.insertText(t.data),this.updateView()):"deleteContentBackward"==t.inputType||"deleteByCut"==t.inputType||"deleteByDrag"==t.inputType?(this.delete(),this.updateView()):"insertParagraph"==t.inputType||"insertLineBreak"==t.inputType?(this.insertParagraph(),this.updateView()):"insertFromPaste"==t.inputType?t.dataTransfer&&this.allowPaste&&(await z.apply(this,[t.dataTransfer]),this.updateView()):"insertFromDrop"==t.inputType&&(await b(),t.dataTransfer&&this.allowPaste&&(await z.apply(this,[t.dataTransfer]),this.updateView()))))},j=async function(e){const t=e;if(this.isEditable())if("compositionstart"==t.type)this.isComposition=!0;else if("compositionend"==t.type){const e=window.getSelection().getRangeAt(0).endContainer,t=e.parentNode,n=this.findNode(t);if(n.isText()&&n.textContent!=e.textContent){const t=n.textContent||"";n.textContent=e.textContent||"",this.isSelectionInNode(n)&&this.updateSelection(),e.textContent=t,await this.updateView()}else if(!n.isText()){const i=Array.from(t.childNodes).findIndex((t=>t.isEqualNode(e))),o=this.domParseNode(e);n.children.splice(i,0,o),o.parent=n,t.removeChild(e),this.selection.focused()&&this.setSelectionAfter(o,"all"),await this.updateView()}this.isComposition=!1}},L=function(e){var t,n,i,o;if(this.isComposition)return;const r=e;if("keydown"==r.type){if(!this.isEditable())return;!function(e){const{Mac:t}=p.os();return t?"z"==e.key.toLocaleLowerCase()&&e.metaKey&&!e.shiftKey&&!e.altKey&&!e.ctrlKey:"z"==e.key.toLocaleLowerCase()&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey}(r)?function(e){const{Mac:t}=p.os();return t?"z"==e.key.toLocaleLowerCase()&&e.metaKey&&e.shiftKey&&!e.altKey&&!e.ctrlKey:"y"==e.key.toLocaleLowerCase()&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey}(r)&&(r.preventDefault(),null==(o=(i=this.commands).redo)||o.call(i)):(r.preventDefault(),null==(n=(t=this.commands).undo)||n.call(t)),"function"==typeof this.onKeydown&&this.onKeydown.apply(this,[r])}else if("keyup"==r.type){if(!this.isEditable())return;"function"==typeof this.onKeyup&&this.onKeyup.apply(this,[r])}},q=function(e){this.isEditable()&&"function"==typeof this.onFocus&&this.onFocus.apply(this,[e])},K=function(e){this.isEditable()&&"function"==typeof this.onBlur&&this.onBlur.apply(this,[e])},W=async function(e){const t=e;this.allowCopy||t.preventDefault()},$=(e,t)=>{let n=!0;if(3==t.nodeType)if(t.parentNode&&1==t.parentNode.childNodes.length)try{e.findNode(t.parentNode).isText()||(n=!1)}catch(i){n=!1}else n=!1;else if(1==t.nodeType)try{e.findNode(t)}catch(i){n=!1}return n},V=e=>{e.domObserver&&(e.domObserver.disconnect(),e.domObserver=null)},U=e=>{window.MutationObserver||console.warn("The current browser does not support MutationObserver"),V(e),e.domObserver=new MutationObserver((t=>{if(e.isComposition)return;let n=!1;const i=[];for(let o=0;o<t.length;o++){const r=t[o];if("characterData"==r.type){const t=r.target.parentNode,o=e.findNode(t);if(o.isText()&&o.textContent!=r.target.textContent){const t=o.textContent||"";o.textContent=r.target.textContent||"",e.isSelectionInNode(o)&&e.updateSelection(),V(e),r.target.textContent=t,U(e),n=!0}else if(!o.isText()){const s=Array.from(t.childNodes).findIndex((e=>e.isEqualNode(r.target))),a=e.domParseNode(r.target);o.children.splice(s,0,a),a.parent=o,i.push(r.target),e.selection.focused()&&e.setSelectionAfter(a,"all"),n=!0}}else if("childList"==r.type){const t=Array.from(r.addedNodes).filter((t=>!$(e,t)));if(t.length>0){const o=r.target;if(o.isEqualNode(e.$el))t.forEach((t=>{const r=Array.from(o.childNodes).findIndex((e=>e.isEqualNode(t))),s=e.domParseNode(t);e.stackNodes.splice(r,0,s),i.push(t),e.selection.focused()&&e.setSelectionAfter(s,"all"),n=!0}));else{const r=e.findNode(o);t.forEach((t=>{const s=Array.from(o.childNodes).findIndex((e=>e.isEqualNode(t))),a=e.domParseNode(t);r.hasChildren()?(r.children.splice(s,0,a),a.parent=r):(r.parent.children.splice(s,0,a),a.parent=r.parent),i.push(t),e.selection.focused()&&e.setSelectionAfter(a,"all"),n=!0}))}}}}n&&(i.forEach((e=>{e.parentNode.removeChild(e)})),e.updateView())})),e.domObserver.observe(e.$el,{attributes:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0})};class H{constructor(e){n(this,"name"),n(this,"registered",!1),n(this,"extraKeepTags",[]),n(this,"formatRule"),n(this,"domParseNodeCallback"),n(this,"pasteKeepMarks"),n(this,"pasteKeepStyles"),n(this,"afterUpdateView"),n(this,"addCommands"),this.name=e}static create(e){const t=new H(e.name);return e.extraKeepTags&&(t.extraKeepTags=e.extraKeepTags),e.formatRule&&(t.formatRule=e.formatRule),e.domParseNodeCallback&&(t.domParseNodeCallback=e.domParseNodeCallback),e.pasteKeepMarks&&(t.pasteKeepMarks=e.pasteKeepMarks),e.pasteKeepStyles&&(t.pasteKeepStyles=e.pasteKeepStyles),e.afterUpdateView&&(t.afterUpdateView=e.afterUpdateView),e.addCommands&&(t.addCommands=e.addCommands),t}}const X=(e,t)=>{if(t&&e.hasMarks()){const n={};Object.keys(e.marks).forEach((i=>{t.includes(i)||(n[i]=e.marks[i])})),e.marks=n}else e.marks={}},Y=(e,t)=>{if(t&&e.hasStyles()){const n={};Object.keys(e.styles).forEach((i=>{t.includes(i)||(n[i]=e.styles[i])})),e.styles=n}else e.styles={}},Z=(e,t,n)=>!!e.hasMarks()&&(n?e.marks[t]==n:e.marks.hasOwnProperty(t)),G=(e,t,n)=>!!e.hasStyles()&&(n?e.styles[t]==n:e.styles.hasOwnProperty(t)),Q=e=>{if(!e.selection.focused()||e.selection.collapsed())return[];const t=[];return e.getSelectedNodes().forEach((n=>{if(n.node.isText())if(n.offset){const i=n.node.textContent;if(0==n.offset[0]){const o=n.node.clone(!0);e.addNodeAfter(o,n.node),n.node.textContent=i.substring(0,n.offset[1]),o.textContent=i.substring(n.offset[1]),t.push(n.node)}else if(n.offset[1]==i.length){const o=n.node.clone(!0);e.addNodeBefore(o,n.node),o.textContent=i.substring(0,n.offset[0]),n.node.textContent=i.substring(n.offset[0]),t.push(n.node)}else{const o=n.node.clone(!0),r=n.node.clone(!0);e.addNodeBefore(o,n.node),e.addNodeAfter(r,n.node),o.textContent=i.substring(0,n.offset[0]),n.node.textContent=i.substring(n.offset[0],n.offset[1]),r.textContent=i.substring(n.offset[1]),t.push(n.node)}e.isSelectionInNode(n.node,"start")&&e.setSelectionBefore(n.node,"start"),e.isSelectionInNode(n.node,"end")&&e.setSelectionAfter(n.node,"end")}else t.push(n.node);else n.node.hasChildren()&&t.push(...n.node.getFocusNodes("text"))})),t},J=H.create({name:"text",addCommands(){return{isTextStyle:(e,t)=>{if(!this.selection.focused())return!1;if(this.selection.collapsed()){const n=this.selection.start.node;return!!n.isText()&&G(n,e,t)}return this.getFocusNodesBySelection("text").every((n=>G(n,e,t)))},isTextMark:(e,t)=>{if(!this.selection.focused())return!1;if(this.selection.collapsed()){const n=this.selection.start.node;return!!n.isText()&&Z(n,e,t)}return this.getFocusNodesBySelection("text").every((n=>Z(n,e,t)))},setTextStyle:async e=>{if(this.selection.focused()){if(this.selection.collapsed()){const t=this.selection.start.node;if(t.isZeroWidthText())t.hasStyles()?Object.assign(t.styles,l.clone(e)):t.styles=l.clone(e);else if(t.isText()){const n=x.createZeroWidthText();n.styles=l.clone(t.styles),n.marks=l.clone(t.marks),n.hasStyles()?Object.assign(n.styles,l.clone(e)):n.styles=l.clone(e),this.insertNode(n)}else{const t=x.createZeroWidthText();t.styles=l.clone(e),this.insertNode(t)}}else Q(this).forEach((t=>{t.hasStyles()?t.styles={...t.styles,...e}:t.styles={...e}}));await this.updateView()}},setTextMark:async e=>{if(this.selection.focused()){if(this.selection.collapsed()){const t=this.selection.start.node;if(t.isZeroWidthText())t.hasMarks()?Object.assign(t.marks,l.clone(e)):t.marks=l.clone(e);else if(t.isText()){const n=x.createZeroWidthText();n.styles=l.clone(t.styles),n.marks=l.clone(t.marks),n.hasMarks()?Object.assign(n.marks,l.clone(e)):n.marks=l.clone(e),this.insertNode(n)}else{const t=x.createZeroWidthText();t.marks=l.clone(e),this.insertNode(t)}}else Q(this).forEach((t=>{t.hasMarks()?t.marks={...t.marks,...e}:t.marks={...e}}));await this.updateView()}},removeTextStyle:async e=>{if(this.selection.focused()){if(this.selection.collapsed()){const t=this.selection.start.node;if(t.isZeroWidthText())Y(t,e);else if(t.isText()){const n=x.createZeroWidthText();n.styles=l.clone(t.styles),n.marks=l.clone(t.marks),Y(n,e),this.insertNode(n)}}else Q(this).forEach((t=>{Y(t,e)}));await this.updateView()}},removeTextMark:async e=>{if(this.selection.focused()){if(this.selection.collapsed()){const t=this.selection.start.node;if(t.isZeroWidthText())X(t,e);else if(t.isText()){const n=x.createZeroWidthText();n.styles=l.clone(t.styles),n.marks=l.clone(t.marks),X(n,e),this.insertNode(n)}}else Q(this).forEach((t=>{X(t,e)}));await this.updateView()}}}}}),ee=H.create({name:"history",addCommands(){return{canUndo:()=>this.history.records.length>1,canRedo:()=>this.history.redoRecords.length>0,redo:async()=>{const e=this.history.setRedo();e&&(this.stackNodes=e.nodes,this.selection=e.selection,await this.updateView(!0))},undo:async()=>{const e=this.history.setUndo();e&&(this.stackNodes=e.nodes,this.selection=e.selection,await this.updateView(!0))}}}});"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function te(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ne,ie={exports:{}};(ne=ie).exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function r(e,t,n){return t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=l(e);if(t){var o=l(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,n)}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},u.apply(this,arguments)}function p(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var f=function(e){return!(!e||!e.Window)&&e instanceof e.Window},g=void 0,m=void 0;function y(e){g=e;var t=e.document.createTextNode("");t.ownerDocument!==e.document&&"function"==typeof e.wrap&&e.wrap(t)===t&&(e=e.wrap(e)),m=e}function v(e){return f(e)?e:(e.ownerDocument||e).defaultView||m.window}"undefined"!=typeof window&&window&&y(window);var b=function(e){return!!e&&"object"===n(e)},x=function(e){return"function"==typeof e},w={window:function(e){return e===m||f(e)},docFrag:function(e){return b(e)&&11===e.nodeType},object:b,func:x,number:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e},string:function(e){return"string"==typeof e},element:function(e){if(!e||"object"!==n(e))return!1;var t=v(e)||m;return/object|function/.test("undefined"==typeof Element?"undefined":n(Element))?e instanceof Element||e instanceof t.Element:1===e.nodeType&&"string"==typeof e.nodeName},plainObject:function(e){return b(e)&&!!e.constructor&&/function Object\b/.test(e.constructor.toString())},array:function(e){return b(e)&&void 0!==e.length&&x(e.splice)}};function T(e){var t=e.interaction;if("drag"===t.prepared.name){var n=t.prepared.axis;"x"===n?(t.coords.cur.page.y=t.coords.start.page.y,t.coords.cur.client.y=t.coords.start.client.y,t.coords.velocity.client.y=0,t.coords.velocity.page.y=0):"y"===n&&(t.coords.cur.page.x=t.coords.start.page.x,t.coords.cur.client.x=t.coords.start.client.x,t.coords.velocity.client.x=0,t.coords.velocity.page.x=0)}}function S(e){var t=e.iEvent,n=e.interaction;if("drag"===n.prepared.name){var i=n.prepared.axis;if("x"===i||"y"===i){var o="x"===i?"y":"x";t.page[o]=n.coords.start.page[o],t.client[o]=n.coords.start.client[o],t.delta[o]=0}}}var k={id:"actions/drag",install:function(e){var t=e.actions,n=e.Interactable,i=e.defaults;n.prototype.draggable=k.draggable,t.map.drag=k,t.methodDict.drag="draggable",i.actions.drag=k.defaults},listeners:{"interactions:before-action-move":T,"interactions:action-resume":T,"interactions:action-move":S,"auto-start:check":function(e){var t=e.interaction,n=e.interactable,i=e.buttons,o=n.options.drag;if(o&&o.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||i&n.options.drag.mouseButtons))return e.action={name:"drag",axis:"start"===o.lockAxis?o.startAxis:o.lockAxis},!1}},draggable:function(e){return w.object(e)?(this.options.drag.enabled=!1!==e.enabled,this.setPerAction("drag",e),this.setOnEvents("drag",e),/^(xy|x|y|start)$/.test(e.lockAxis)&&(this.options.drag.lockAxis=e.lockAxis),/^(xy|x|y)$/.test(e.startAxis)&&(this.options.drag.startAxis=e.startAxis),this):w.bool(e)?(this.options.drag.enabled=e,this):this.options.drag},beforeMove:T,move:S,defaults:{startAxis:"xy",lockAxis:"xy"},getCursor:function(){return"move"},filterEventType:function(e){return 0===e.search("drag")}},E=k,N={init:function(e){var t=e;N.document=t.document,N.DocumentFragment=t.DocumentFragment||C,N.SVGElement=t.SVGElement||C,N.SVGSVGElement=t.SVGSVGElement||C,N.SVGElementInstance=t.SVGElementInstance||C,N.Element=t.Element||C,N.HTMLElement=t.HTMLElement||N.Element,N.Event=t.Event,N.Touch=t.Touch||C,N.PointerEvent=t.PointerEvent||t.MSPointerEvent},document:null,DocumentFragment:null,SVGElement:null,SVGSVGElement:null,SVGElementInstance:null,Element:null,HTMLElement:null,Event:null,Touch:null,PointerEvent:null};function C(){}var P=N,I={init:function(e){var t=P.Element,n=e.navigator||{};I.supportsTouch="ontouchstart"in e||w.func(e.DocumentTouch)&&P.document instanceof e.DocumentTouch,I.supportsPointerEvent=!1!==n.pointerEnabled&&!!P.PointerEvent,I.isIOS=/iP(hone|od|ad)/.test(n.platform),I.isIOS7=/iP(hone|od|ad)/.test(n.platform)&&/OS 7[^\d]/.test(n.appVersion),I.isIe9=/MSIE 9/.test(n.userAgent),I.isOperaMobile="Opera"===n.appName&&I.supportsTouch&&/Presto/.test(n.userAgent),I.prefixedMatchesSelector="matches"in t.prototype?"matches":"webkitMatchesSelector"in t.prototype?"webkitMatchesSelector":"mozMatchesSelector"in t.prototype?"mozMatchesSelector":"oMatchesSelector"in t.prototype?"oMatchesSelector":"msMatchesSelector",I.pEventTypes=I.supportsPointerEvent?P.PointerEvent===e.MSPointerEvent?{up:"MSPointerUp",down:"MSPointerDown",over:"mouseover",out:"mouseout",move:"MSPointerMove",cancel:"MSPointerCancel"}:{up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"}:null,I.wheelEvent=P.document&&"onmousewheel"in P.document?"mousewheel":"wheel"},supportsTouch:null,supportsPointerEvent:null,isIOS7:null,isIOS:null,isIe9:null,isOperaMobile:null,prefixedMatchesSelector:null,pEventTypes:null,wheelEvent:null},M=I;function O(e,t){if(e.contains)return e.contains(t);for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function A(e,t){for(;w.element(e);){if(D(e,t))return e;e=_(e)}return null}function _(e){var t=e.parentNode;if(w.docFrag(t)){for(;(t=t.host)&&w.docFrag(t););return t}return t}function D(e,t){return m!==g&&(t=t.replace(/\/deep\//g," ")),e[M.prefixedMatchesSelector](t)}var R=function(e){return e.parentNode||e.host};function z(e,t){for(var n,i=[],o=e;(n=R(o))&&o!==t&&n!==o.ownerDocument;)i.unshift(o),o=n;return i}function B(e,t,n){for(;w.element(e);){if(D(e,t))return!0;if((e=_(e))===n)return D(e,t)}return!1}function F(e){return e.correspondingUseElement||e}function j(e){var t=e instanceof P.SVGElement?e.getBoundingClientRect():e.getClientRects()[0];return t&&{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width||t.right-t.left,height:t.height||t.bottom-t.top}}function L(e){var t,n=j(e);if(!M.isIOS7&&n){var i={x:(t=(t=v(e))||m).scrollX||t.document.documentElement.scrollLeft,y:t.scrollY||t.document.documentElement.scrollTop};n.left+=i.x,n.right+=i.x,n.top+=i.y,n.bottom+=i.y}return n}function q(e){for(var t=[];e;)t.push(e),e=_(e);return t}function K(e){return!!w.string(e)&&(P.document.querySelector(e),!0)}function W(e,t){for(var n in t)e[n]=t[n];return e}function $(e,t,n){return"parent"===e?_(n):"self"===e?t.getRect(n):A(n,e)}function V(e,t,n,i){var o=e;return w.string(o)?o=$(o,t,n):w.func(o)&&(o=o.apply(void 0,i)),w.element(o)&&(o=L(o)),o}function U(e){return e&&{x:"x"in e?e.x:e.left,y:"y"in e?e.y:e.top}}function H(e){return!e||"x"in e&&"y"in e||((e=W({},e)).x=e.left||0,e.y=e.top||0,e.width=e.width||(e.right||0)-e.x,e.height=e.height||(e.bottom||0)-e.y),e}function X(e,t,n){e.left&&(t.left+=n.x),e.right&&(t.right+=n.x),e.top&&(t.top+=n.y),e.bottom&&(t.bottom+=n.y),t.width=t.right-t.left,t.height=t.bottom-t.top}function Y(e,t,n){var i=n&&e.options[n];return U(V(i&&i.origin||e.options.origin,e,t,[e&&t]))||{x:0,y:0}}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!0},i=arguments.length>3?arguments[3]:void 0;if(i=i||{},w.string(e)&&-1!==e.search(" ")&&(e=G(e)),w.array(e))return e.forEach((function(e){return Z(e,t,n,i)})),i;if(w.object(e)&&(t=e,e=""),w.func(t)&&n(e))i[e]=i[e]||[],i[e].push(t);else if(w.array(t))for(var o=0,r=t;o<r.length;o++){var s=r[o];Z(e,s,n,i)}else if(w.object(t))for(var a in t)Z(G(a).map((function(t){return"".concat(e).concat(t)})),t[a],n,i);return i}function G(e){return e.trim().split(/ +/)}var Q=function(e,t){return Math.sqrt(e*e+t*t)},J=["webkit","moz"];function ee(e,t){e.__set||(e.__set={});var n=function(n){if(J.some((function(e){return 0===n.indexOf(e)})))return 1;"function"!=typeof e[n]&&"__set"!==n&&Object.defineProperty(e,n,{get:function(){return n in e.__set?e.__set[n]:e.__set[n]=t[n]},set:function(t){e.__set[n]=t},configurable:!0})};for(var i in t)n(i);return e}function te(e,t){e.page=e.page||{},e.page.x=t.page.x,e.page.y=t.page.y,e.client=e.client||{},e.client.x=t.client.x,e.client.y=t.client.y,e.timeStamp=t.timeStamp}function ie(e){e.page.x=0,e.page.y=0,e.client.x=0,e.client.y=0}function oe(e){return e instanceof P.Event||e instanceof P.Touch}function re(e,t,n){return e=e||"page",(n=n||{}).x=t[e+"X"],n.y=t[e+"Y"],n}function se(e,t){return t=t||{x:0,y:0},M.isOperaMobile&&oe(e)?(re("screen",e,t),t.x+=window.scrollX,t.y+=window.scrollY):re("page",e,t),t}function ae(e){return w.number(e.pointerId)?e.pointerId:e.identifier}function le(e,t,n){var i,o,r=t.length>1?de(t):t[0];se(r,e.page),i=r,o=(o=e.client)||{},M.isOperaMobile&&oe(i)?re("screen",i,o):re("client",i,o),e.timeStamp=n}function ce(e){var t=[];return w.array(e)?(t[0]=e[0],t[1]=e[1]):"touchend"===e.type?1===e.touches.length?(t[0]=e.touches[0],t[1]=e.changedTouches[0]):0===e.touches.length&&(t[0]=e.changedTouches[0],t[1]=e.changedTouches[1]):(t[0]=e.touches[0],t[1]=e.touches[1]),t}function de(e){for(var t={pageX:0,pageY:0,clientX:0,clientY:0,screenX:0,screenY:0},n=0;n<e.length;n++){var i=e[n];for(var o in t)t[o]+=i[o]}for(var r in t)t[r]/=e.length;return t}function he(e){if(!e.length)return null;var t=ce(e),n=Math.min(t[0].pageX,t[1].pageX),i=Math.min(t[0].pageY,t[1].pageY),o=Math.max(t[0].pageX,t[1].pageX),r=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:i,left:n,top:i,right:o,bottom:r,width:o-n,height:r-i}}function ue(e,t){var n=t+"X",i=t+"Y",o=ce(e),r=o[0][n]-o[1][n],s=o[0][i]-o[1][i];return Q(r,s)}function pe(e,t){var n=t+"X",i=t+"Y",o=ce(e),r=o[1][n]-o[0][n],s=o[1][i]-o[0][i];return 180*Math.atan2(s,r)/Math.PI}function fe(e){return w.string(e.pointerType)?e.pointerType:w.number(e.pointerType)?[void 0,void 0,"touch","pen","mouse"][e.pointerType]:/touch/.test(e.type||"")||e instanceof P.Touch?"touch":"mouse"}function ge(e){var t=w.func(e.composedPath)?e.composedPath():e.path;return[F(t?t[0]:e.target),F(e.currentTarget)]}var me=function(){function e(t){i(this,e),this.immediatePropagationStopped=!1,this.propagationStopped=!1,this._interaction=t}return r(e,[{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),e}();Object.defineProperty(me.prototype,"interaction",{get:function(){return this._interaction._proxy},set:function(){}});var ye=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.push(i)}return e},ve=function(e){return ye([],e)},be=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return n;return-1},xe=function(e,t){return e[be(e,t)]},we=function(e){a(n,e);var t=h(n);function n(e,o,r){var s;i(this,n),(s=t.call(this,o._interaction)).dropzone=void 0,s.dragEvent=void 0,s.relatedTarget=void 0,s.draggable=void 0,s.propagationStopped=!1,s.immediatePropagationStopped=!1;var a="dragleave"===r?e.prev:e.cur,l=a.element,c=a.dropzone;return s.type=r,s.target=l,s.currentTarget=l,s.dropzone=c,s.dragEvent=o,s.relatedTarget=o.target,s.draggable=o.interactable,s.timeStamp=o.timeStamp,s}return r(n,[{key:"reject",value:function(){var e=this,t=this._interaction.dropState;if("dropactivate"===this.type||this.dropzone&&t.cur.dropzone===this.dropzone&&t.cur.element===this.target)if(t.prev.dropzone=this.dropzone,t.prev.element=this.target,t.rejected=!0,t.events.enter=null,this.stopImmediatePropagation(),"dropactivate"===this.type){var i=t.activeDrops,o=be(i,(function(t){var n=t.dropzone,i=t.element;return n===e.dropzone&&i===e.target}));t.activeDrops.splice(o,1);var r=new n(t,this.dragEvent,"dropdeactivate");r.dropzone=this.dropzone,r.target=this.target,this.dropzone.fire(r)}else this.dropzone.fire(new n(t,this.dragEvent,"dragleave"))}},{key:"preventDefault",value:function(){}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}}]),n}(me);function Te(e,t){for(var n=0,i=e.slice();n<i.length;n++){var o=i[n],r=o.dropzone,s=o.element;t.dropzone=r,t.target=s,r.fire(t),t.propagationStopped=t.immediatePropagationStopped=!1}}function Se(e,t){for(var n=function(e,t){for(var n=[],i=0,o=e.interactables.list;i<o.length;i++){var r=o[i];if(r.options.drop.enabled){var s=r.options.drop.accept;if(!(w.element(s)&&s!==t||w.string(s)&&!D(t,s)||w.func(s)&&!s({dropzone:r,draggableElement:t})))for(var a=0,l=r.getAllElements();a<l.length;a++){var c=l[a];c!==t&&n.push({dropzone:r,element:c,rect:r.getRect(c)})}}}return n}(e,t),i=0;i<n.length;i++){var o=n[i];o.rect=o.dropzone.getRect(o.element)}return n}function ke(e,t,n){for(var i=e.dropState,o=e.interactable,r=e.element,s=[],a=0,l=i.activeDrops;a<l.length;a++){var c=l[a],d=c.dropzone,h=c.element,u=c.rect,p=d.dropCheck(t,n,o,r,h,u);s.push(p?h:null)}var f=function(e){for(var t,n,i,o=[],r=0;r<e.length;r++){var s=e[r],a=e[t];if(s&&r!==t)if(a){var l=R(s),c=R(a);if(l!==s.ownerDocument)if(c!==s.ownerDocument)if(l!==c){o=o.length?o:z(a);var d=void 0;if(a instanceof P.HTMLElement&&s instanceof P.SVGElement&&!(s instanceof P.SVGSVGElement)){if(s===c)continue;d=s.ownerSVGElement}else d=s;for(var h=z(d,a.ownerDocument),u=0;h[u]&&h[u]===o[u];)u++;var p=[h[u-1],h[u],o[u]];if(p[0])for(var f=p[0].lastChild;f;){if(f===p[1]){t=r,o=h;break}if(f===p[2])break;f=f.previousSibling}}else i=a,(parseInt(v(n=s).getComputedStyle(n).zIndex,10)||0)>=(parseInt(v(i).getComputedStyle(i).zIndex,10)||0)&&(t=r);else t=r}else t=r}return t}(s);return i.activeDrops[f]||null}function Ee(e,t,n){var i=e.dropState,o={enter:null,leave:null,activate:null,deactivate:null,move:null,drop:null};return"dragstart"===n.type&&(o.activate=new we(i,n,"dropactivate"),o.activate.target=null,o.activate.dropzone=null),"dragend"===n.type&&(o.deactivate=new we(i,n,"dropdeactivate"),o.deactivate.target=null,o.deactivate.dropzone=null),i.rejected||(i.cur.element!==i.prev.element&&(i.prev.dropzone&&(o.leave=new we(i,n,"dragleave"),n.dragLeave=o.leave.target=i.prev.element,n.prevDropzone=o.leave.dropzone=i.prev.dropzone),i.cur.dropzone&&(o.enter=new we(i,n,"dragenter"),n.dragEnter=i.cur.element,n.dropzone=i.cur.dropzone)),"dragend"===n.type&&i.cur.dropzone&&(o.drop=new we(i,n,"drop"),n.dropzone=i.cur.dropzone,n.relatedTarget=i.cur.element),"dragmove"===n.type&&i.cur.dropzone&&(o.move=new we(i,n,"dropmove"),n.dropzone=i.cur.dropzone)),o}function Ne(e,t){var n=e.dropState,i=n.activeDrops,o=n.cur,r=n.prev;t.leave&&r.dropzone.fire(t.leave),t.enter&&o.dropzone.fire(t.enter),t.move&&o.dropzone.fire(t.move),t.drop&&o.dropzone.fire(t.drop),t.deactivate&&Te(i,t.deactivate),n.prev.dropzone=o.dropzone,n.prev.element=o.element}function Ce(e,t){var n=e.interaction,i=e.iEvent,o=e.event;if("dragmove"===i.type||"dragend"===i.type){var r=n.dropState;t.dynamicDrop&&(r.activeDrops=Se(t,n.element));var s=i,a=ke(n,s,o);r.rejected=r.rejected&&!!a&&a.dropzone===r.cur.dropzone&&a.element===r.cur.element,r.cur.dropzone=a&&a.dropzone,r.cur.element=a&&a.element,r.events=Ee(n,0,s)}}var Pe={id:"actions/drop",install:function(e){var t=e.actions,n=e.interactStatic,i=e.Interactable,o=e.defaults;e.usePlugin(E),i.prototype.dropzone=function(e){return function(e,t){if(w.object(t)){if(e.options.drop.enabled=!1!==t.enabled,t.listeners){var n=Z(t.listeners),i=Object.keys(n).reduce((function(e,t){return e[/^(enter|leave)/.test(t)?"drag".concat(t):/^(activate|deactivate|move)/.test(t)?"drop".concat(t):t]=n[t],e}),{}),o=e.options.drop.listeners;o&&e.off(o),e.on(i),e.options.drop.listeners=i}return w.func(t.ondrop)&&e.on("drop",t.ondrop),w.func(t.ondropactivate)&&e.on("dropactivate",t.ondropactivate),w.func(t.ondropdeactivate)&&e.on("dropdeactivate",t.ondropdeactivate),w.func(t.ondragenter)&&e.on("dragenter",t.ondragenter),w.func(t.ondragleave)&&e.on("dragleave",t.ondragleave),w.func(t.ondropmove)&&e.on("dropmove",t.ondropmove),/^(pointer|center)$/.test(t.overlap)?e.options.drop.overlap=t.overlap:w.number(t.overlap)&&(e.options.drop.overlap=Math.max(Math.min(1,t.overlap),0)),"accept"in t&&(e.options.drop.accept=t.accept),"checker"in t&&(e.options.drop.checker=t.checker),e}return w.bool(t)?(e.options.drop.enabled=t,e):e.options.drop}(this,e)},i.prototype.dropCheck=function(e,t,n,i,o,r){return function(e,t,n,i,o,r,s){var a=!1;if(!(s=s||e.getRect(r)))return!!e.options.drop.checker&&e.options.drop.checker(t,n,a,e,r,i,o);var l=e.options.drop.overlap;if("pointer"===l){var c=Y(i,o,"drag"),d=se(t);d.x+=c.x,d.y+=c.y;var h=d.x>s.left&&d.x<s.right,u=d.y>s.top&&d.y<s.bottom;a=h&&u}var p=i.getRect(o);if(p&&"center"===l){var f=p.left+p.width/2,g=p.top+p.height/2;a=f>=s.left&&f<=s.right&&g>=s.top&&g<=s.bottom}return p&&w.number(l)&&(a=Math.max(0,Math.min(s.right,p.right)-Math.max(s.left,p.left))*Math.max(0,Math.min(s.bottom,p.bottom)-Math.max(s.top,p.top))/(p.width*p.height)>=l),e.options.drop.checker&&(a=e.options.drop.checker(t,n,a,e,r,i,o)),a}(this,e,t,n,i,o,r)},n.dynamicDrop=function(t){return w.bool(t)?(e.dynamicDrop=t,n):e.dynamicDrop},W(t.phaselessTypes,{dragenter:!0,dragleave:!0,dropactivate:!0,dropdeactivate:!0,dropmove:!0,drop:!0}),t.methodDict.drop="dropzone",e.dynamicDrop=!1,o.actions.drop=Pe.defaults},listeners:{"interactions:before-action-start":function(e){var t=e.interaction;"drag"===t.prepared.name&&(t.dropState={cur:{dropzone:null,element:null},prev:{dropzone:null,element:null},rejected:null,events:null,activeDrops:[]})},"interactions:after-action-start":function(e,t){var n=e.interaction,i=(e.event,e.iEvent);if("drag"===n.prepared.name){var o=n.dropState;o.activeDrops=[],o.events={},o.activeDrops=Se(t,n.element),o.events=Ee(n,0,i),o.events.activate&&(Te(o.activeDrops,o.events.activate),t.fire("actions/drop:start",{interaction:n,dragEvent:i}))}},"interactions:action-move":Ce,"interactions:after-action-move":function(e,t){var n=e.interaction,i=e.iEvent;if("drag"===n.prepared.name){var o=n.dropState;Ne(n,o.events),t.fire("actions/drop:move",{interaction:n,dragEvent:i}),o.events={}}},"interactions:action-end":function(e,t){if("drag"===e.interaction.prepared.name){var n=e.interaction,i=e.iEvent;Ce(e,t),Ne(n,n.dropState.events),t.fire("actions/drop:end",{interaction:n,dragEvent:i})}},"interactions:stop":function(e){var t=e.interaction;if("drag"===t.prepared.name){var n=t.dropState;n&&(n.activeDrops=null,n.events=null,n.cur.dropzone=null,n.cur.element=null,n.prev.dropzone=null,n.prev.element=null,n.rejected=!1)}}},getActiveDrops:Se,getDrop:ke,getDropEvents:Ee,fireDropEvents:Ne,filterEventType:function(e){return 0===e.search("drag")||0===e.search("drop")},defaults:{enabled:!1,accept:null,overlap:"pointer"}},Ie=Pe;function Me(e){var t=e.interaction,n=e.iEvent,i=e.phase;if("gesture"===t.prepared.name){var o=t.pointers.map((function(e){return e.pointer})),r="start"===i,s="end"===i,a=t.interactable.options.deltaSource;if(n.touches=[o[0],o[1]],r)n.distance=ue(o,a),n.box=he(o),n.scale=1,n.ds=0,n.angle=pe(o,a),n.da=0,t.gesture.startDistance=n.distance,t.gesture.startAngle=n.angle;else if(s||t.pointers.length<2){var l=t.prevEvent;n.distance=l.distance,n.box=l.box,n.scale=l.scale,n.ds=0,n.angle=l.angle,n.da=0}else n.distance=ue(o,a),n.box=he(o),n.scale=n.distance/t.gesture.startDistance,n.angle=pe(o,a),n.ds=n.scale-t.gesture.scale,n.da=n.angle-t.gesture.angle;t.gesture.distance=n.distance,t.gesture.angle=n.angle,w.number(n.scale)&&n.scale!==1/0&&!isNaN(n.scale)&&(t.gesture.scale=n.scale)}}var Oe={id:"actions/gesture",before:["actions/drag","actions/resize"],install:function(e){var t=e.actions,n=e.Interactable,i=e.defaults;n.prototype.gesturable=function(e){return w.object(e)?(this.options.gesture.enabled=!1!==e.enabled,this.setPerAction("gesture",e),this.setOnEvents("gesture",e),this):w.bool(e)?(this.options.gesture.enabled=e,this):this.options.gesture},t.map.gesture=Oe,t.methodDict.gesture="gesturable",i.actions.gesture=Oe.defaults},listeners:{"interactions:action-start":Me,"interactions:action-move":Me,"interactions:action-end":Me,"interactions:new":function(e){e.interaction.gesture={angle:0,distance:0,scale:1,startAngle:0,startDistance:0}},"auto-start:check":function(e){if(!(e.interaction.pointers.length<2)){var t=e.interactable.options.gesture;if(t&&t.enabled)return e.action={name:"gesture"},!1}}},defaults:{},getCursor:function(){return""},filterEventType:function(e){return 0===e.search("gesture")}},Ae=Oe;function _e(e,t,n,i,o,r,s){if(!t)return!1;if(!0===t){var a=w.number(r.width)?r.width:r.right-r.left,l=w.number(r.height)?r.height:r.bottom-r.top;if(s=Math.min(s,Math.abs(("left"===e||"right"===e?a:l)/2)),a<0&&("left"===e?e="right":"right"===e&&(e="left")),l<0&&("top"===e?e="bottom":"bottom"===e&&(e="top")),"left"===e){var c=a>=0?r.left:r.right;return n.x<c+s}if("top"===e){var d=l>=0?r.top:r.bottom;return n.y<d+s}if("right"===e)return n.x>(a>=0?r.right:r.left)-s;if("bottom"===e)return n.y>(l>=0?r.bottom:r.top)-s}return!!w.element(i)&&(w.element(t)?t===i:B(i,t,o))}function De(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.resizeAxes){var i=t;n.interactable.options.resize.square?("y"===n.resizeAxes?i.delta.x=i.delta.y:i.delta.y=i.delta.x,i.axes="xy"):(i.axes=n.resizeAxes,"x"===n.resizeAxes?i.delta.y=0:"y"===n.resizeAxes&&(i.delta.x=0))}}var Re,ze,Be={id:"actions/resize",before:["actions/drag"],install:function(e){var t=e.actions,n=e.browser,i=e.Interactable,o=e.defaults;Be.cursors=n.isIe9?{x:"e-resize",y:"s-resize",xy:"se-resize",top:"n-resize",left:"w-resize",bottom:"s-resize",right:"e-resize",topleft:"se-resize",bottomright:"se-resize",topright:"ne-resize",bottomleft:"ne-resize"}:{x:"ew-resize",y:"ns-resize",xy:"nwse-resize",top:"ns-resize",left:"ew-resize",bottom:"ns-resize",right:"ew-resize",topleft:"nwse-resize",bottomright:"nwse-resize",topright:"nesw-resize",bottomleft:"nesw-resize"},Be.defaultMargin=n.supportsTouch||n.supportsPointerEvent?20:10,i.prototype.resizable=function(t){return function(e,t,n){return w.object(t)?(e.options.resize.enabled=!1!==t.enabled,e.setPerAction("resize",t),e.setOnEvents("resize",t),w.string(t.axis)&&/^x$|^y$|^xy$/.test(t.axis)?e.options.resize.axis=t.axis:null===t.axis&&(e.options.resize.axis=n.defaults.actions.resize.axis),w.bool(t.preserveAspectRatio)?e.options.resize.preserveAspectRatio=t.preserveAspectRatio:w.bool(t.square)&&(e.options.resize.square=t.square),e):w.bool(t)?(e.options.resize.enabled=t,e):e.options.resize}(this,t,e)},t.map.resize=Be,t.methodDict.resize="resizable",o.actions.resize=Be.defaults},listeners:{"interactions:new":function(e){e.interaction.resizeAxes="xy"},"interactions:action-start":function(e){!function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t,o=n.rect;n._rects={start:W({},o),corrected:W({},o),previous:W({},o),delta:{left:0,right:0,width:0,top:0,bottom:0,height:0}},i.edges=n.prepared.edges,i.rect=n._rects.corrected,i.deltaRect=n._rects.delta}}(e),De(e)},"interactions:action-move":function(e){!function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t,o=n.interactable.options.resize.invert,r="reposition"===o||"negate"===o,s=n.rect,a=n._rects,l=a.start,c=a.corrected,d=a.delta,h=a.previous;if(W(h,c),r){if(W(c,s),"reposition"===o){if(c.top>c.bottom){var u=c.top;c.top=c.bottom,c.bottom=u}if(c.left>c.right){var p=c.left;c.left=c.right,c.right=p}}}else c.top=Math.min(s.top,l.bottom),c.bottom=Math.max(s.bottom,l.top),c.left=Math.min(s.left,l.right),c.right=Math.max(s.right,l.left);for(var f in c.width=c.right-c.left,c.height=c.bottom-c.top,c)d[f]=c[f]-h[f];i.edges=n.prepared.edges,i.rect=c,i.deltaRect=d}}(e),De(e)},"interactions:action-end":function(e){var t=e.iEvent,n=e.interaction;if("resize"===n.prepared.name&&n.prepared.edges){var i=t;i.edges=n.prepared.edges,i.rect=n._rects.corrected,i.deltaRect=n._rects.delta}},"auto-start:check":function(e){var t=e.interaction,n=e.interactable,i=e.element,o=e.rect,r=e.buttons;if(o){var s=W({},t.coords.cur.page),a=n.options.resize;if(a&&a.enabled&&(!t.pointerIsDown||!/mouse|pointer/.test(t.pointerType)||r&a.mouseButtons)){if(w.object(a.edges)){var l={left:!1,right:!1,top:!1,bottom:!1};for(var c in l)l[c]=_e(c,a.edges[c],s,t._latestPointer.eventTarget,i,o,a.margin||Be.defaultMargin);l.left=l.left&&!l.right,l.top=l.top&&!l.bottom,(l.left||l.right||l.top||l.bottom)&&(e.action={name:"resize",edges:l})}else{var d="y"!==a.axis&&s.x>o.right-Be.defaultMargin,h="x"!==a.axis&&s.y>o.bottom-Be.defaultMargin;(d||h)&&(e.action={name:"resize",axes:(d?"x":"")+(h?"y":"")})}return!e.action&&void 0}}}},defaults:{square:!1,preserveAspectRatio:!1,axis:"xy",margin:NaN,edges:null,invert:"none"},cursors:null,getCursor:function(e){var t=e.edges,n=e.axis,i=e.name,o=Be.cursors,r=null;if(n)r=o[i+n];else if(t){for(var s="",a=0,l=["top","bottom","left","right"];a<l.length;a++){var c=l[a];t[c]&&(s+=c)}r=o[s]}return r},filterEventType:function(e){return 0===e.search("resize")},defaultMargin:null},Fe=Be,je={id:"actions",install:function(e){e.usePlugin(Ae),e.usePlugin(Fe),e.usePlugin(E),e.usePlugin(Ie)}},Le=0,qe={request:function(e){return Re(e)},cancel:function(e){return ze(e)},init:function(e){if(Re=e.requestAnimationFrame,ze=e.cancelAnimationFrame,!Re)for(var t=["ms","moz","webkit","o"],n=0;n<t.length;n++){var i=t[n];Re=e["".concat(i,"RequestAnimationFrame")],ze=e["".concat(i,"CancelAnimationFrame")]||e["".concat(i,"CancelRequestAnimationFrame")]}Re=Re&&Re.bind(e),ze=ze&&ze.bind(e),Re||(Re=function(t){var n=Date.now(),i=Math.max(0,16-(n-Le)),o=e.setTimeout((function(){t(n+i)}),i);return Le=n+i,o},ze=function(e){return clearTimeout(e)})}},Ke={defaults:{enabled:!1,margin:60,container:null,speed:300},now:Date.now,interaction:null,i:0,x:0,y:0,isScrolling:!1,prevTime:0,margin:0,speed:0,start:function(e){Ke.isScrolling=!0,qe.cancel(Ke.i),e.autoScroll=Ke,Ke.interaction=e,Ke.prevTime=Ke.now(),Ke.i=qe.request(Ke.scroll)},stop:function(){Ke.isScrolling=!1,Ke.interaction&&(Ke.interaction.autoScroll=null),qe.cancel(Ke.i)},scroll:function(){var e=Ke.interaction,t=e.interactable,n=e.element,i=e.prepared.name,o=t.options[i].autoScroll,r=We(o.container,t,n),s=Ke.now(),a=(s-Ke.prevTime)/1e3,l=o.speed*a;if(l>=1){var c={x:Ke.x*l,y:Ke.y*l};if(c.x||c.y){var d=$e(r);w.window(r)?r.scrollBy(c.x,c.y):r&&(r.scrollLeft+=c.x,r.scrollTop+=c.y);var h=$e(r),u={x:h.x-d.x,y:h.y-d.y};(u.x||u.y)&&t.fire({type:"autoscroll",target:n,interactable:t,delta:u,interaction:e,container:r})}Ke.prevTime=s}Ke.isScrolling&&(qe.cancel(Ke.i),Ke.i=qe.request(Ke.scroll))},check:function(e,t){var n;return null==(n=e.options[t].autoScroll)?void 0:n.enabled},onInteractionMove:function(e){var t=e.interaction,n=e.pointer;if(t.interacting()&&Ke.check(t.interactable,t.prepared.name))if(t.simulation)Ke.x=Ke.y=0;else{var i,o,r,s,a=t.interactable,l=t.element,c=t.prepared.name,d=a.options[c].autoScroll,h=We(d.container,a,l);if(w.window(h))s=n.clientX<Ke.margin,i=n.clientY<Ke.margin,o=n.clientX>h.innerWidth-Ke.margin,r=n.clientY>h.innerHeight-Ke.margin;else{var u=j(h);s=n.clientX<u.left+Ke.margin,i=n.clientY<u.top+Ke.margin,o=n.clientX>u.right-Ke.margin,r=n.clientY>u.bottom-Ke.margin}Ke.x=o?1:s?-1:0,Ke.y=r?1:i?-1:0,Ke.isScrolling||(Ke.margin=d.margin,Ke.speed=d.speed,Ke.start(t))}}};function We(e,t,n){return(w.string(e)?$(e,t,n):e)||v(n)}function $e(e){return w.window(e)&&(e=window.document.body),{x:e.scrollLeft,y:e.scrollTop}}var Ve={id:"auto-scroll",install:function(e){var t=e.defaults,n=e.actions;e.autoScroll=Ke,Ke.now=function(){return e.now()},n.phaselessTypes.autoscroll=!0,t.perAction.autoScroll=Ke.defaults},listeners:{"interactions:new":function(e){e.interaction.autoScroll=null},"interactions:destroy":function(e){e.interaction.autoScroll=null,Ke.stop(),Ke.interaction&&(Ke.interaction=null)},"interactions:stop":Ke.stop,"interactions:action-move":function(e){return Ke.onInteractionMove(e)}}};function Ue(e,t){var n=!1;return function(){return n||(m.console.warn(t),n=!0),e.apply(this,arguments)}}function He(e,t){return e.name=t.name,e.axis=t.axis,e.edges=t.edges,e}function Xe(e){return w.bool(e)?(this.options.styleCursor=e,this):null===e?(delete this.options.styleCursor,this):this.options.styleCursor}function Ye(e){return w.func(e)?(this.options.actionChecker=e,this):null===e?(delete this.options.actionChecker,this):this.options.actionChecker}var Ze={id:"auto-start/interactableMethods",install:function(e){var t=e.Interactable;t.prototype.getAction=function(t,n,i,o){var r,s,a,l,c,d,h,u=(s=n,a=i,l=o,c=e,d=(r=this).getRect(l),h={action:null,interactable:r,interaction:a,element:l,rect:d,buttons:s.buttons||{0:1,1:4,3:8,4:16}[s.button]},c.fire("auto-start:check",h),h.action);return this.options.actionChecker?this.options.actionChecker(t,n,u,this,o,i):u},t.prototype.ignoreFrom=Ue((function(e){return this._backCompatOption("ignoreFrom",e)}),"Interactable.ignoreFrom() has been deprecated. Use Interactble.draggable({ignoreFrom: newValue})."),t.prototype.allowFrom=Ue((function(e){return this._backCompatOption("allowFrom",e)}),"Interactable.allowFrom() has been deprecated. Use Interactble.draggable({allowFrom: newValue})."),t.prototype.actionChecker=Ye,t.prototype.styleCursor=Xe}};function Ge(e,t,n,i,o){return t.testIgnoreAllow(t.options[e.name],n,i)&&t.options[e.name].enabled&&tt(t,n,e,o)?e:null}function Qe(e,t,n,i,o,r,s){for(var a=0,l=i.length;a<l;a++){var c=i[a],d=o[a],h=c.getAction(t,n,e,d);if(h){var u=Ge(h,c,d,r,s);if(u)return{action:u,interactable:c,element:d}}}return{action:null,interactable:null,element:null}}function Je(e,t,n,i,o){var r=[],s=[],a=i;function l(e){r.push(e),s.push(a)}for(;w.element(a);){r=[],s=[],o.interactables.forEachMatch(a,l);var c=Qe(e,t,n,r,s,i,o);if(c.action&&!c.interactable.options[c.action.name].manualStart)return c;a=_(a)}return{action:null,interactable:null,element:null}}function et(e,t,n){var i=t.action,o=t.interactable,r=t.element;i=i||{name:null},e.interactable=o,e.element=r,He(e.prepared,i),e.rect=o&&i.name?o.getRect(r):null,ot(e,n),n.fire("autoStart:prepared",{interaction:e})}function tt(e,t,n,i){var o=e.options,r=o[n.name].max,s=o[n.name].maxPerElement,a=i.autoStart.maxInteractions,l=0,c=0,d=0;if(!(r&&s&&a))return!1;for(var h=0,u=i.interactions.list;h<u.length;h++){var p=u[h],f=p.prepared.name;if(p.interacting()){if(++l>=a)return!1;if(p.interactable===e){if((c+=f===n.name?1:0)>=r)return!1;if(p.element===t&&(d++,f===n.name&&d>=s))return!1}}}return a>0}function nt(e,t){return w.number(e)?(t.autoStart.maxInteractions=e,this):t.autoStart.maxInteractions}function it(e,t,n){var i=n.autoStart.cursorElement;i&&i!==e&&(i.style.cursor=""),e.ownerDocument.documentElement.style.cursor=t,e.style.cursor=t,n.autoStart.cursorElement=t?e:null}function ot(e,t){var n=e.interactable,i=e.element,o=e.prepared;if("mouse"===e.pointerType&&n&&n.options.styleCursor){var r="";if(o.name){var s=n.options[o.name].cursorChecker;r=w.func(s)?s(o,n,i,e._interacting):t.actions.map[o.name].getCursor(o)}it(e.element,r||"",t)}else t.autoStart.cursorElement&&it(t.autoStart.cursorElement,"",t)}var rt={id:"auto-start/base",before:["actions"],install:function(e){var t=e.interactStatic,n=e.defaults;e.usePlugin(Ze),n.base.actionChecker=null,n.base.styleCursor=!0,W(n.perAction,{manualStart:!1,max:1/0,maxPerElement:1,allowFrom:null,ignoreFrom:null,mouseButtons:1}),t.maxInteractions=function(t){return nt(t,e)},e.autoStart={maxInteractions:1/0,withinInteractionLimit:tt,cursorElement:null}},listeners:{"interactions:down":function(e,t){var n=e.interaction,i=e.pointer,o=e.event,r=e.eventTarget;n.interacting()||et(n,Je(n,i,o,r,t),t)},"interactions:move":function(e,t){var n,i,o,r,s,a;i=t,o=(n=e).interaction,r=n.pointer,s=n.event,a=n.eventTarget,"mouse"!==o.pointerType||o.pointerIsDown||o.interacting()||et(o,Je(o,r,s,a,i),i),function(e,t){var n=e.interaction;if(n.pointerIsDown&&!n.interacting()&&n.pointerWasMoved&&n.prepared.name){t.fire("autoStart:before-start",e);var i=n.interactable,o=n.prepared.name;o&&i&&(i.options[o].manualStart||!tt(i,n.element,n.prepared,t)?n.stop():(n.start(n.prepared,i,n.element),ot(n,t)))}}(e,t)},"interactions:stop":function(e,t){var n=e.interaction,i=n.interactable;i&&i.options.styleCursor&&it(n.element,"",t)}},maxInteractions:nt,withinInteractionLimit:tt,validateAction:Ge},st={id:"auto-start/dragAxis",listeners:{"autoStart:before-start":function(e,t){var n=e.interaction,i=e.eventTarget,o=e.dx,r=e.dy;if("drag"===n.prepared.name){var s=Math.abs(o),a=Math.abs(r),l=n.interactable.options.drag,c=l.startAxis,d=s>a?"x":s<a?"y":"xy";if(n.prepared.axis="start"===l.lockAxis?d[0]:l.lockAxis,"xy"!==d&&"xy"!==c&&c!==d){n.prepared.name=null;for(var h=i,u=function(e){if(e!==n.interactable){var o=n.interactable.options.drag;if(!o.manualStart&&e.testIgnoreAllow(o,h,i)){var r=e.getAction(n.downPointer,n.downEvent,n,h);if(r&&"drag"===r.name&&function(e,t){if(!t)return!1;var n=t.options.drag.startAxis;return"xy"===e||"xy"===n||n===e}(d,e)&&rt.validateAction(r,e,h,i,t))return e}}};w.element(h);){var p=t.interactables.forEachMatch(h,u);if(p){n.prepared.name="drag",n.interactable=p,n.element=h;break}h=_(h)}}}}}};function at(e){var t=e.prepared&&e.prepared.name;if(!t)return null;var n=e.interactable.options;return n[t].hold||n[t].delay}var lt={id:"auto-start/hold",install:function(e){var t=e.defaults;e.usePlugin(rt),t.perAction.hold=0,t.perAction.delay=0},listeners:{"interactions:new":function(e){e.interaction.autoStartHoldTimer=null},"autoStart:prepared":function(e){var t=e.interaction,n=at(t);n>0&&(t.autoStartHoldTimer=setTimeout((function(){t.start(t.prepared,t.interactable,t.element)}),n))},"interactions:move":function(e){var t=e.interaction,n=e.duplicate;t.autoStartHoldTimer&&t.pointerWasMoved&&!n&&(clearTimeout(t.autoStartHoldTimer),t.autoStartHoldTimer=null)},"autoStart:before-start":function(e){var t=e.interaction;at(t)>0&&(t.prepared.name=null)}},getHoldDuration:at},ct={id:"auto-start",install:function(e){e.usePlugin(rt),e.usePlugin(lt),e.usePlugin(st)}},dt=function(e){return/^(always|never|auto)$/.test(e)?(this.options.preventDefault=e,this):w.bool(e)?(this.options.preventDefault=e?"always":"never",this):this.options.preventDefault};function ht(e){var t=e.interaction,n=e.event;t.interactable&&t.interactable.checkAndPreventDefault(n)}var ut={id:"core/interactablePreventDefault",install:function(e){var t=e.Interactable;t.prototype.preventDefault=dt,t.prototype.checkAndPreventDefault=function(t){return function(e,t,n){var i=e.options.preventDefault;if("never"!==i)if("always"!==i){if(t.events.supportsPassive&&/^touch(start|move)$/.test(n.type)){var o=v(n.target).document,r=t.getDocOptions(o);if(!r||!r.events||!1!==r.events.passive)return}/^(mouse|pointer|touch)*(down|start)/i.test(n.type)||w.element(n.target)&&D(n.target,"input,select,textarea,[contenteditable=true],[contenteditable=true] *")||n.preventDefault()}else n.preventDefault()}(this,e,t)},e.interactions.docEvents.push({type:"dragstart",listener:function(t){for(var n=0,i=e.interactions.list;n<i.length;n++){var o=i[n];if(o.element&&(o.element===t.target||O(o.element,t.target)))return void o.interactable.checkAndPreventDefault(t)}}})},listeners:["down","move","up","cancel"].reduce((function(e,t){return e["interactions:".concat(t)]=ht,e}),{})};function pt(e,t){if(t.phaselessTypes[e])return!0;for(var n in t.map)if(0===e.indexOf(n)&&e.substr(n.length)in t.phases)return!0;return!1}function ft(e){var t={};for(var n in e){var i=e[n];w.plainObject(i)?t[n]=ft(i):w.array(i)?t[n]=ve(i):t[n]=i}return t}var gt=function(){function e(t){i(this,e),this.states=[],this.startOffset={left:0,right:0,top:0,bottom:0},this.startDelta=void 0,this.result=void 0,this.endResult=void 0,this.startEdges=void 0,this.edges=void 0,this.interaction=void 0,this.interaction=t,this.result=mt(),this.edges={left:!1,right:!1,top:!1,bottom:!1}}return r(e,[{key:"start",value:function(e,t){var n,i,o,r,s,a=e.phase,l=this.interaction,c=(r=(o=l).interactable.options[o.prepared.name],(s=r.modifiers)&&s.length?s:["snap","snapSize","snapEdges","restrict","restrictEdges","restrictSize"].map((function(e){var t=r[e];return t&&t.enabled&&{options:t,methods:t._methods}})).filter((function(e){return!!e})));this.prepareStates(c),this.startEdges=W({},l.edges),this.edges=W({},this.startEdges),this.startOffset=(i=t,(n=l.rect)?{left:i.x-n.left,top:i.y-n.top,right:n.right-i.x,bottom:n.bottom-i.y}:{left:0,top:0,right:0,bottom:0}),this.startDelta={x:0,y:0};var d=this.fillArg({phase:a,pageCoords:t,preEnd:!1});return this.result=mt(),this.startAll(d),this.result=this.setAll(d)}},{key:"fillArg",value:function(e){var t=this.interaction;return e.interaction=t,e.interactable=t.interactable,e.element=t.element,e.rect||(e.rect=t.rect),e.edges||(e.edges=this.startEdges),e.startOffset=this.startOffset,e}},{key:"startAll",value:function(e){for(var t=0,n=this.states;t<n.length;t++){var i=n[t];i.methods.start&&(e.state=i,i.methods.start(e))}}},{key:"setAll",value:function(e){var t=e.phase,n=e.preEnd,i=e.skipModifiers,o=e.rect,r=e.edges;e.coords=W({},e.pageCoords),e.rect=W({},o),e.edges=W({},r);for(var s=i?this.states.slice(i):this.states,a=mt(e.coords,e.rect),l=0;l<s.length;l++){var c,d=s[l],h=d.options,u=W({},e.coords),p=null;null!=(c=d.methods)&&c.set&&this.shouldDo(h,n,t)&&(e.state=d,p=d.methods.set(e),X(e.edges,e.rect,{x:e.coords.x-u.x,y:e.coords.y-u.y})),a.eventProps.push(p)}W(this.edges,e.edges),a.delta.x=e.coords.x-e.pageCoords.x,a.delta.y=e.coords.y-e.pageCoords.y,a.rectDelta.left=e.rect.left-o.left,a.rectDelta.right=e.rect.right-o.right,a.rectDelta.top=e.rect.top-o.top,a.rectDelta.bottom=e.rect.bottom-o.bottom;var f=this.result.coords,g=this.result.rect;if(f&&g){var m=a.rect.left!==g.left||a.rect.right!==g.right||a.rect.top!==g.top||a.rect.bottom!==g.bottom;a.changed=m||f.x!==a.coords.x||f.y!==a.coords.y}return a}},{key:"applyToInteraction",value:function(e){var t=this.interaction,n=e.phase,i=t.coords.cur,o=t.coords.start,r=this.result,s=this.startDelta,a=r.delta;"start"===n&&W(this.startDelta,r.delta);for(var l=0,c=[[o,s],[i,a]];l<c.length;l++){var d=c[l],h=d[0],u=d[1];h.page.x+=u.x,h.page.y+=u.y,h.client.x+=u.x,h.client.y+=u.y}var p=this.result.rectDelta,f=e.rect||t.rect;f.left+=p.left,f.right+=p.right,f.top+=p.top,f.bottom+=p.bottom,f.width=f.right-f.left,f.height=f.bottom-f.top}},{key:"setAndApply",value:function(e){var t=this.interaction,n=e.phase,i=e.preEnd,o=e.skipModifiers,r=this.setAll(this.fillArg({preEnd:i,phase:n,pageCoords:e.modifiedCoords||t.coords.cur.page}));if(this.result=r,!r.changed&&(!o||o<this.states.length)&&t.interacting())return!1;if(e.modifiedCoords){var s=t.coords.cur.page,a={x:e.modifiedCoords.x-s.x,y:e.modifiedCoords.y-s.y};r.coords.x+=a.x,r.coords.y+=a.y,r.delta.x+=a.x,r.delta.y+=a.y}this.applyToInteraction(e)}},{key:"beforeEnd",value:function(e){var t=e.interaction,n=e.event,i=this.states;if(i&&i.length){for(var o=!1,r=0;r<i.length;r++){var s=i[r];e.state=s;var a=s.options,l=s.methods,c=l.beforeEnd&&l.beforeEnd(e);if(c)return this.endResult=c,!1;o=o||!o&&this.shouldDo(a,!0,e.phase,!0)}o&&t.move({event:n,preEnd:!0})}}},{key:"stop",value:function(e){var t=e.interaction;if(this.states&&this.states.length){var n=W({states:this.states,interactable:t.interactable,element:t.element,rect:null},e);this.fillArg(n);for(var i=0,o=this.states;i<o.length;i++){var r=o[i];n.state=r,r.methods.stop&&r.methods.stop(n)}this.states=null,this.endResult=null}}},{key:"prepareStates",value:function(e){this.states=[];for(var t=0;t<e.length;t++){var n=e[t],i=n.options,o=n.methods,r=n.name;this.states.push({options:i,methods:o,index:t,name:r})}return this.states}},{key:"restoreInteractionCoords",value:function(e){var t=e.interaction,n=t.coords,i=t.rect,o=t.modification;if(o.result){for(var r=o.startDelta,s=o.result,a=s.delta,l=s.rectDelta,c=0,d=[[n.start,r],[n.cur,a]];c<d.length;c++){var h=d[c],u=h[0],p=h[1];u.page.x-=p.x,u.page.y-=p.y,u.client.x-=p.x,u.client.y-=p.y}i.left-=l.left,i.right-=l.right,i.top-=l.top,i.bottom-=l.bottom}}},{key:"shouldDo",value:function(e,t,n,i){return!(!e||!1===e.enabled||i&&!e.endOnly||e.endOnly&&!t||"start"===n&&!e.setStart)}},{key:"copyFrom",value:function(e){this.startOffset=e.startOffset,this.startDelta=e.startDelta,this.startEdges=e.startEdges,this.edges=e.edges,this.states=e.states.map((function(e){return ft(e)})),this.result=mt(W({},e.result.coords),W({},e.result.rect))}},{key:"destroy",value:function(){for(var e in this)this[e]=null}}]),e}();function mt(e,t){return{rect:t,coords:e,delta:{x:0,y:0},rectDelta:{left:0,right:0,top:0,bottom:0},eventProps:[],changed:!0}}function yt(e,t){var n=e.defaults,i={start:e.start,set:e.set,beforeEnd:e.beforeEnd,stop:e.stop},o=function(e){var o=e||{};for(var r in o.enabled=!1!==o.enabled,n)r in o||(o[r]=n[r]);var s={options:o,methods:i,name:t,enable:function(){return o.enabled=!0,s},disable:function(){return o.enabled=!1,s}};return s};return t&&"string"==typeof t&&(o._defaults=n,o._methods=i),o}function vt(e){var t=e.iEvent,n=e.interaction.modification.result;n&&(t.modifiers=n.eventProps)}var bt={id:"modifiers/base",before:["actions"],install:function(e){e.defaults.perAction.modifiers=[]},listeners:{"interactions:new":function(e){var t=e.interaction;t.modification=new gt(t)},"interactions:before-action-start":function(e){var t=e.interaction,n=e.interaction.modification;n.start(e,t.coords.start.page),t.edges=n.edges,n.applyToInteraction(e)},"interactions:before-action-move":function(e){var t=e.interaction,n=t.modification,i=n.setAndApply(e);return t.edges=n.edges,i},"interactions:before-action-end":function(e){var t=e.interaction,n=t.modification,i=n.beforeEnd(e);return t.edges=n.startEdges,i},"interactions:action-start":vt,"interactions:action-move":vt,"interactions:action-end":vt,"interactions:after-action-start":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:after-action-move":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:stop":function(e){return e.interaction.modification.stop(e)}}},xt={base:{preventDefault:"auto",deltaSource:"page"},perAction:{enabled:!1,origin:{x:0,y:0}},actions:{}},wt=function(e){a(n,e);var t=h(n);function n(e,o,r,s,a,l,c){var h;i(this,n),(h=t.call(this,e)).relatedTarget=null,h.screenX=void 0,h.screenY=void 0,h.button=void 0,h.buttons=void 0,h.ctrlKey=void 0,h.shiftKey=void 0,h.altKey=void 0,h.metaKey=void 0,h.page=void 0,h.client=void 0,h.delta=void 0,h.rect=void 0,h.x0=void 0,h.y0=void 0,h.t0=void 0,h.dt=void 0,h.duration=void 0,h.clientX0=void 0,h.clientY0=void 0,h.velocity=void 0,h.speed=void 0,h.swipe=void 0,h.axes=void 0,h.preEnd=void 0,a=a||e.element;var u=e.interactable,p=(u&&u.options||xt).deltaSource,f=Y(u,a,r),g="start"===s,m="end"===s,y=g?d(h):e.prevEvent,v=g?e.coords.start:m?{page:y.page,client:y.client,timeStamp:e.coords.cur.timeStamp}:e.coords.cur;return h.page=W({},v.page),h.client=W({},v.client),h.rect=W({},e.rect),h.timeStamp=v.timeStamp,m||(h.page.x-=f.x,h.page.y-=f.y,h.client.x-=f.x,h.client.y-=f.y),h.ctrlKey=o.ctrlKey,h.altKey=o.altKey,h.shiftKey=o.shiftKey,h.metaKey=o.metaKey,h.button=o.button,h.buttons=o.buttons,h.target=a,h.currentTarget=a,h.preEnd=l,h.type=c||r+(s||""),h.interactable=u,h.t0=g?e.pointers[e.pointers.length-1].downTime:y.t0,h.x0=e.coords.start.page.x-f.x,h.y0=e.coords.start.page.y-f.y,h.clientX0=e.coords.start.client.x-f.x,h.clientY0=e.coords.start.client.y-f.y,h.delta=g||m?{x:0,y:0}:{x:h[p].x-y[p].x,y:h[p].y-y[p].y},h.dt=e.coords.delta.timeStamp,h.duration=h.timeStamp-h.t0,h.velocity=W({},e.coords.velocity[p]),h.speed=Q(h.velocity.x,h.velocity.y),h.swipe=m||"inertiastart"===s?h.getSwipe():null,h}return r(n,[{key:"getSwipe",value:function(){var e=this._interaction;if(e.prevEvent.speed<600||this.timeStamp-e.prevEvent.timeStamp>150)return null;var t=180*Math.atan2(e.prevEvent.velocityY,e.prevEvent.velocityX)/Math.PI;t<0&&(t+=360);var n=112.5<=t&&t<247.5,i=202.5<=t&&t<337.5;return{up:i,down:!i&&22.5<=t&&t<157.5,left:n,right:!n&&(292.5<=t||t<67.5),angle:t,speed:e.prevEvent.speed,velocity:{x:e.prevEvent.velocityX,y:e.prevEvent.velocityY}}}},{key:"preventDefault",value:function(){}},{key:"stopImmediatePropagation",value:function(){this.immediatePropagationStopped=this.propagationStopped=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}]),n}(me);Object.defineProperties(wt.prototype,{pageX:{get:function(){return this.page.x},set:function(e){this.page.x=e}},pageY:{get:function(){return this.page.y},set:function(e){this.page.y=e}},clientX:{get:function(){return this.client.x},set:function(e){this.client.x=e}},clientY:{get:function(){return this.client.y},set:function(e){this.client.y=e}},dx:{get:function(){return this.delta.x},set:function(e){this.delta.x=e}},dy:{get:function(){return this.delta.y},set:function(e){this.delta.y=e}},velocityX:{get:function(){return this.velocity.x},set:function(e){this.velocity.x=e}},velocityY:{get:function(){return this.velocity.y},set:function(e){this.velocity.y=e}}});var Tt,St=r((function e(t,n,o,r,s){i(this,e),this.id=void 0,this.pointer=void 0,this.event=void 0,this.downTime=void 0,this.downTarget=void 0,this.id=t,this.pointer=n,this.event=o,this.downTime=r,this.downTarget=s})),kt=((Tt={}).interactable="",Tt.element="",Tt.prepared="",Tt.pointerIsDown="",Tt.pointerWasMoved="",Tt._proxy="",Tt),Et=function(e){return e.start="",e.move="",e.end="",e.stop="",e.interacting="",e}({}),Nt=0,Ct=function(){function e(t){var n=this,o=t.pointerType,r=t.scopeFire;i(this,e),this.interactable=null,this.element=null,this.rect=null,this._rects=void 0,this.edges=null,this._scopeFire=void 0,this.prepared={name:null,axis:null,edges:null},this.pointerType=void 0,this.pointers=[],this.downEvent=null,this.downPointer={},this._latestPointer={pointer:null,event:null,eventTarget:null},this.prevEvent=null,this.pointerIsDown=!1,this.pointerWasMoved=!1,this._interacting=!1,this._ending=!1,this._stopped=!0,this._proxy=void 0,this.simulation=null,this.doMove=Ue((function(e){this.move(e)}),"The interaction.doMove() method has been renamed to interaction.move()"),this.coords={start:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},prev:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},cur:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},delta:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0},velocity:{page:{x:0,y:0},client:{x:0,y:0},timeStamp:0}},this._id=Nt++,this._scopeFire=r,this.pointerType=o;var s=this;this._proxy={};var a=function(e){Object.defineProperty(n._proxy,e,{get:function(){return s[e]}})};for(var l in kt)a(l);var c=function(e){Object.defineProperty(n._proxy,e,{value:function(){return s[e].apply(s,arguments)}})};for(var d in Et)c(d);this._scopeFire("interactions:new",{interaction:this})}return r(e,[{key:"pointerMoveTolerance",get:function(){return 1}},{key:"pointerDown",value:function(e,t,n){var i=this.updatePointer(e,t,n,!0),o=this.pointers[i];this._scopeFire("interactions:down",{pointer:e,event:t,eventTarget:n,pointerIndex:i,pointerInfo:o,type:"down",interaction:this})}},{key:"start",value:function(e,t,n){return!(this.interacting()||!this.pointerIsDown||this.pointers.length<("gesture"===e.name?2:1)||!t.options[e.name].enabled)&&(He(this.prepared,e),this.interactable=t,this.element=n,this.rect=t.getRect(n),this.edges=this.prepared.edges?W({},this.prepared.edges):{left:!0,right:!0,top:!0,bottom:!0},this._stopped=!1,this._interacting=this._doPhase({interaction:this,event:this.downEvent,phase:"start"})&&!this._stopped,this._interacting)}},{key:"pointerMove",value:function(e,t,n){this.simulation||this.modification&&this.modification.endResult||this.updatePointer(e,t,n,!1);var i,o,r=this.coords.cur.page.x===this.coords.prev.page.x&&this.coords.cur.page.y===this.coords.prev.page.y&&this.coords.cur.client.x===this.coords.prev.client.x&&this.coords.cur.client.y===this.coords.prev.client.y;this.pointerIsDown&&!this.pointerWasMoved&&(i=this.coords.cur.client.x-this.coords.start.client.x,o=this.coords.cur.client.y-this.coords.start.client.y,this.pointerWasMoved=Q(i,o)>this.pointerMoveTolerance);var s,a,l,c=this.getPointerIndex(e),d={pointer:e,pointerIndex:c,pointerInfo:this.pointers[c],event:t,type:"move",eventTarget:n,dx:i,dy:o,duplicate:r,interaction:this};r||(s=this.coords.velocity,a=this.coords.delta,l=Math.max(a.timeStamp/1e3,.001),s.page.x=a.page.x/l,s.page.y=a.page.y/l,s.client.x=a.client.x/l,s.client.y=a.client.y/l,s.timeStamp=l),this._scopeFire("interactions:move",d),r||this.simulation||(this.interacting()&&(d.type=null,this.move(d)),this.pointerWasMoved&&te(this.coords.prev,this.coords.cur))}},{key:"move",value:function(e){e&&e.event||ie(this.coords.delta),(e=W({pointer:this._latestPointer.pointer,event:this._latestPointer.event,eventTarget:this._latestPointer.eventTarget,interaction:this},e||{})).phase="move",this._doPhase(e)}},{key:"pointerUp",value:function(e,t,n,i){var o=this.getPointerIndex(e);-1===o&&(o=this.updatePointer(e,t,n,!1));var r=/cancel$/i.test(t.type)?"cancel":"up";this._scopeFire("interactions:".concat(r),{pointer:e,pointerIndex:o,pointerInfo:this.pointers[o],event:t,eventTarget:n,type:r,curEventTarget:i,interaction:this}),this.simulation||this.end(t),this.removePointer(e,t)}},{key:"documentBlur",value:function(e){this.end(e),this._scopeFire("interactions:blur",{event:e,type:"blur",interaction:this})}},{key:"end",value:function(e){var t;this._ending=!0,e=e||this._latestPointer.event,this.interacting()&&(t=this._doPhase({event:e,interaction:this,phase:"end"})),this._ending=!1,!0===t&&this.stop()}},{key:"currentAction",value:function(){return this._interacting?this.prepared.name:null}},{key:"interacting",value:function(){return this._interacting}},{key:"stop",value:function(){this._scopeFire("interactions:stop",{interaction:this}),this.interactable=this.element=null,this._interacting=!1,this._stopped=!0,this.prepared.name=this.prevEvent=null}},{key:"getPointerIndex",value:function(e){var t=ae(e);return"mouse"===this.pointerType||"pen"===this.pointerType?this.pointers.length-1:be(this.pointers,(function(e){return e.id===t}))}},{key:"getPointerInfo",value:function(e){return this.pointers[this.getPointerIndex(e)]}},{key:"updatePointer",value:function(e,t,n,i){var o,r,s,a=ae(e),l=this.getPointerIndex(e),c=this.pointers[l];return i=!1!==i&&(i||/(down|start)$/i.test(t.type)),c?c.pointer=e:(c=new St(a,e,t,null,null),l=this.pointers.length,this.pointers.push(c)),le(this.coords.cur,this.pointers.map((function(e){return e.pointer})),this._now()),o=this.coords.delta,r=this.coords.prev,s=this.coords.cur,o.page.x=s.page.x-r.page.x,o.page.y=s.page.y-r.page.y,o.client.x=s.client.x-r.client.x,o.client.y=s.client.y-r.client.y,o.timeStamp=s.timeStamp-r.timeStamp,i&&(this.pointerIsDown=!0,c.downTime=this.coords.cur.timeStamp,c.downTarget=n,ee(this.downPointer,e),this.interacting()||(te(this.coords.start,this.coords.cur),te(this.coords.prev,this.coords.cur),this.downEvent=t,this.pointerWasMoved=!1)),this._updateLatestPointer(e,t,n),this._scopeFire("interactions:update-pointer",{pointer:e,event:t,eventTarget:n,down:i,pointerInfo:c,pointerIndex:l,interaction:this}),l}},{key:"removePointer",value:function(e,t){var n=this.getPointerIndex(e);if(-1!==n){var i=this.pointers[n];this._scopeFire("interactions:remove-pointer",{pointer:e,event:t,eventTarget:null,pointerIndex:n,pointerInfo:i,interaction:this}),this.pointers.splice(n,1),this.pointerIsDown=!1}}},{key:"_updateLatestPointer",value:function(e,t,n){this._latestPointer.pointer=e,this._latestPointer.event=t,this._latestPointer.eventTarget=n}},{key:"destroy",value:function(){this._latestPointer.pointer=null,this._latestPointer.event=null,this._latestPointer.eventTarget=null}},{key:"_createPreparedEvent",value:function(e,t,n,i){return new wt(this,e,this.prepared.name,t,this.element,n,i)}},{key:"_fireEvent",value:function(e){var t;null==(t=this.interactable)||t.fire(e),(!this.prevEvent||e.timeStamp>=this.prevEvent.timeStamp)&&(this.prevEvent=e)}},{key:"_doPhase",value:function(e){var t=e.event,n=e.phase,i=e.preEnd,o=e.type,r=this.rect;if(r&&"move"===n&&(X(this.edges,r,this.coords.delta[this.interactable.options.deltaSource]),r.width=r.right-r.left,r.height=r.bottom-r.top),!1===this._scopeFire("interactions:before-action-".concat(n),e))return!1;var s=e.iEvent=this._createPreparedEvent(t,n,i,o);return this._scopeFire("interactions:action-".concat(n),e),"start"===n&&(this.prevEvent=s),this._fireEvent(s),this._scopeFire("interactions:after-action-".concat(n),e),!0}},{key:"_now",value:function(){return Date.now()}}]),e}();function Pt(e){It(e.interaction)}function It(e){if(!(t=e).offset.pending.x&&!t.offset.pending.y)return!1;var t,n=e.offset.pending;return Ot(e.coords.cur,n),Ot(e.coords.delta,n),X(e.edges,e.rect,n),n.x=0,n.y=0,!0}function Mt(e){var t=e.x,n=e.y;this.offset.pending.x+=t,this.offset.pending.y+=n,this.offset.total.x+=t,this.offset.total.y+=n}function Ot(e,t){var n=e.page,i=e.client,o=t.x,r=t.y;n.x+=o,n.y+=r,i.x+=o,i.y+=r}Et.offsetBy="";var At={id:"offset",before:["modifiers","pointer-events","actions","inertia"],install:function(e){e.Interaction.prototype.offsetBy=Mt},listeners:{"interactions:new":function(e){e.interaction.offset={total:{x:0,y:0},pending:{x:0,y:0}}},"interactions:update-pointer":function(e){var t;(t=e.interaction).pointerIsDown&&(Ot(t.coords.cur,t.offset.total),t.offset.pending.x=0,t.offset.pending.y=0)},"interactions:before-action-start":Pt,"interactions:before-action-move":Pt,"interactions:before-action-end":function(e){var t=e.interaction;if(It(t))return t.move({offset:!0}),t.end(),!1},"interactions:stop":function(e){var t=e.interaction;t.offset.total.x=0,t.offset.total.y=0,t.offset.pending.x=0,t.offset.pending.y=0}}},_t=function(){function e(t){i(this,e),this.active=!1,this.isModified=!1,this.smoothEnd=!1,this.allowResume=!1,this.modification=void 0,this.modifierCount=0,this.modifierArg=void 0,this.startCoords=void 0,this.t0=0,this.v0=0,this.te=0,this.targetOffset=void 0,this.modifiedOffset=void 0,this.currentOffset=void 0,this.lambda_v0=0,this.one_ve_v0=0,this.timeout=void 0,this.interaction=void 0,this.interaction=t}return r(e,[{key:"start",value:function(e){var t=this.interaction,n=Dt(t);if(!n||!n.enabled)return!1;var i=t.coords.velocity.client,o=Q(i.x,i.y),r=this.modification||(this.modification=new gt(t));if(r.copyFrom(t.modification),this.t0=t._now(),this.allowResume=n.allowResume,this.v0=o,this.currentOffset={x:0,y:0},this.startCoords=t.coords.cur.page,this.modifierArg=r.fillArg({pageCoords:this.startCoords,preEnd:!0,phase:"inertiastart"}),this.t0-t.coords.cur.timeStamp<50&&o>n.minSpeed&&o>n.endSpeed)this.startInertia();else{if(r.result=r.setAll(this.modifierArg),!r.result.changed)return!1;this.startSmoothEnd()}return t.modification.result.rect=null,t.offsetBy(this.targetOffset),t._doPhase({interaction:t,event:e,phase:"inertiastart"}),t.offsetBy({x:-this.targetOffset.x,y:-this.targetOffset.y}),t.modification.result.rect=null,this.active=!0,t.simulation=this,!0}},{key:"startInertia",value:function(){var e=this,t=this.interaction.coords.velocity.client,n=Dt(this.interaction),i=n.resistance,o=-Math.log(n.endSpeed/this.v0)/i;this.targetOffset={x:(t.x-o)/i,y:(t.y-o)/i},this.te=o,this.lambda_v0=i/this.v0,this.one_ve_v0=1-n.endSpeed/this.v0;var r=this.modification,s=this.modifierArg;s.pageCoords={x:this.startCoords.x+this.targetOffset.x,y:this.startCoords.y+this.targetOffset.y},r.result=r.setAll(s),r.result.changed&&(this.isModified=!0,this.modifiedOffset={x:this.targetOffset.x+r.result.delta.x,y:this.targetOffset.y+r.result.delta.y}),this.onNextFrame((function(){return e.inertiaTick()}))}},{key:"startSmoothEnd",value:function(){var e=this;this.smoothEnd=!0,this.isModified=!0,this.targetOffset={x:this.modification.result.delta.x,y:this.modification.result.delta.y},this.onNextFrame((function(){return e.smoothEndTick()}))}},{key:"onNextFrame",value:function(e){var t=this;this.timeout=qe.request((function(){t.active&&e()}))}},{key:"inertiaTick",value:function(){var e,t,n,i,o,r,s,a=this,l=this.interaction,c=Dt(l).resistance,d=(l._now()-this.t0)/1e3;if(d<this.te){var h,u=1-(Math.exp(-c*d)-this.lambda_v0)/this.one_ve_v0;this.isModified?(e=0,t=0,n=this.targetOffset.x,i=this.targetOffset.y,o=this.modifiedOffset.x,r=this.modifiedOffset.y,h={x:Rt(s=u,e,n,o),y:Rt(s,t,i,r)}):h={x:this.targetOffset.x*u,y:this.targetOffset.y*u};var p={x:h.x-this.currentOffset.x,y:h.y-this.currentOffset.y};this.currentOffset.x+=p.x,this.currentOffset.y+=p.y,l.offsetBy(p),l.move(),this.onNextFrame((function(){return a.inertiaTick()}))}else l.offsetBy({x:this.modifiedOffset.x-this.currentOffset.x,y:this.modifiedOffset.y-this.currentOffset.y}),this.end()}},{key:"smoothEndTick",value:function(){var e=this,t=this.interaction,n=t._now()-this.t0,i=Dt(t).smoothEndDuration;if(n<i){var o={x:zt(n,0,this.targetOffset.x,i),y:zt(n,0,this.targetOffset.y,i)},r={x:o.x-this.currentOffset.x,y:o.y-this.currentOffset.y};this.currentOffset.x+=r.x,this.currentOffset.y+=r.y,t.offsetBy(r),t.move({skipModifiers:this.modifierCount}),this.onNextFrame((function(){return e.smoothEndTick()}))}else t.offsetBy({x:this.targetOffset.x-this.currentOffset.x,y:this.targetOffset.y-this.currentOffset.y}),this.end()}},{key:"resume",value:function(e){var t=e.pointer,n=e.event,i=e.eventTarget,o=this.interaction;o.offsetBy({x:-this.currentOffset.x,y:-this.currentOffset.y}),o.updatePointer(t,n,i,!0),o._doPhase({interaction:o,event:n,phase:"resume"}),te(o.coords.prev,o.coords.cur),this.stop()}},{key:"end",value:function(){this.interaction.move(),this.interaction.end(),this.stop()}},{key:"stop",value:function(){this.active=this.smoothEnd=!1,this.interaction.simulation=null,qe.cancel(this.timeout)}}]),e}();function Dt(e){var t=e.interactable,n=e.prepared;return t&&t.options&&n.name&&t.options[n.name].inertia}function Rt(e,t,n,i){var o=1-e;return o*o*t+2*o*e*n+e*e*i}function zt(e,t,n,i){return-n*(e/=i)*(e-2)+t}var Bt={id:"inertia",before:["modifiers","actions"],install:function(e){var t=e.defaults;e.usePlugin(At),e.usePlugin(bt),e.actions.phases.inertiastart=!0,e.actions.phases.resume=!0,t.perAction.inertia={enabled:!1,resistance:10,minSpeed:100,endSpeed:10,allowResume:!0,smoothEndDuration:300}},listeners:{"interactions:new":function(e){var t=e.interaction;t.inertia=new _t(t)},"interactions:before-action-end":function(e){var t=e.interaction,n=e.event;return(!t._interacting||t.simulation||!t.inertia.start(n))&&null},"interactions:down":function(e){var t=e.interaction,n=e.eventTarget,i=t.inertia;if(i.active)for(var o=n;w.element(o);){if(o===t.element){i.resume(e);break}o=_(o)}},"interactions:stop":function(e){var t=e.interaction.inertia;t.active&&t.stop()},"interactions:before-action-resume":function(e){var t=e.interaction.modification;t.stop(e),t.start(e,e.interaction.coords.cur.page),t.applyToInteraction(e)},"interactions:before-action-inertiastart":function(e){return e.interaction.modification.setAndApply(e)},"interactions:action-resume":vt,"interactions:action-inertiastart":vt,"interactions:after-action-inertiastart":function(e){return e.interaction.modification.restoreInteractionCoords(e)},"interactions:after-action-resume":function(e){return e.interaction.modification.restoreInteractionCoords(e)}}};function Ft(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e.immediatePropagationStopped)break;i(e)}}var jt=function(){function e(t){i(this,e),this.options=void 0,this.types={},this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.global=void 0,this.options=W({},t||{})}return r(e,[{key:"fire",value:function(e){var t,n=this.global;(t=this.types[e.type])&&Ft(e,t),!e.propagationStopped&&n&&(t=n[e.type])&&Ft(e,t)}},{key:"on",value:function(e,t){var n=Z(e,t);for(e in n)this.types[e]=ye(this.types[e]||[],n[e])}},{key:"off",value:function(e,t){var n=Z(e,t);for(e in n){var i=this.types[e];if(i&&i.length)for(var o=0,r=n[e];o<r.length;o++){var s=r[o],a=i.indexOf(s);-1!==a&&i.splice(a,1)}}}},{key:"getRect",value:function(e){return null}}]),e}(),Lt=function(){function e(t){i(this,e),this.currentTarget=void 0,this.originalEvent=void 0,this.type=void 0,this.originalEvent=t,ee(this,t)}return r(e,[{key:"preventOriginalDefault",value:function(){this.originalEvent.preventDefault()}},{key:"stopPropagation",value:function(){this.originalEvent.stopPropagation()}},{key:"stopImmediatePropagation",value:function(){this.originalEvent.stopImmediatePropagation()}}]),e}();function qt(e){return w.object(e)?{capture:!!e.capture,passive:!!e.passive}:{capture:!!e,passive:!1}}function Kt(e,t){return e===t||("boolean"==typeof e?!!t.capture===e&&0==!!t.passive:!!e.capture==!!t.capture&&!!e.passive==!!t.passive)}var Wt={id:"events",install:function(e){var t,n=[],i={},o=[],r={add:s,remove:a,addDelegate:function(e,t,n,r,a){var d=qt(a);if(!i[n]){i[n]=[];for(var h=0;h<o.length;h++){var u=o[h];s(u,n,l),s(u,n,c,!0)}}var p=i[n],f=xe(p,(function(n){return n.selector===e&&n.context===t}));f||(f={selector:e,context:t,listeners:[]},p.push(f)),f.listeners.push({func:r,options:d})},removeDelegate:function(e,t,n,o,r){var s,d=qt(r),h=i[n],u=!1;if(h)for(s=h.length-1;s>=0;s--){var p=h[s];if(p.selector===e&&p.context===t){for(var f=p.listeners,g=f.length-1;g>=0;g--){var m=f[g];if(m.func===o&&Kt(m.options,d)){f.splice(g,1),f.length||(h.splice(s,1),a(t,n,l),a(t,n,c,!0)),u=!0;break}}if(u)break}}},delegateListener:l,delegateUseCapture:c,delegatedEvents:i,documents:o,targets:n,supportsOptions:!1,supportsPassive:!1};function s(e,t,i,o){if(e.addEventListener){var s=qt(o),a=xe(n,(function(t){return t.eventTarget===e}));a||(a={eventTarget:e,events:{}},n.push(a)),a.events[t]||(a.events[t]=[]),xe(a.events[t],(function(e){return e.func===i&&Kt(e.options,s)}))||(e.addEventListener(t,i,r.supportsOptions?s:s.capture),a.events[t].push({func:i,options:s}))}}function a(e,t,i,o){if(e.addEventListener&&e.removeEventListener){var s=be(n,(function(t){return t.eventTarget===e})),l=n[s];if(l&&l.events)if("all"!==t){var c=!1,d=l.events[t];if(d){if("all"===i){for(var h=d.length-1;h>=0;h--){var u=d[h];a(e,t,u.func,u.options)}return}for(var p=qt(o),f=0;f<d.length;f++){var g=d[f];if(g.func===i&&Kt(g.options,p)){e.removeEventListener(t,i,r.supportsOptions?p:p.capture),d.splice(f,1),0===d.length&&(delete l.events[t],c=!0);break}}}c&&!Object.keys(l.events).length&&n.splice(s,1)}else for(t in l.events)l.events.hasOwnProperty(t)&&a(e,t,"all")}}function l(e,t){for(var n=qt(t),o=new Lt(e),r=i[e.type],s=ge(e)[0],a=s;w.element(a);){for(var l=0;l<r.length;l++){var c=r[l],d=c.selector,h=c.context;if(D(a,d)&&O(h,s)&&O(h,a)){var u=c.listeners;o.currentTarget=a;for(var p=0;p<u.length;p++){var f=u[p];Kt(f.options,n)&&f.func(o)}}}a=_(a)}}function c(e){return l(e,!0)}return null==(t=e.document)||t.createElement("div").addEventListener("test",null,{get capture(){return r.supportsOptions=!0},get passive(){return r.supportsPassive=!0}}),e.events=r,r}},$t={methodOrder:["simulationResume","mouseOrPen","hasPointer","idle"],search:function(e){for(var t=0,n=$t.methodOrder;t<n.length;t++){var i=n[t],o=$t[i](e);if(o)return o}return null},simulationResume:function(e){var t=e.pointerType,n=e.eventType,i=e.eventTarget,o=e.scope;if(!/down|start/i.test(n))return null;for(var r=0,s=o.interactions.list;r<s.length;r++){var a=s[r],l=i;if(a.simulation&&a.simulation.allowResume&&a.pointerType===t)for(;l;){if(l===a.element)return a;l=_(l)}}return null},mouseOrPen:function(e){var t,n=e.pointerId,i=e.pointerType,o=e.eventType,r=e.scope;if("mouse"!==i&&"pen"!==i)return null;for(var s=0,a=r.interactions.list;s<a.length;s++){var l=a[s];if(l.pointerType===i){if(l.simulation&&!Vt(l,n))continue;if(l.interacting())return l;t||(t=l)}}if(t)return t;for(var c=0,d=r.interactions.list;c<d.length;c++){var h=d[c];if(!(h.pointerType!==i||/down/i.test(o)&&h.simulation))return h}return null},hasPointer:function(e){for(var t=e.pointerId,n=0,i=e.scope.interactions.list;n<i.length;n++){var o=i[n];if(Vt(o,t))return o}return null},idle:function(e){for(var t=e.pointerType,n=0,i=e.scope.interactions.list;n<i.length;n++){var o=i[n];if(1===o.pointers.length){var r=o.interactable;if(r&&(!r.options.gesture||!r.options.gesture.enabled))continue}else if(o.pointers.length>=2)continue;if(!o.interacting()&&t===o.pointerType)return o}return null}};function Vt(e,t){return e.pointers.some((function(e){return e.id===t}))}var Ut=$t,Ht=["pointerDown","pointerMove","pointerUp","updatePointer","removePointer","windowBlur"];function Xt(e,t){return function(n){var i=t.interactions.list,o=fe(n),r=ge(n),s=r[0],a=r[1],l=[];if(/^touch/.test(n.type)){t.prevTouchTime=t.now();for(var c=0,d=n.changedTouches;c<d.length;c++){var h=d[c],u={pointer:h,pointerId:ae(h),pointerType:o,eventType:n.type,eventTarget:s,curEventTarget:a,scope:t},p=Yt(u);l.push([u.pointer,u.eventTarget,u.curEventTarget,p])}}else{var f=!1;if(!M.supportsPointerEvent&&/mouse/.test(n.type)){for(var g=0;g<i.length&&!f;g++)f="mouse"!==i[g].pointerType&&i[g].pointerIsDown;f=f||t.now()-t.prevTouchTime<500||0===n.timeStamp}if(!f){var m={pointer:n,pointerId:ae(n),pointerType:o,eventType:n.type,curEventTarget:a,eventTarget:s,scope:t},y=Yt(m);l.push([m.pointer,m.eventTarget,m.curEventTarget,y])}}for(var v=0;v<l.length;v++){var b=l[v],x=b[0],w=b[1],T=b[2];b[3][e](x,n,w,T)}}}function Yt(e){var t=e.pointerType,n=e.scope,i={interaction:Ut.search(e),searchDetails:e};return n.fire("interactions:find",i),i.interaction||n.interactions.new({pointerType:t})}function Zt(e,t){var n=e.doc,i=e.scope,o=e.options,r=i.interactions.docEvents,s=i.events,a=s[t];for(var l in i.browser.isIOS&&!o.events&&(o.events={passive:!1}),s.delegatedEvents)a(n,l,s.delegateListener),a(n,l,s.delegateUseCapture,!0);for(var c=o&&o.events,d=0;d<r.length;d++){var h=r[d];a(n,h.type,h.listener,c)}}var Gt={id:"core/interactions",install:function(e){for(var t={},n=0;n<Ht.length;n++){var o=Ht[n];t[o]=Xt(o,e)}var s,l=M.pEventTypes;function c(){for(var t=0,n=e.interactions.list;t<n.length;t++){var i=n[t];if(i.pointerIsDown&&"touch"===i.pointerType&&!i._interacting)for(var o=function(){var t=s[r];e.documents.some((function(e){return O(e.doc,t.downTarget)}))||i.removePointer(t.pointer,t.event)},r=0,s=i.pointers;r<s.length;r++)o()}}(s=P.PointerEvent?[{type:l.down,listener:c},{type:l.down,listener:t.pointerDown},{type:l.move,listener:t.pointerMove},{type:l.up,listener:t.pointerUp},{type:l.cancel,listener:t.pointerUp}]:[{type:"mousedown",listener:t.pointerDown},{type:"mousemove",listener:t.pointerMove},{type:"mouseup",listener:t.pointerUp},{type:"touchstart",listener:c},{type:"touchstart",listener:t.pointerDown},{type:"touchmove",listener:t.pointerMove},{type:"touchend",listener:t.pointerUp},{type:"touchcancel",listener:t.pointerUp}]).push({type:"blur",listener:function(t){for(var n=0,i=e.interactions.list;n<i.length;n++)i[n].documentBlur(t)}}),e.prevTouchTime=0,e.Interaction=function(t){a(o,t);var n=h(o);function o(){return i(this,o),n.apply(this,arguments)}return r(o,[{key:"pointerMoveTolerance",get:function(){return e.interactions.pointerMoveTolerance},set:function(t){e.interactions.pointerMoveTolerance=t}},{key:"_now",value:function(){return e.now()}}]),o}(Ct),e.interactions={list:[],new:function(t){t.scopeFire=function(t,n){return e.fire(t,n)};var n=new e.Interaction(t);return e.interactions.list.push(n),n},listeners:t,docEvents:s,pointerMoveTolerance:1},e.usePlugin(ut)},listeners:{"scope:add-document":function(e){return Zt(e,"add")},"scope:remove-document":function(e){return Zt(e,"remove")},"interactable:unset":function(e,t){for(var n=e.interactable,i=t.interactions.list.length-1;i>=0;i--){var o=t.interactions.list[i];o.interactable===n&&(o.stop(),t.fire("interactions:destroy",{interaction:o}),o.destroy(),t.interactions.list.length>2&&t.interactions.list.splice(i,1))}}},onDocSignal:Zt,doOnInteractions:Xt,methodNames:Ht},Qt=Gt,Jt=function(e){return e[e.On=0]="On",e[e.Off=1]="Off",e}(Jt||{}),en=function(){function e(t,n,o,r){i(this,e),this.target=void 0,this.options=void 0,this._actions=void 0,this.events=new jt,this._context=void 0,this._win=void 0,this._doc=void 0,this._scopeEvents=void 0,this._actions=n.actions,this.target=t,this._context=n.context||o,this._win=v(K(t)?this._context:t),this._doc=this._win.document,this._scopeEvents=r,this.set(n)}return r(e,[{key:"_defaults",get:function(){return{base:{},perAction:{},actions:{}}}},{key:"setOnEvents",value:function(e,t){return w.func(t.onstart)&&this.on("".concat(e,"start"),t.onstart),w.func(t.onmove)&&this.on("".concat(e,"move"),t.onmove),w.func(t.onend)&&this.on("".concat(e,"end"),t.onend),w.func(t.oninertiastart)&&this.on("".concat(e,"inertiastart"),t.oninertiastart),this}},{key:"updatePerActionListeners",value:function(e,t,n){var i,o=this,r=null==(i=this._actions.map[e])?void 0:i.filterEventType,s=function(e){return(null==r||r(e))&&pt(e,o._actions)};(w.array(t)||w.object(t))&&this._onOff(Jt.Off,e,t,void 0,s),(w.array(n)||w.object(n))&&this._onOff(Jt.On,e,n,void 0,s)}},{key:"setPerAction",value:function(e,t){var n=this._defaults;for(var i in t){var o=i,r=this.options[e],s=t[o];"listeners"===o&&this.updatePerActionListeners(e,r.listeners,s),w.array(s)?r[o]=ve(s):w.plainObject(s)?(r[o]=W(r[o]||{},ft(s)),w.object(n.perAction[o])&&"enabled"in n.perAction[o]&&(r[o].enabled=!1!==s.enabled)):w.bool(s)&&w.object(n.perAction[o])?r[o].enabled=s:r[o]=s}}},{key:"getRect",value:function(e){return e=e||(w.element(this.target)?this.target:null),w.string(this.target)&&(e=e||this._context.querySelector(this.target)),L(e)}},{key:"rectChecker",value:function(e){var t=this;return w.func(e)?(this.getRect=function(n){var i=W({},e.apply(t,n));return"width"in i||(i.width=i.right-i.left,i.height=i.bottom-i.top),i},this):null===e?(delete this.getRect,this):this.getRect}},{key:"_backCompatOption",value:function(e,t){if(K(t)||w.object(t)){for(var n in this.options[e]=t,this._actions.map)this.options[n][e]=t;return this}return this.options[e]}},{key:"origin",value:function(e){return this._backCompatOption("origin",e)}},{key:"deltaSource",value:function(e){return"page"===e||"client"===e?(this.options.deltaSource=e,this):this.options.deltaSource}},{key:"getAllElements",value:function(){var e=this.target;return w.string(e)?Array.from(this._context.querySelectorAll(e)):w.func(e)&&e.getAllElements?e.getAllElements():w.element(e)?[e]:[]}},{key:"context",value:function(){return this._context}},{key:"inContext",value:function(e){return this._context===e.ownerDocument||O(this._context,e)}},{key:"testIgnoreAllow",value:function(e,t,n){return!this.testIgnore(e.ignoreFrom,t,n)&&this.testAllow(e.allowFrom,t,n)}},{key:"testAllow",value:function(e,t,n){return!e||!!w.element(n)&&(w.string(e)?B(n,e,t):!!w.element(e)&&O(e,n))}},{key:"testIgnore",value:function(e,t,n){return!(!e||!w.element(n))&&(w.string(e)?B(n,e,t):!!w.element(e)&&O(e,n))}},{key:"fire",value:function(e){return this.events.fire(e),this}},{key:"_onOff",value:function(e,t,n,i,o){w.object(t)&&!w.array(t)&&(i=n,n=null);var r=Z(t,n,o);for(var s in r){"wheel"===s&&(s=M.wheelEvent);for(var a=0,l=r[s];a<l.length;a++){var c=l[a];pt(s,this._actions)?this.events[e===Jt.On?"on":"off"](s,c):w.string(this.target)?this._scopeEvents[e===Jt.On?"addDelegate":"removeDelegate"](this.target,this._context,s,c,i):this._scopeEvents[e===Jt.On?"add":"remove"](this.target,s,c,i)}}return this}},{key:"on",value:function(e,t,n){return this._onOff(Jt.On,e,t,n)}},{key:"off",value:function(e,t,n){return this._onOff(Jt.Off,e,t,n)}},{key:"set",value:function(e){var t=this._defaults;for(var n in w.object(e)||(e={}),this.options=ft(t.base),this._actions.methodDict){var i=n,o=this._actions.methodDict[i];this.options[i]={},this.setPerAction(i,W(W({},t.perAction),t.actions[i])),this[o](e[i])}for(var r in e)"getRect"!==r?w.func(this[r])&&this[r](e[r]):this.rectChecker(e.getRect);return this}},{key:"unset",value:function(){if(w.string(this.target))for(var e in this._scopeEvents.delegatedEvents)for(var t=this._scopeEvents.delegatedEvents[e],n=t.length-1;n>=0;n--){var i=t[n],o=i.selector,r=i.context,s=i.listeners;o===this.target&&r===this._context&&t.splice(n,1);for(var a=s.length-1;a>=0;a--)this._scopeEvents.removeDelegate(this.target,this._context,e,s[a][0],s[a][1])}else this._scopeEvents.remove(this.target,"all")}}]),e}(),tn=function(){function e(t){var n=this;i(this,e),this.list=[],this.selectorMap={},this.scope=void 0,this.scope=t,t.addListeners({"interactable:unset":function(e){var t=e.interactable,i=t.target,o=w.string(i)?n.selectorMap[i]:i[n.scope.id],r=be(o,(function(e){return e===t}));o.splice(r,1)}})}return r(e,[{key:"new",value:function(e,t){t=W(t||{},{actions:this.scope.actions});var n=new this.scope.Interactable(e,t,this.scope.document,this.scope.events);return this.scope.addDocument(n._doc),this.list.push(n),w.string(e)?(this.selectorMap[e]||(this.selectorMap[e]=[]),this.selectorMap[e].push(n)):(n.target[this.scope.id]||Object.defineProperty(e,this.scope.id,{value:[],configurable:!0}),e[this.scope.id].push(n)),this.scope.fire("interactable:new",{target:e,options:t,interactable:n,win:this.scope._win}),n}},{key:"getExisting",value:function(e,t){var n=t&&t.context||this.scope.document,i=w.string(e),o=i?this.selectorMap[e]:e[this.scope.id];if(o)return xe(o,(function(t){return t._context===n&&(i||t.inContext(e))}))}},{key:"forEachMatch",value:function(e,t){for(var n=0,i=this.list;n<i.length;n++){var o=i[n],r=void 0;if((w.string(o.target)?w.element(e)&&D(e,o.target):e===o.target)&&o.inContext(e)&&(r=t(o)),void 0!==r)return r}}}]),e}(),nn=function(){function e(){var t,n,o=this;i(this,e),this.id="__interact_scope_".concat(Math.floor(100*Math.random())),this.isInitialized=!1,this.listenerMaps=[],this.browser=M,this.defaults=ft(xt),this.Eventable=jt,this.actions={map:{},phases:{start:!0,move:!0,end:!0},methodDict:{},phaselessTypes:{}},this.interactStatic=(t=this,(n=function e(n,i){var o=t.interactables.getExisting(n,i);return o||((o=t.interactables.new(n,i)).events.global=e.globalEvents),o}).getPointerAverage=de,n.getTouchBBox=he,n.getTouchDistance=ue,n.getTouchAngle=pe,n.getElementRect=L,n.getElementClientRect=j,n.matchesSelector=D,n.closest=A,n.globalEvents={},n.version="1.10.27",n.scope=t,n.use=function(e,t){return this.scope.usePlugin(e,t),this},n.isSet=function(e,t){return!!this.scope.interactables.get(e,t&&t.context)},n.on=Ue((function(e,t,n){if(w.string(e)&&-1!==e.search(" ")&&(e=e.trim().split(/ +/)),w.array(e)){for(var i=0,o=e;i<o.length;i++){var r=o[i];this.on(r,t,n)}return this}if(w.object(e)){for(var s in e)this.on(s,e[s],t);return this}return pt(e,this.scope.actions)?this.globalEvents[e]?this.globalEvents[e].push(t):this.globalEvents[e]=[t]:this.scope.events.add(this.scope.document,e,t,{options:n}),this}),"The interact.on() method is being deprecated"),n.off=Ue((function(e,t,n){if(w.string(e)&&-1!==e.search(" ")&&(e=e.trim().split(/ +/)),w.array(e)){for(var i=0,o=e;i<o.length;i++){var r=o[i];this.off(r,t,n)}return this}if(w.object(e)){for(var s in e)this.off(s,e[s],t);return this}var a;return pt(e,this.scope.actions)?e in this.globalEvents&&-1!==(a=this.globalEvents[e].indexOf(t))&&this.globalEvents[e].splice(a,1):this.scope.events.remove(this.scope.document,e,t,n),this}),"The interact.off() method is being deprecated"),n.debug=function(){return this.scope},n.supportsTouch=function(){return M.supportsTouch},n.supportsPointerEvent=function(){return M.supportsPointerEvent},n.stop=function(){for(var e=0,t=this.scope.interactions.list;e<t.length;e++)t[e].stop();return this},n.pointerMoveTolerance=function(e){return w.number(e)?(this.scope.interactions.pointerMoveTolerance=e,this):this.scope.interactions.pointerMoveTolerance},n.addDocument=function(e,t){this.scope.addDocument(e,t)},n.removeDocument=function(e){this.scope.removeDocument(e)},n),this.InteractEvent=wt,this.Interactable=void 0,this.interactables=new tn(this),this._win=void 0,this.document=void 0,this.window=void 0,this.documents=[],this._plugins={list:[],map:{}},this.onWindowUnload=function(e){return o.removeDocument(e.target)};var s=this;this.Interactable=function(e){a(n,e);var t=h(n);function n(){return i(this,n),t.apply(this,arguments)}return r(n,[{key:"_defaults",get:function(){return s.defaults}},{key:"set",value:function(e){return u(l(n.prototype),"set",this).call(this,e),s.fire("interactable:set",{options:e,interactable:this}),this}},{key:"unset",value:function(){u(l(n.prototype),"unset",this).call(this);var e=s.interactables.list.indexOf(this);e<0||(s.interactables.list.splice(e,1),s.fire("interactable:unset",{interactable:this}))}}]),n}(en)}return r(e,[{key:"addListeners",value:function(e,t){this.listenerMaps.push({id:t,map:e})}},{key:"fire",value:function(e,t){for(var n=0,i=this.listenerMaps;n<i.length;n++){var o=i[n].map[e];if(o&&!1===o(t,this,e))return!1}}},{key:"init",value:function(e){return this.isInitialized?this:(n=e,(t=this).isInitialized=!0,w.window(n)&&y(n),P.init(n),M.init(n),qe.init(n),t.window=n,t.document=n.document,t.usePlugin(Qt),t.usePlugin(Wt),t);var t,n}},{key:"pluginIsInstalled",value:function(e){var t=e.id;return t?!!this._plugins.map[t]:-1!==this._plugins.list.indexOf(e)}},{key:"usePlugin",value:function(e,t){if(!this.isInitialized)return this;if(this.pluginIsInstalled(e))return this;if(e.id&&(this._plugins.map[e.id]=e),this._plugins.list.push(e),e.install&&e.install(this,t),e.listeners&&e.before){for(var n=0,i=this.listenerMaps.length,o=e.before.reduce((function(e,t){return e[t]=!0,e[on(t)]=!0,e}),{});n<i;n++){var r=this.listenerMaps[n].id;if(r&&(o[r]||o[on(r)]))break}this.listenerMaps.splice(n,0,{id:e.id,map:e.listeners})}else e.listeners&&this.listenerMaps.push({id:e.id,map:e.listeners});return this}},{key:"addDocument",value:function(e,t){if(-1!==this.getDocIndex(e))return!1;var n=v(e);t=t?W({},t):{},this.documents.push({doc:e,options:t}),this.events.documents.push(e),e!==this.document&&this.events.add(n,"unload",this.onWindowUnload),this.fire("scope:add-document",{doc:e,window:n,scope:this,options:t})}},{key:"removeDocument",value:function(e){var t=this.getDocIndex(e),n=v(e),i=this.documents[t].options;this.events.remove(n,"unload",this.onWindowUnload),this.documents.splice(t,1),this.events.documents.splice(t,1),this.fire("scope:remove-document",{doc:e,window:n,scope:this,options:i})}},{key:"getDocIndex",value:function(e){for(var t=0;t<this.documents.length;t++)if(this.documents[t].doc===e)return t;return-1}},{key:"getDocOptions",value:function(e){var t=this.getDocIndex(e);return-1===t?null:this.documents[t].options}},{key:"now",value:function(){return(this.window.Date||Date).now()}}]),e}();function on(e){return e&&e.replace(/\/.*$/,"")}var rn=new nn,sn=rn.interactStatic,an="undefined"!=typeof globalThis?globalThis:window;rn.init(an);var ln=Object.freeze({__proto__:null,edgeTarget:function(){},elements:function(){},grid:function(e){var t=[["x","y"],["left","top"],["right","bottom"],["width","height"]].filter((function(t){var n=t[0],i=t[1];return n in e||i in e})),n=function(n,i){for(var o=e.range,r=e.limits,s=void 0===r?{left:-1/0,right:1/0,top:-1/0,bottom:1/0}:r,a=e.offset,l=void 0===a?{x:0,y:0}:a,c={range:o,grid:e,x:null,y:null},d=0;d<t.length;d++){var h=t[d],u=h[0],p=h[1],f=Math.round((n-l.x)/e[u]),g=Math.round((i-l.y)/e[p]);c[u]=Math.max(s.left,Math.min(s.right,f*e[u]+l.x)),c[p]=Math.max(s.top,Math.min(s.bottom,g*e[p]+l.y))}return c};return n.grid=e,n.coordFields=t,n}}),cn={id:"snappers",install:function(e){var t=e.interactStatic;t.snappers=W(t.snappers||{},ln),t.createSnapGrid=t.snappers.grid}},dn={start:function(e){var n=e.state,i=e.rect,o=e.edges,r=e.pageCoords,s=n.options,a=s.ratio,l=s.enabled,c=n.options,d=c.equalDelta,h=c.modifiers;"preserve"===a&&(a=i.width/i.height),n.startCoords=W({},r),n.startRect=W({},i),n.ratio=a,n.equalDelta=d;var u=n.linkedEdges={top:o.top||o.left&&!o.bottom,left:o.left||o.top&&!o.right,bottom:o.bottom||o.right&&!o.top,right:o.right||o.bottom&&!o.left};if(n.xIsPrimaryAxis=!(!o.left&&!o.right),n.equalDelta){var p=(u.left?1:-1)*(u.top?1:-1);n.edgeSign={x:p,y:p}}else n.edgeSign={x:u.left?-1:1,y:u.top?-1:1};if(!1!==l&&W(o,u),null!=h&&h.length){var f=new gt(e.interaction);f.copyFrom(e.interaction.modification),f.prepareStates(h),n.subModification=f,f.startAll(t({},e))}},set:function(e){var n=e.state,i=e.rect,o=e.coords,r=n.linkedEdges,s=W({},o),a=n.equalDelta?hn:un;if(W(e.edges,r),a(n,n.xIsPrimaryAxis,o,i),!n.subModification)return null;var l=W({},i);X(r,l,{x:o.x-s.x,y:o.y-s.y});var c=n.subModification.setAll(t(t({},e),{},{rect:l,edges:r,pageCoords:o,prevCoords:o,prevRect:l})),d=c.delta;return c.changed&&(a(n,Math.abs(d.x)>Math.abs(d.y),c.coords,c.rect),W(o,c.coords)),c.eventProps},defaults:{ratio:"preserve",equalDelta:!1,modifiers:[],enabled:!1}};function hn(e,t,n){var i=e.startCoords,o=e.edgeSign;t?n.y=i.y+(n.x-i.x)*o.y:n.x=i.x+(n.y-i.y)*o.x}function un(e,t,n,i){var o=e.startRect,r=e.startCoords,s=e.ratio,a=e.edgeSign;if(t){var l=i.width/s;n.y=r.y+(l-o.height)*a.y}else{var c=i.height*s;n.x=r.x+(c-o.width)*a.x}}var pn=yt(dn,"aspectRatio"),fn=function(){};fn._defaults={};var gn=fn;function mn(e,t,n){return w.func(e)?V(e,t.interactable,t.element,[n.x,n.y,t]):V(e,t.interactable,t.element)}var yn={start:function(e){var t=e.rect,n=e.startOffset,i=e.state,o=e.interaction,r=e.pageCoords,s=i.options,a=s.elementRect,l=W({left:0,top:0,right:0,bottom:0},s.offset||{});if(t&&a){var c=mn(s.restriction,o,r);if(c){var d=c.right-c.left-t.width,h=c.bottom-c.top-t.height;d<0&&(l.left+=d,l.right+=d),h<0&&(l.top+=h,l.bottom+=h)}l.left+=n.left-t.width*a.left,l.top+=n.top-t.height*a.top,l.right+=n.right-t.width*(1-a.right),l.bottom+=n.bottom-t.height*(1-a.bottom)}i.offset=l},set:function(e){var t,n=e.coords,i=e.interaction,o=e.state,r=o.options,s=o.offset,a=mn(r.restriction,i,n);if(a){var l=(!(t=a)||"left"in t&&"top"in t||((t=W({},t)).left=t.x||0,t.top=t.y||0,t.right=t.right||t.left+t.width,t.bottom=t.bottom||t.top+t.height),t);n.x=Math.max(Math.min(l.right-s.right,n.x),l.left+s.left),n.y=Math.max(Math.min(l.bottom-s.bottom,n.y),l.top+s.top)}},defaults:{restriction:null,elementRect:null,offset:null,endOnly:!1,enabled:!1}},vn=yt(yn,"restrict"),bn={top:1/0,left:1/0,bottom:-1/0,right:-1/0},xn={top:-1/0,left:-1/0,bottom:1/0,right:1/0};function wn(e,t){for(var n=0,i=["top","left","bottom","right"];n<i.length;n++){var o=i[n];o in e||(e[o]=t[o])}return e}var Tn={noInner:bn,noOuter:xn,start:function(e){var t,n=e.interaction,i=e.startOffset,o=e.state,r=o.options;r&&(t=U(mn(r.offset,n,n.coords.start.page))),t=t||{x:0,y:0},o.offset={top:t.y+i.top,left:t.x+i.left,bottom:t.y-i.bottom,right:t.x-i.right}},set:function(e){var t=e.coords,n=e.edges,i=e.interaction,o=e.state,r=o.offset,s=o.options;if(n){var a=W({},t),l=mn(s.inner,i,a)||{},c=mn(s.outer,i,a)||{};wn(l,bn),wn(c,xn),n.top?t.y=Math.min(Math.max(c.top+r.top,a.y),l.top+r.top):n.bottom&&(t.y=Math.max(Math.min(c.bottom+r.bottom,a.y),l.bottom+r.bottom)),n.left?t.x=Math.min(Math.max(c.left+r.left,a.x),l.left+r.left):n.right&&(t.x=Math.max(Math.min(c.right+r.right,a.x),l.right+r.right))}},defaults:{inner:null,outer:null,offset:null,endOnly:!1,enabled:!1}},Sn=yt(Tn,"restrictEdges"),kn=W({get elementRect(){return{top:0,left:0,bottom:1,right:1}},set elementRect(e){}},yn.defaults),En=yt({start:yn.start,set:yn.set,defaults:kn},"restrictRect"),Nn={width:-1/0,height:-1/0},Cn={width:1/0,height:1/0},Pn=yt({start:function(e){return Tn.start(e)},set:function(e){var t=e.interaction,n=e.state,i=e.rect,o=e.edges,r=n.options;if(o){var s=H(mn(r.min,t,e.coords))||Nn,a=H(mn(r.max,t,e.coords))||Cn;n.options={endOnly:r.endOnly,inner:W({},Tn.noInner),outer:W({},Tn.noOuter)},o.top?(n.options.inner.top=i.bottom-s.height,n.options.outer.top=i.bottom-a.height):o.bottom&&(n.options.inner.bottom=i.top+s.height,n.options.outer.bottom=i.top+a.height),o.left?(n.options.inner.left=i.right-s.width,n.options.outer.left=i.right-a.width):o.right&&(n.options.inner.right=i.left+s.width,n.options.outer.right=i.left+a.width),Tn.set(e),n.options=r}},defaults:{min:null,max:null,endOnly:!1,enabled:!1}},"restrictSize"),In={start:function(e){var t,n,i,o=e.interaction,r=e.interactable,s=e.element,a=e.rect,l=e.state,c=e.startOffset,d=l.options,h=d.offsetWithOrigin?(i=(n=e).interaction.element,U(V(n.state.options.origin,null,null,[i]))||Y(n.interactable,i,n.interaction.prepared.name)):{x:0,y:0};if("startCoords"===d.offset)t={x:o.coords.start.page.x,y:o.coords.start.page.y};else{var u=V(d.offset,r,s,[o]);(t=U(u)||{x:0,y:0}).x+=h.x,t.y+=h.y}var p=d.relativePoints;l.offsets=a&&p&&p.length?p.map((function(e,n){return{index:n,relativePoint:e,x:c.left-a.width*e.x+t.x,y:c.top-a.height*e.y+t.y}})):[{index:0,relativePoint:null,x:t.x,y:t.y}]},set:function(e){var t=e.interaction,n=e.coords,i=e.state,o=i.options,r=i.offsets,s=Y(t.interactable,t.element,t.prepared.name),a=W({},n),l=[];o.offsetWithOrigin||(a.x-=s.x,a.y-=s.y);for(var c=0,d=r;c<d.length;c++)for(var h=d[c],u=a.x-h.x,p=a.y-h.y,f=0,g=o.targets.length;f<g;f++){var m=o.targets[f],y=void 0;(y=w.func(m)?m(u,p,t._proxy,h,f):m)&&l.push({x:(w.number(y.x)?y.x:u)+h.x,y:(w.number(y.y)?y.y:p)+h.y,range:w.number(y.range)?y.range:o.range,source:m,index:f,offset:h})}for(var v={target:null,inRange:!1,distance:0,range:0,delta:{x:0,y:0}},b=0;b<l.length;b++){var x=l[b],T=x.range,S=x.x-a.x,k=x.y-a.y,E=Q(S,k),N=E<=T;T===1/0&&v.inRange&&v.range!==1/0&&(N=!1),v.target&&!(N?v.inRange&&T!==1/0?E/T<v.distance/v.range:T===1/0&&v.range!==1/0||E<v.distance:!v.inRange&&E<v.distance)||(v.target=x,v.distance=E,v.range=T,v.inRange=N,v.delta.x=S,v.delta.y=k)}return v.inRange&&(n.x=v.target.x,n.y=v.target.y),i.closest=v,v},defaults:{range:1/0,targets:null,offset:null,offsetWithOrigin:!0,origin:null,relativePoints:null,endOnly:!1,enabled:!1}},Mn=yt(In,"snap"),On={start:function(e){var t=e.state,n=e.edges,i=t.options;if(!n)return null;e.state={options:{targets:null,relativePoints:[{x:n.left?0:1,y:n.top?0:1}],offset:i.offset||"self",origin:{x:0,y:0},range:i.range}},t.targetFields=t.targetFields||[["width","height"],["x","y"]],In.start(e),t.offsets=e.state.offsets,e.state=t},set:function(e){var t=e.interaction,n=e.state,i=e.coords,o=n.options,r=n.offsets,s={x:i.x-r[0].x,y:i.y-r[0].y};n.options=W({},o),n.options.targets=[];for(var a=0,l=o.targets||[];a<l.length;a++){var c=l[a],d=void 0;if(d=w.func(c)?c(s.x,s.y,t):c){for(var h=0,u=n.targetFields;h<u.length;h++){var p=u[h],f=p[0],g=p[1];if(f in d||g in d){d.x=d[f],d.y=d[g];break}}n.options.targets.push(d)}}var m=In.set(e);return n.options=o,m},defaults:{range:1/0,targets:null,offset:null,endOnly:!1,enabled:!1}},An=yt(On,"snapSize"),_n={aspectRatio:pn,restrictEdges:Sn,restrict:vn,restrictRect:En,restrictSize:Pn,snapEdges:yt({start:function(e){var t=e.edges;return t?(e.state.targetFields=e.state.targetFields||[[t.left?"left":"right",t.top?"top":"bottom"]],On.start(e)):null},set:On.set,defaults:W(ft(On.defaults),{targets:void 0,range:void 0,offset:{x:0,y:0}})},"snapEdges"),snap:Mn,snapSize:An,spring:gn,avoid:gn,transform:gn,rubberband:gn},Dn={id:"modifiers",install:function(e){var t=e.interactStatic;for(var n in e.usePlugin(bt),e.usePlugin(cn),t.modifiers=_n,_n){var i=_n[n],o=i._defaults,r=i._methods;o._methods=r,e.defaults.perAction[n]=o}}},Rn=function(e){a(n,e);var t=h(n);function n(e,o,r,s,a,l){var c;if(i(this,n),ee(d(c=t.call(this,a)),r),r!==o&&ee(d(c),o),c.timeStamp=l,c.originalEvent=r,c.type=e,c.pointerId=ae(o),c.pointerType=fe(o),c.target=s,c.currentTarget=null,"tap"===e){var h=a.getPointerIndex(o);c.dt=c.timeStamp-a.pointers[h].downTime;var u=c.timeStamp-a.tapTime;c.double=!!a.prevTap&&"doubletap"!==a.prevTap.type&&a.prevTap.target===c.target&&u<500}else"doubletap"===e&&(c.dt=o.timeStamp-a.tapTime,c.double=!0);return c}return r(n,[{key:"_subtractOrigin",value:function(e){var t=e.x,n=e.y;return this.pageX-=t,this.pageY-=n,this.clientX-=t,this.clientY-=n,this}},{key:"_addOrigin",value:function(e){var t=e.x,n=e.y;return this.pageX+=t,this.pageY+=n,this.clientX+=t,this.clientY+=n,this}},{key:"preventDefault",value:function(){this.originalEvent.preventDefault()}}]),n}(me),zn={id:"pointer-events/base",before:["inertia","modifiers","auto-start","actions"],install:function(e){e.pointerEvents=zn,e.defaults.actions.pointerEvents=zn.defaults,W(e.actions.phaselessTypes,zn.types)},listeners:{"interactions:new":function(e){var t=e.interaction;t.prevTap=null,t.tapTime=0},"interactions:update-pointer":function(e){var t=e.down,n=e.pointerInfo;!t&&n.hold||(n.hold={duration:1/0,timeout:null})},"interactions:move":function(e,t){var n=e.interaction,i=e.pointer,o=e.event,r=e.eventTarget;e.duplicate||n.pointerIsDown&&!n.pointerWasMoved||(n.pointerIsDown&&jn(e),Bn({interaction:n,pointer:i,event:o,eventTarget:r,type:"move"},t))},"interactions:down":function(e,t){!function(e,t){for(var n=e.interaction,i=e.pointer,o=e.event,r=e.eventTarget,s=e.pointerIndex,a=n.pointers[s].hold,l=q(r),c={interaction:n,pointer:i,event:o,eventTarget:r,type:"hold",targets:[],path:l,node:null},d=0;d<l.length;d++){var h=l[d];c.node=h,t.fire("pointerEvents:collect-targets",c)}if(c.targets.length){for(var u=1/0,p=0,f=c.targets;p<f.length;p++){var g=f[p].eventable.options.holdDuration;g<u&&(u=g)}a.duration=u,a.timeout=setTimeout((function(){Bn({interaction:n,eventTarget:r,pointer:i,event:o,type:"hold"},t)}),u)}}(e,t),Bn(e,t)},"interactions:up":function(e,t){var n,i,o,r,s,a;jn(e),Bn(e,t),i=t,o=(n=e).interaction,r=n.pointer,s=n.event,a=n.eventTarget,o.pointerWasMoved||Bn({interaction:o,eventTarget:a,pointer:r,event:s,type:"tap"},i)},"interactions:cancel":function(e,t){jn(e),Bn(e,t)}},PointerEvent:Rn,fire:Bn,collectEventTargets:Fn,defaults:{holdDuration:600,ignoreFrom:null,allowFrom:null,origin:{x:0,y:0}},types:{down:!0,move:!0,up:!0,cancel:!0,tap:!0,doubletap:!0,hold:!0}};function Bn(e,t){var n=e.interaction,i=e.pointer,o=e.event,r=e.eventTarget,s=e.type,a=e.targets,l=void 0===a?Fn(e,t):a,c=new Rn(s,i,o,r,n,t.now());t.fire("pointerEvents:new",{pointerEvent:c});for(var d={interaction:n,pointer:i,event:o,eventTarget:r,targets:l,type:s,pointerEvent:c},h=0;h<l.length;h++){var u=l[h];for(var p in u.props||{})c[p]=u.props[p];var f=Y(u.eventable,u.node);if(c._subtractOrigin(f),c.eventable=u.eventable,c.currentTarget=u.node,u.eventable.fire(c),c._addOrigin(f),c.immediatePropagationStopped||c.propagationStopped&&h+1<l.length&&l[h+1].node!==c.currentTarget)break}if(t.fire("pointerEvents:fired",d),"tap"===s){var g=c.double?Bn({interaction:n,pointer:i,event:o,eventTarget:r,type:"doubletap"},t):c;n.prevTap=g,n.tapTime=g.timeStamp}return c}function Fn(e,t){var n=e.interaction,i=e.pointer,o=e.event,r=e.eventTarget,s=e.type,a=n.getPointerIndex(i),l=n.pointers[a];if("tap"===s&&(n.pointerWasMoved||!l||l.downTarget!==r))return[];for(var c=q(r),d={interaction:n,pointer:i,event:o,eventTarget:r,type:s,path:c,targets:[],node:null},h=0;h<c.length;h++){var u=c[h];d.node=u,t.fire("pointerEvents:collect-targets",d)}return"hold"===s&&(d.targets=d.targets.filter((function(e){var t,i;return e.eventable.options.holdDuration===(null==(t=n.pointers[a])||null==(i=t.hold)?void 0:i.duration)}))),d.targets}function jn(e){var t=e.interaction,n=e.pointerIndex,i=t.pointers[n].hold;i&&i.timeout&&(clearTimeout(i.timeout),i.timeout=null)}var Ln=Object.freeze({__proto__:null,default:zn});function qn(e){var t=e.interaction;t.holdIntervalHandle&&(clearInterval(t.holdIntervalHandle),t.holdIntervalHandle=null)}var Kn={id:"pointer-events/holdRepeat",install:function(e){e.usePlugin(zn);var t=e.pointerEvents;t.defaults.holdRepeatInterval=0,t.types.holdrepeat=e.actions.phaselessTypes.holdrepeat=!0},listeners:["move","up","cancel","endall"].reduce((function(e,t){return e["pointerEvents:".concat(t)]=qn,e}),{"pointerEvents:new":function(e){var t=e.pointerEvent;"hold"===t.type&&(t.count=(t.count||0)+1)},"pointerEvents:fired":function(e,t){var n=e.interaction,i=e.pointerEvent,o=e.eventTarget,r=e.targets;if("hold"===i.type&&r.length){var s=r[0].eventable.options.holdRepeatInterval;s<=0||(n.holdIntervalHandle=setTimeout((function(){t.pointerEvents.fire({interaction:n,eventTarget:o,type:"hold",pointer:i,event:i},t)}),s))}}})},Wn={id:"pointer-events/interactableTargets",install:function(e){var t=e.Interactable;t.prototype.pointerEvents=function(e){return W(this.events.options,e),this};var n=t.prototype._backCompatOption;t.prototype._backCompatOption=function(e,t){var i=n.call(this,e,t);return i===this&&(this.events.options[e]=t),i}},listeners:{"pointerEvents:collect-targets":function(e,t){var n=e.targets,i=e.node,o=e.type,r=e.eventTarget;t.interactables.forEachMatch(i,(function(e){var t=e.events,s=t.options;t.types[o]&&t.types[o].length&&e.testIgnoreAllow(s,i,r)&&n.push({node:i,eventable:t,props:{interactable:e}})}))},"interactable:new":function(e){var t=e.interactable;t.events.getRect=function(e){return t.getRect(e)}},"interactable:set":function(e,t){var n=e.interactable,i=e.options;W(n.events.options,t.pointerEvents.defaults),W(n.events.options,i.pointerEvents||{})}}},$n={id:"pointer-events",install:function(e){e.usePlugin(Ln),e.usePlugin(Kn),e.usePlugin(Wn)}},Vn={id:"reflow",install:function(e){var t=e.Interactable;e.actions.phases.reflow=!0,t.prototype.reflow=function(t){return function(e,t,n){for(var i=e.getAllElements(),o=n.window.Promise,r=o?[]:null,s=function(){var s=i[a],l=e.getRect(s);if(!l)return 1;var c,d=xe(n.interactions.list,(function(n){return n.interacting()&&n.interactable===e&&n.element===s&&n.prepared.name===t.name}));if(d)d.move(),r&&(c=d._reflowPromise||new o((function(e){d._reflowResolve=e})));else{var h=H(l),u=function(e){return{coords:e,get page(){return this.coords.page},get client(){return this.coords.client},get timeStamp(){return this.coords.timeStamp},get pageX(){return this.coords.page.x},get pageY(){return this.coords.page.y},get clientX(){return this.coords.client.x},get clientY(){return this.coords.client.y},get pointerId(){return this.coords.pointerId},get target(){return this.coords.target},get type(){return this.coords.type},get pointerType(){return this.coords.pointerType},get buttons(){return this.coords.buttons},preventDefault:function(){}}}({page:{x:h.x,y:h.y},client:{x:h.x,y:h.y},timeStamp:n.now()});c=function(e,t,n,i,o){var r=e.interactions.new({pointerType:"reflow"}),s={interaction:r,event:o,pointer:o,eventTarget:n,phase:"reflow"};r.interactable=t,r.element=n,r.prevEvent=o,r.updatePointer(o,o,n,!0),ie(r.coords.delta),He(r.prepared,i),r._doPhase(s);var a=e.window.Promise,l=a?new a((function(e){r._reflowResolve=e})):void 0;return r._reflowPromise=l,r.start(i,t,n),r._interacting?(r.move(s),r.end(o)):(r.stop(),r._reflowResolve()),r.removePointer(o,o),l}(n,e,s,t,u)}r&&r.push(c)},a=0;a<i.length&&!s();a++);return r&&o.all(r).then((function(){return e}))}(this,t,e)}},listeners:{"interactions:stop":function(e,t){var n,i,o=e.interaction;"reflow"===o.pointerType&&(o._reflowResolve&&o._reflowResolve(),n=t.interactions.list,i=o,n.splice(n.indexOf(i),1))}}};if(sn.use(ut),sn.use(At),sn.use($n),sn.use(Bt),sn.use(Dn),sn.use(ct),sn.use(je),sn.use(Ve),sn.use(Vn),sn.default=sn,"object"===n(ne)&&ne)try{ne.exports=sn}catch(Tt){}return sn.default=sn,sn}();const oe=te(ie.exports),re=H.create({name:"image",pasteKeepMarks(e){const t={};return"img"==e.tag&&e.hasMarks()&&(t.alt=e.marks.alt||"",t.src=e.marks.src||""),t},pasteKeepStyles(e){const t={};return"img"==e.tag&&e.hasStyles()&&(t.width=e.styles.width||"auto"),t},afterUpdateView(){if(!this.isEditable())return;this.$el.querySelectorAll("img").forEach((e=>{const t=this.findNode(e);((e,t,n)=>{h.off(t,"click"),h.on(t,"click",(()=>{e.setSelectionBefore(n,"start"),e.setSelectionAfter(n,"end"),e.updateRealSelection()}))})(this,e,t),((e,t,n)=>{const i=r.width(t.parentElement);oe(t).unset(),oe(t).resizable({enabled:!0,edges:{left:!1,right:!0,bottom:!1,top:!1},inertia:!1,autoScroll:!0,preserveAspectRatio:!0,axis:"x",listeners:{start(e){h.on(e.target,"dragstart",(e=>e.preventDefault()))},move(e){let{width:t}=e.rect;t<50&&(t=50),t>=i&&(t=i),e.target.style.width=`${t}px`},end(t){h.off(t.target,"dragstart");let{width:o}=t.rect;o<50&&(o=50),o>=i&&(o=i);const r=Number((o/i*100).toFixed(2));n.hasStyles()?n.styles.width=`${r}%`:n.styles={width:`${r}%`},e.setSelectionAfter(n),e.updateView()}}})})(this,e,t)}))},addCommands(){return{getImage:()=>this.getMatchNodeBySelection({tag:"img"}),hasImage:()=>this.isSelectionNodesSomeMatch({tag:"img"}),setImage:async({src:e,alt:t,width:n})=>{if(!e)return;const i=x.create({type:"closed",tag:"img",marks:{src:e,alt:t||""},styles:{width:n||"auto"}});this.insertNode(i),this.setSelectionAfter(i),await this.updateView()}}}}),se=H.create({name:"bold",addCommands(){const e=()=>this.commands.isTextStyle("fontWeight","bold")||this.commands.isTextStyle("fontWeight","700");return{isBold:e,setBold:async()=>{e()||await this.commands.setTextStyle({fontWeight:"bold"})},unsetBold:async()=>{e()&&await this.commands.removeTextStyle(["fontWeight"])}}}}),ae=H.create({name:"italic",addCommands(){const e=()=>this.commands.isTextStyle("fontStyle","italic");return{isItalic:e,setItalic:async()=>{e()||await this.commands.setTextStyle({fontStyle:"italic"})},unsetItalic:async()=>{e()&&await this.commands.removeTextStyle(["fontStyle"])}}}}),le=H.create({name:"strikethrough",addCommands(){const e=()=>this.commands.isTextStyle("textDecoration","line-through")||this.commands.isTextStyle("textDecorationLine","line-through");return{isStrikethrough:e,setStrikethrough:async()=>{e()||await this.commands.setTextStyle({textDecorationLine:"line-through"})},unsetStrikethrough:async()=>{e()&&await this.commands.removeTextStyle(["textDecoration","textDecorationLine"])}}}}),ce=H.create({name:"underline",addCommands(){const e=()=>this.commands.isTextStyle("textDecoration","underline")||this.commands.isTextStyle("textDecorationLine","underline");return{isUnderline:e,setUnderline:async()=>{e()||await this.commands.setTextStyle({textDecorationLine:"underline"})},unsetUnderline:async()=>{e()&&await this.commands.removeTextStyle(["textDecoration","textDecorationLine"])}}}}),de=H.create({name:"superscript",addCommands(){const e=()=>this.commands.isTextStyle("verticalAlign","super");return{isSuperscript:e,setSuperscript:async()=>{e()||await this.commands.setTextStyle({verticalAlign:"super"})},unsetSuperscript:async()=>{e()&&await this.commands.removeTextStyle(["verticalAlign"])}}}}),he=H.create({name:"subscript",addCommands(){const e=()=>this.commands.isTextStyle("verticalAlign","sub");return{isSubscript:e,setSubscript:async()=>{e()||await this.commands.setTextStyle({verticalAlign:"sub"})},unsetSubscript:async()=>{e()&&await this.commands.removeTextStyle(["verticalAlign"])}}}}),ue=H.create({name:"code",addCommands(){return{getCode:()=>this.getMatchNodeBySelection({tag:"code"}),hasCode:()=>this.isSelectionNodesSomeMatch({tag:"code"}),allCode:()=>this.isSelectionNodesAllMatch({tag:"code"}),setCode:async()=>{},unsetCode:async()=>{}}}}),pe=H.create({name:"fontSize",addCommands(){const e=e=>this.commands.isTextStyle("fontSize",e);return{isFontSize:e,setFontSize:async t=>{e(t)||await this.commands.setTextStyle({fontSize:t})},unsetFontSize:async t=>{e(t)&&await this.commands.removeTextStyle(["fontSize"])}}}}),fe=(e,t)=>{let n=[];if(e.length&&t.length){let i=0,o=0,r=e.length-1,s=t.length-1;for(;i<=r&&o<=s;){if(t[o])if(t[s])if(e[i].key==t[o].key)n.push(...ge(e[i],t[o])),i++,o++;else if(e[r].key==t[s].key)n.push(...ge(e[r],t[s])),r--,s--;else if(e[i].key==t[s].key)n.push({type:"move",newNode:e[i],oldNode:t[s]},...ge(e[i],t[s])),i++,s--;else if(e[r].key==t[o].key)n.push({type:"move",newNode:e[r],oldNode:t[o]},...ge(e[r],t[o])),r--,o++;else{let o=t.findIndex((t=>t&&t.key===e[i].key));o>=0?(n.push({type:"move",newNode:e[i],oldNode:t[o]},...ge(e[i],t[o])),t[o]=null):n.push({type:"insert",newNode:e[i],oldNode:null}),i++}else s--;else o++;if(o>s)for(;i<=r;i++)n.push({type:"insert",newNode:e[i],oldNode:null});else if(i>r)for(;o<=s;o++)t[o]&&n.push({type:"remove",oldNode:t[o],newNode:null})}}else e.length?n=e.map((e=>({type:"insert",newNode:e,oldNode:null}))):t.length&&(n=t.map((e=>({type:"remove",oldNode:e,newNode:null}))));return n},ge=(e,t)=>{const n=[];return e.namespace!=t.namespace?n.push({type:"replace",newNode:e,oldNode:t}):e.isText()||e.tag==t.tag?e.hasChildren()&&!t.hasChildren()||t.hasChildren()&&!e.hasChildren()?n.push({type:"replace",newNode:e,oldNode:t}):(e.isText()&&e.textContent!=t.textContent&&n.push({type:"update",oldNode:t,newNode:e,update:"textContent"}),e.isEqualStyles(t)||n.push({type:"update",newNode:e,oldNode:t,update:"styles"}),e.isEqualMarks(t)||n.push({type:"update",newNode:e,oldNode:t,update:"marks"}),e.hasChildren()&&t.hasChildren()&&n.push(...fe(e.children,t.children))):n.push({type:"replace",newNode:e,oldNode:t}),n},me=(e,t)=>{const n=t.namespace?document.createElementNS(t.namespace,t.tag):document.createElement(t.tag);return t.textContent&&(n.textContent=t.textContent),t.children&&t.children.length&&n.append(...t.children.map((t=>me(e,t)))),Object.keys(t.attrs).forEach((e=>{/(^on)|(^style$)/g.test(e)||n.setAttribute(e,`${t.attrs[e]}`)})),Object.keys(t.styles).forEach((e=>{n.style.setProperty(y(e),`${t.styles[e]}`)})),n},ye=function(e){if(this.$el)if(e){const e=document.createDocumentFragment();this.stackNodes.forEach((t=>{const n=g(this,t),i=me(this,n);e.appendChild(i)})),this.$el.innerHTML="",this.$el.appendChild(e)}else fe(this.stackNodes,this.oldStackNodes).forEach((e=>{if("insert"==e.type){const t=g(this,e.newNode),n=me(this,t),i=e.newNode.parent,o=e.newNode.getPrevious(i?i.children:this.stackNodes),r=i?this.findDom(i):this.$el;if(o){const e=this.findDom(o);e.nextElementSibling?r.insertBefore(n,e.nextElementSibling):r.appendChild(n)}else r.firstElementChild?r.insertBefore(n,r.firstElementChild):r.appendChild(n)}else if("remove"==e.type)try{this.findDom(e.oldNode).remove()}catch(t){}else if("update"==e.type){const t=this.findDom(e.newNode);if("textContent"==e.update)t.textContent=e.newNode.textContent||"";else if("styles"==e.update){const{addStyles:n,removeStyles:i}=((e,t)=>{const n={},i={};return e.hasStyles()&&Object.keys(e.styles).forEach((i=>{t.hasStyles()&&t.styles.hasOwnProperty(i)&&t.styles[i]===e.styles[i]||(n[i]=e.styles[i])})),t.hasStyles()&&Object.keys(t.styles).forEach((n=>{e.hasStyles()&&e.styles.hasOwnProperty(n)||(i[n]=t.styles[n])})),{addStyles:n,removeStyles:i}})(e.newNode,e.oldNode);for(let e in i)t.style.removeProperty(y(e));for(let e in n)t.style.setProperty(y(e),`${n[e]}`)}else if("marks"==e.update){const{addMarks:n,removeMarks:i}=((e,t)=>{const n={},i={};return e.hasMarks()&&Object.keys(e.marks).forEach((i=>{t.hasMarks()&&t.marks.hasOwnProperty(i)&&t.marks[i]===e.marks[i]||(n[i]=e.marks[i])})),t.hasMarks()&&Object.keys(t.marks).forEach((n=>{e.hasMarks()&&e.marks.hasOwnProperty(n)||(i[n]=t.marks[n])})),{addMarks:n,removeMarks:i}})(e.newNode,e.oldNode);for(let e in i)t.removeAttribute(e);for(let e in n)/(^on)|(^style$)/g.test(e)||t.setAttribute(e,`${n[e]}`)}}else if("replace"==e.type){const t=g(this,e.newNode),n=me(this,t),i=this.findDom(e.oldNode);(e.oldNode.parent?this.findDom(e.oldNode.parent):this.$el).insertBefore(n,i),i.remove()}else if("move"==e.type){const n=this.findDom(e.newNode),i=e.newNode.parent,o=e.newNode.getPrevious(i?i.children:this.stackNodes),r=i?this.findDom(i):this.$el;if(o)try{const e=this.findDom(o);e.nextElementSibling?r.insertBefore(n,e.nextElementSibling):r.appendChild(n)}catch(t){r.firstElementChild?r.insertBefore(n,r.firstElementChild):r.appendChild(n)}else r.firstElementChild?r.insertBefore(n,r.firstElementChild):r.appendChild(n)}}))},ve=H.create({name:"fontFamily",addCommands(){const e=e=>this.commands.isTextStyle("fontFamily",e);return{isFontFamily:e,setFontFamily:async t=>{e(t)||await this.commands.setTextStyle({fontFamily:t})},unsetFontFamily:async t=>{e(t)&&await this.commands.removeTextStyle(["fontFamily"])}}}});class be{constructor(){n(this,"$el"),n(this,"allowCopy",!0),n(this,"allowPaste",!0),n(this,"allowCut",!0),n(this,"allowPasteHtml",!1),n(this,"textRenderTag","span"),n(this,"blockRenderTag","p"),n(this,"voidRenderTags",["colgroup","col"]),n(this,"emptyRenderTags",["meta","link","style","script","title","base","noscript","template","annotation"]),n(this,"extraKeepTags",[]),n(this,"extensions",[re,J,ee,se,ae,le,ce,de,he,ue,pe,ve]),n(this,"formatRules",[C,P,I,M,O,A]),n(this,"domParseNodeCallback"),n(this,"onUpdateView"),n(this,"onPasteText"),n(this,"onPasteHtml"),n(this,"onPasteImage"),n(this,"onPasteVideo"),n(this,"onPasteFile"),n(this,"onChange"),n(this,"onSelectionUpdate"),n(this,"onInsertParagraph"),n(this,"onDeleteInStart"),n(this,"onDeleteComplete"),n(this,"onKeydown"),n(this,"onKeyup"),n(this,"onFocus"),n(this,"onBlur"),n(this,"pasteKeepMarks"),n(this,"pasteKeepStyles"),n(this,"afterUpdateView"),n(this,"guid",function(){let e=a.get(window,"data-kaitify-guid")||0;return e++,a.set(window,"data-kaitify-guid",e),e}()),n(this,"selection",new k),n(this,"history",new E),n(this,"commands",{}),n(this,"stackNodes",[]),n(this,"oldStackNodes",[]),n(this,"isComposition",!1),n(this,"internalCauseSelectionChange",!1),n(this,"domObserver",null)}mergeBlock(e,t){if(!e.isBlock()||!t.isBlock())return;if(e.isEmpty()||t.isEmpty())return;const n=t.getUneditable();if(n)n.toEmpty();else{const n=t.children.map((t=>(t.parent=e,t)));e.children.push(...n),t.children=[]}}getAllowMergeNode(e,t){if(e.isEmpty())return null;if(!e.parent)return null;if(e.locked)return null;if("prevSibling"==t){const t=e.getPrevious(e.parent.children);return t?e.isText()?t.isText()&&t.isEqualMarks(e)&&t.isEqualStyles(e)?t:null:e.isInline()&&t.isInline()&&t.tag==e.tag&&t.isEqualMarks(e)&&t.isEqualStyles(e)?t:null:null}if("nextSibling"==t){const t=e.getNext(e.parent.children);return t?e.isText()?t.isText()&&t.isEqualMarks(e)&&t.isEqualStyles(e)?t:null:e.isInline()&&t.isInline()&&t.tag==e.tag&&t.isEqualMarks(e)&&t.isEqualStyles(e)?t:null:null}return"parent"==t?e.parent.children.length>1?null:e.isText()?e.parent.isInline()&&e.parent.tag==this.textRenderTag?e.parent:null:e.type==e.parent.type&&e.tag==e.parent.tag?e.parent:null:null}applyMergeNode(e,t){const n=this.getAllowMergeNode(e,t);if(n){if("prevSibling"==t)if(e.isText()){this.isSelectionInNode(n,"start")&&(this.selection.start.node=e),this.isSelectionInNode(n,"end")&&(this.selection.end.node=e),e.textContent=n.textContent+e.textContent;const t=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(t,1)}else if(e.isInline()){e.children=[...n.children,...e.children].map((t=>(t.parent=e,t)));const t=n.parent.children.findIndex((e=>n.isEqual(e)));if(n.parent.children.splice(t,1),e.hasChildren()&&e.children.length>1){let t=0;for(;e.hasChildren()&&t<=e.children.length-2;){this.getAllowMergeNode(e.children[t],"nextSibling")?(this.applyMergeNode(e.children[t],"nextSibling"),e.hasChildren()&&1==e.children.length&&this.applyMergeNode(e.children[0],"parent")):t++}}}if("nextSibling"==t)if(e.isText()){this.isSelectionInNode(n,"start")&&(this.selection.start.node=e,this.selection.start.offset=e.textContent.length+this.selection.start.offset),this.isSelectionInNode(n,"end")&&(this.selection.end.node=e,this.selection.end.offset=e.textContent.length+this.selection.end.offset),e.textContent+=n.textContent;const t=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(t,1)}else if(e.isInline()){e.children=[...e.children,...n.children].map((t=>(t.parent=e,t)));const t=n.parent.children.findIndex((e=>n.isEqual(e)));if(n.parent.children.splice(t,1),e.hasChildren()&&e.children.length>1){let t=0;for(;e.hasChildren()&&t<=e.children.length-2;){this.getAllowMergeNode(e.children[t],"nextSibling")?(this.applyMergeNode(e.children[t],"nextSibling"),e.hasChildren()&&1==e.children.length&&this.applyMergeNode(e.children[0],"parent")):t++}}}"parent"==t&&(e.isText()?(n.type="text",n.tag=void 0,e.hasMarks()&&(n.hasMarks()?Object.assign(n.marks,l.clone(e.marks)):n.marks=l.clone(e.marks)),e.hasStyles()&&(n.hasStyles()?Object.assign(n.styles,l.clone(e.styles)):n.styles=l.clone(e.styles)),n.textContent=e.textContent,n.children=void 0,this.isSelectionInNode(e,"start")&&(this.selection.start.node=n),this.isSelectionInNode(e,"end")&&(this.selection.end.node=n)):(e.hasMarks()&&(n.hasMarks()?Object.assign(n.marks,l.clone(e.marks)):n.marks=l.clone(e.marks)),e.hasStyles()&&(n.hasStyles()?Object.assign(n.styles,l.clone(e.styles)):n.styles=l.clone(e.styles)),e.hasChildren()&&(n.children=[...e.children],n.children.forEach((e=>{e.parent=n}))),n.hasChildren()&&1==n.children.length&&this.getAllowMergeNode(n.children[0],"parent")&&(this.applyMergeNode(n.children[0],"parent"),this.getAllowMergeNode(n,"prevSibling")?this.applyMergeNode(n,"prevSibling"):this.getAllowMergeNode(n,"nextSibling")&&this.applyMergeNode(n,"nextSibling"))))}}formatNodes(e,t){let n=0;for(;n<t.length;){const i=t[n];if(i.isEmpty())this.isSelectionInNode(i,"start")&&this.updateSelectionRecently("start"),this.isSelectionInNode(i,"end")&&this.updateSelectionRecently("end"),t.splice(n,1);else if(e({editor:this,node:i}),i.isEmpty()){this.isSelectionInNode(i,"start")&&this.updateSelectionRecently("start"),this.isSelectionInNode(i,"end")&&this.updateSelectionRecently("end");const e=t.findIndex((e=>e.isEqual(i)));t.splice(e,1)}else if(i.isBlock()||this.stackNodes!==t||this.convertToBlock(i),i.hasChildren()&&this.formatNodes(e,i.children),i.isEmpty()){this.isSelectionInNode(i,"start")&&this.updateSelectionRecently("start"),this.isSelectionInNode(i,"end")&&this.updateSelectionRecently("end");const e=t.findIndex((e=>e.isEqual(i)));t.splice(e,1)}else n++}}emptyFixedBlock(e){e.isBlock()&&e.hasChildren()&&e.children.forEach((e=>{if(e.isBlock()&&e.fixed)this.emptyFixedBlock(e);else if(e.toEmpty(),e.parent.isEmpty()){const t=x.createPlaceholder();this.addNode(t,e.parent)}}))}registerExtension(e){if(!e.registered){if(e.registered=!0,e.extraKeepTags&&(this.extraKeepTags=[...e.extraKeepTags,...this.extraKeepTags]),e.domParseNodeCallback){const t=this.domParseNodeCallback;this.domParseNodeCallback=n=>(n=e.domParseNodeCallback.apply(this,[n]),t&&(n=t.apply(this,[n])),n)}if(e.formatRule&&(this.formatRules=[e.formatRule,...this.formatRules]),e.pasteKeepMarks){const t=this.pasteKeepMarks;this.pasteKeepMarks=n=>{const i=e.pasteKeepMarks.apply(this,[n]);return t&&Object.assign(i,t.apply(this,[n])),i}}if(e.pasteKeepStyles){const t=this.pasteKeepStyles;this.pasteKeepStyles=n=>{const i=e.pasteKeepStyles.apply(this,[n]);return t&&Object.assign(i,t.apply(this,[n])),i}}if(e.afterUpdateView){const t=this.afterUpdateView;this.afterUpdateView=()=>{e.afterUpdateView.apply(this),t&&t.apply(this)}}if(e.addCommands){const t=e.addCommands.apply(this);this.commands={...this.commands,...t}}}}scrollViewToSelection(){if(this.selection.focused()){const e=this.findDom(this.selection.end.node),t=async t=>{const n=r.getScrollHeight(t),i=r.getScrollWidth(t);if(t.clientHeight<n||t.clientWidth<i){const o=window.getSelection().getRangeAt(0),s=o.getClientRects();let a=o;0==s.length&&(a=e);const l=a.getBoundingClientRect(),c=t.getBoundingClientRect();if(t.clientHeight<n)if(l.top<c.top){await r.setScrollTop({el:t,number:0});const e=a.getBoundingClientRect(),n=t.getBoundingClientRect();r.setScrollTop({el:t,number:e.top-n.top})}else if(l.bottom>c.bottom){await r.setScrollTop({el:t,number:0});const e=a.getBoundingClientRect(),n=t.getBoundingClientRect();r.setScrollTop({el:t,number:e.bottom-n.bottom})}if(t.clientWidth<i)if(l.left<c.left){await r.setScrollLeft({el:t,number:0});const e=a.getBoundingClientRect(),n=t.getBoundingClientRect();r.setScrollLeft({el:t,number:e.left-n.left+20})}else if(l.right>c.right){await r.setScrollLeft({el:t,number:0});const e=a.getBoundingClientRect(),n=t.getBoundingClientRect();r.setScrollLeft({el:t,number:e.right-n.right+20})}}};let n=e;for(;r.isElement(n)&&n!=document.documentElement;)t(n),n=n.parentNode}}findNode(e){if(!v(this.$el,e))throw new Error("The dom should be in the editor area, but what you provide is not");const t=e.getAttribute(f);if(!t)throw new Error(`The dom generated by editor should all have a ${f} attribute, but your dom does not. Check for "updateView" related issues`);const n=x.searchByKey(t,this.stackNodes);if(!n)throw new Error("Unexpected error occurred: the knode was not found in the editor");return n}findDom(e){let t=e.tag;e.isText()&&(t=this.textRenderTag);const n=this.$el.querySelector(`${t}[${f}="${e.key}"]`);if(!n)throw new Error("Unexpected error occurred: the dom was not found in the editor");return n}setEditable(e){var t,n,i;e?null==(t=this.$el)||t.setAttribute("contenteditable","true"):null==(n=this.$el)||n.removeAttribute("contenteditable"),null==(i=this.$el)||i.setAttribute("spellcheck","false")}isEditable(){var e;return"true"==(null==(e=this.$el)?void 0:e.getAttribute("contenteditable"))}checkNodes(){if(0==this.stackNodes.filter((e=>!e.isEmpty()&&!this.voidRenderTags.includes(e.tag))).length){const e=x.create({type:"block",tag:this.blockRenderTag}),t=x.createPlaceholder();this.addNode(t,e),this.stackNodes=[e],this.selection.focused()&&this.setSelectionBefore(t)}}convertToBlock(e){if(e.isBlock())return;const t=e.clone(!0);(e.isText()||e.isClosed())&&(this.isSelectionInNode(e,"start")&&(this.selection.start.node=t),this.isSelectionInNode(e,"end")&&(this.selection.end.node=t)),e.type="block",e.tag=this.blockRenderTag,e.marks=void 0,e.styles=void 0,e.textContent=void 0,e.children=[t],t.parent=e}domParseNode(e){if(1!=e.nodeType&&3!=e.nodeType)throw new Error("The argument must be an element node or text node");if(3==e.nodeType)return x.create({type:"text",textContent:e.textContent||""});const t=(e=>{let t={};const n=e.attributes.length;for(let i=0;i<n;i++){const n=e.attributes[i];new RegExp(`(^on)|(^style$)|(^${f}$)`,"g").test(n.nodeName)||(t[n.nodeName]=n.nodeValue||"")}return t})(e),n=(e=>{let t={};const n=e.getAttribute("style");if(n){let e=0,i=0,o=[];for(;e<n.length;)";"==n[e]&&"base64,"!=n.substring(e+1,e+8)&&(o.push(n.substring(i,e)),i=e+1),e==n.length-1&&i<e+1&&o.push(n.substring(i,e+1)),e++;o.forEach((e=>{const n=e.indexOf(":"),i=e.substring(0,n).trim(),o=e.substring(n+1).trim();var r;t[(r=i,r.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())))]=o}))}return t})(e),i=e.nodeName.toLocaleLowerCase(),o=e.namespaceURI;if(this.voidRenderTags.includes(i))return x.create({type:"text"});if(i==this.textRenderTag&&e.childNodes.length&&Array.from(e.childNodes).every((e=>3==e.nodeType)))return x.create({type:"text",marks:t,styles:n,textContent:e.textContent||""});const r=w.find((e=>e.tag==i)),s=T.find((e=>e.tag==i)),a=S.find((e=>e.tag==i)),l={type:"inline",tag:i,marks:t,styles:n,namespace:o||""};r?(l.type="block",l.children=[],r.parse&&(l.tag=this.blockRenderTag),r.fixed&&(l.fixed=r.fixed)):s?(l.type="inline",l.children=[],s.parse&&(l.tag=this.textRenderTag)):a?l.type="closed":this.extraKeepTags.includes(i)||(l.type="inline",l.tag=this.textRenderTag,l.namespace="",l.children=[]);let c=x.create(l);return a||Array.from(e.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.domParseNode(e);t.parent=c,c.hasChildren()?c.children.push(t):c.children=[t]}})),"function"==typeof this.domParseNodeCallback&&(c=this.domParseNodeCallback.apply(this,[c])),c}htmlParseNode(e){const t=document.createElement("template");t.innerHTML=e;const n=[];return t.content.childNodes.forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.domParseNode(e);n.push(t)}})),n}addNode(e,t,n=0){e.isEmpty()||t.isText()||t.isClosed()||(t.hasChildren()||(t.children=[]),n>=t.children.length?t.children.push(e):t.children.splice(n,0,e),e.parent=t)}addNodeBefore(e,t){if(t.parent){const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addNode(e,t.parent,n)}else{const n=this.stackNodes.findIndex((e=>t.isEqual(e)));this.stackNodes.splice(n,0,e),e.parent=void 0}}addNodeAfter(e,t){if(t.parent){const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addNode(e,t.parent,n+1)}else{const n=this.stackNodes.findIndex((e=>t.isEqual(e)));this.stackNodes.splice(n+1,0,e),e.parent=void 0}}getLastSelectionNodeInChildren(e){if(e.isEmpty())return null;if(e.tag&&this.voidRenderTags.includes(e.tag))return null;if(e.isText()||e.isClosed())return e;let t=null;for(let n=e.children.length-1;n>=0;n--){const i=e.children[n];if(t=this.getLastSelectionNodeInChildren(i),t)break}return t}getFirstSelectionNodeInChildren(e){if(e.isEmpty())return null;if(e.tag&&this.voidRenderTags.includes(e.tag))return null;if(e.isText()||e.isClosed())return e;let t=null;const n=e.children.length;for(let i=0;i<n;i++){const n=e.children[i];if(t=this.getFirstSelectionNodeInChildren(n),t)break}return t}getPreviousSelectionNode(e){const t=e.parent?e.parent.children:this.stackNodes,n=e.getPrevious(t);return n?n.isEmpty()||n.tag&&this.voidRenderTags.includes(n.tag)?this.getPreviousSelectionNode(n):n.isText()||n.isClosed()?n:this.getLastSelectionNodeInChildren(n):e.parent?this.getPreviousSelectionNode(e.parent):null}getNextSelectionNode(e){const t=e.parent?e.parent.children:this.stackNodes,n=e.getNext(t);return n?n.isEmpty()||n.tag&&this.voidRenderTags.includes(n.tag)?this.getNextSelectionNode(n):n.isText()||n.isClosed()?n:this.getFirstSelectionNodeInChildren(n):e.parent?this.getNextSelectionNode(e.parent):null}setSelectionBefore(e,t="all"){if(e){const n=this.getFirstSelectionNodeInChildren(e);n&&("start"!=t&&"all"!=t||(this.selection.start={node:n,offset:0}),"end"!=t&&"all"!=t||(this.selection.end={node:n,offset:0}))}else{const e=this.stackNodes[0];let n=this.getFirstSelectionNodeInChildren(e);n||(n=this.getNextSelectionNode(e)),n&&("start"!=t&&"all"!=t||(this.selection.start={node:n,offset:0}),"end"!=t&&"all"!=t||(this.selection.end={node:n,offset:0}))}}setSelectionAfter(e,t="all"){if(e){const n=this.getLastSelectionNodeInChildren(e);n&&("start"!=t&&"all"!=t||(this.selection.start={node:n,offset:n.isText()?n.textContent.length:1}),"end"!=t&&"all"!=t||(this.selection.end={node:n,offset:n.isText()?n.textContent.length:1}))}else{const e=this.stackNodes[this.stackNodes.length-1];let n=this.getLastSelectionNodeInChildren(e);n||(n=this.getPreviousSelectionNode(e)),n&&("start"!=t&&"all"!=t||(this.selection.start={node:n,offset:n.isText()?n.textContent.length:1}),"end"!=t&&"all"!=t||(this.selection.end={node:n,offset:n.isText()?n.textContent.length:1}))}}updateSelectionRecently(e="all"){if(this.selection.focused()){if("start"==e||"all"==e){const e=this.getPreviousSelectionNode(this.selection.start.node),t=this.getNextSelectionNode(this.selection.start.node),n=this.selection.start.node.getBlock();e&&n.isContains(e)?(this.selection.start.node=e,this.selection.start.offset=e.isText()?e.textContent.length:1):t&&n.isContains(t)?(this.selection.start.node=t,this.selection.start.offset=0):e?(this.selection.start.node=e,this.selection.start.offset=e.isText()?e.textContent.length:1):t&&(this.selection.start.node=t,this.selection.start.offset=0)}if("end"==e||"all"==e){const e=this.getPreviousSelectionNode(this.selection.end.node),t=this.getNextSelectionNode(this.selection.end.node),n=this.selection.end.node.getBlock();e&&n.isContains(e)?(this.selection.end.node=e,this.selection.end.offset=e.isText()?e.textContent.length:1):t&&n.isContains(t)?(this.selection.end.node=t,this.selection.end.offset=0):e?(this.selection.end.node=e,this.selection.end.offset=e.isText()?e.textContent.length:1):t&&(this.selection.end.node=t,this.selection.end.offset=0)}}}isSelectionInNode(e,t="all"){return!!this.selection.focused()&&("start"==t?e.isContains(this.selection.start.node):"end"==t?e.isContains(this.selection.end.node):"all"==t?e.isContains(this.selection.start.node)&&e.isContains(this.selection.end.node):void 0)}getSelectedNodes(){if(!this.selection.focused()||this.selection.collapsed())return[];const e=this.selection.start.node,t=this.selection.end.node,n=this.selection.start.offset,i=this.selection.end.offset;if(e.isEqual(t))return e.isClosed()?[{node:e,offset:!1}]:[{node:e,offset:(0!=n||i!=e.textContent.length)&&[n,i]}];const o=[];let r=e;for(;;){if(r.isEqual(e))0==n?o.push({node:r,offset:!1}):r.isText()&&n<r.textContent.length&&o.push({node:r,offset:[n,r.textContent.length]});else{if(r.isEqual(t)){i==(r.isText()?r.textContent.length:1)?o.push({node:r,offset:!1}):r.isText()&&i>0&&o.push({node:r,offset:[0,i]});break}if(r.isContains(t)){const e=this.getLastSelectionNodeInChildren(r);if(t.isEqual(e)&&i==(t.isText()?t.textContent.length:1)){o.push({node:r,offset:!1});break}r=r.children[0];continue}o.push({node:r,offset:!1})}let s=r,a=null;for(;a=s.getNext(s.parent?s.parent.children:this.stackNodes),!a&&s.parent;)s=s.parent;if(!a)break;r=a}return o}getMatchNodeBySelection(e){if(!this.selection.focused())return null;if(this.selection.collapsed())return this.selection.start.node.getMatchNode(e);const t=[];this.getSelectedNodes().forEach((e=>{t.push(...e.node.getFocusNodes("all"))}));const n=t[0].getMatchNode(e);return n&&t.every((e=>n.isContains(e)))?n:null}isSelectionNodesAllMatch(e){if(!this.selection.focused())return!1;if(this.selection.collapsed())return!!this.selection.start.node.getMatchNode(e);const t=[];return this.getSelectedNodes().forEach((e=>{t.push(...e.node.getFocusNodes("all"))})),t.every((t=>!!t.getMatchNode(e)))}isSelectionNodesSomeMatch(e){if(!this.selection.focused())return!1;if(this.selection.collapsed())return!!this.selection.start.node.getMatchNode(e);const t=[];return this.getSelectedNodes().forEach((e=>{t.push(...e.node.getFocusNodes("all"))})),t.some((t=>!!t.getMatchNode(e)))}getFocusNodesBySelection(e="all"){if(!this.selection.focused())return[];if(this.selection.collapsed())return this.selection.start.node.getFocusNodes(e);const t=[];return this.getSelectedNodes().forEach((n=>{t.push(...n.node.getFocusNodes(e))})),t}insertText(e){if(e&&this.selection.focused())if(e=e.replace(/\r\n/g,"\n"),this.selection.collapsed()){const t=this.selection.start.node,n=this.selection.start.offset;if(t.isInCodeBlockStyle()||(e=e.replace(/\s/g,(()=>{const e=document.createElement("span");return e.innerHTML="&nbsp;",e.innerText}))),t.isText())t.textContent=t.textContent.substring(0,n)+e+t.textContent.substring(n),this.selection.start.offset=this.selection.end.offset=this.selection.start.offset+e.length;else{const i=x.create({type:"text",textContent:e});0==n?this.addNodeBefore(i,t):this.addNodeAfter(i,t),this.setSelectionAfter(i)}}else this.delete(),this.insertText(e)}insertParagraph(){if(this.selection.focused())if(this.selection.collapsed()){const e=this.selection.start.node,t=this.selection.start.offset,n=e.getBlock(),i=this.getFirstSelectionNodeInChildren(n),o=this.getLastSelectionNodeInChildren(n);if(e.isInCodeBlockStyle()){this.insertText("\n");const e=x.createZeroWidthText();this.insertNode(e),this.setSelectionAfter(e,"all"),"function"==typeof this.onInsertParagraph&&this.onInsertParagraph.apply(this,[n,n])}else if(!n.fixed)if(i.isEqual(e)&&0==t)if(n.allIsPlaceholder()&&n.tag!=this.blockRenderTag){if("li"==n.tag&&n.parent&&["ol","ul"].includes(n.parent.tag)){const e=n.parent,t=e.children.findIndex((e=>e.isEqual(n)));if(0==t)e.children.splice(t,1),this.addNodeBefore(n,e);else if(t==e.children.length-1)e.children.splice(t,1),this.addNodeAfter(n,e);else{const i=n.parent.clone(!1),o=e.children;e.children=o.slice(0,t),i.children=o.slice(t+1),this.addNodeAfter(n,e),this.addNodeAfter(i,n)}}n.tag=this.blockRenderTag,n.marks={},n.styles={}}else{const e=n.clone(!1),t=x.createPlaceholder();this.addNode(t,e),this.addNodeBefore(e,n),"function"==typeof this.onInsertParagraph&&this.onInsertParagraph.apply(this,[n,e])}else if(o.isEqual(e)&&t==(e.isText()?e.textContent.length:1))if(n.allIsPlaceholder()&&n.tag!=this.blockRenderTag){if("li"==n.tag&&n.parent&&["ol","ul"].includes(n.parent.tag)){const e=n.parent,t=e.children.findIndex((e=>e.isEqual(n)));if(0==t)e.children.splice(t,1),this.addNodeBefore(n,e);else if(t==e.children.length-1)e.children.splice(t,1),this.addNodeAfter(n,e);else{const i=n.parent.clone(!1),o=e.children;e.children=o.slice(0,t),i.children=o.slice(t+1),this.addNodeAfter(n,e),this.addNodeAfter(i,n)}}n.tag=this.blockRenderTag,n.marks={},n.styles={}}else{const e=n.clone(!1),t=x.createPlaceholder();this.addNode(t,e),this.addNodeAfter(e,n),this.setSelectionBefore(t),"function"==typeof this.onInsertParagraph&&this.onInsertParagraph.apply(this,[e,n])}else if(n.allIsPlaceholder()&&n.tag!=this.blockRenderTag){if("li"==n.tag&&n.parent&&["ol","ul"].includes(n.parent.tag)){const e=n.parent,t=e.children.findIndex((e=>e.isEqual(n)));if(0==t)e.children.splice(t,1),this.addNodeBefore(n,e);else if(t==e.children.length-1)e.children.splice(t,1),this.addNodeAfter(n,e);else{const i=n.parent.clone(!1),o=e.children;e.children=o.slice(0,t),i.children=o.slice(t+1),this.addNodeAfter(n,e),this.addNodeAfter(i,n)}}n.tag=this.blockRenderTag,n.marks={},n.styles={}}else{const e=n.clone(!0);this.addNodeAfter(e,n);const t=x.flat(n.children).findIndex((e=>this.selection.start.node.isEqual(e))),i=this.selection.start.offset;this.setSelectionAfter(o,"end"),this.delete(),this.setSelectionBefore(e,"start"),this.selection.end.node=x.flat(e.children)[t],this.selection.end.offset=i,this.delete(),"function"==typeof this.onInsertParagraph&&this.onInsertParagraph.apply(this,[e,n])}}else this.delete(),this.insertParagraph()}insertNode(e,t=!1){if(this.selection.focused()&&!e.isEmpty())if(this.selection.collapsed()){const n=this.selection.start.node,i=this.selection.start.offset,o=n.getBlock(),r=this.getFirstSelectionNodeInChildren(o),s=this.getLastSelectionNodeInChildren(o);if(o.fixed||!e.isBlock()||e.fixed)if(0==i)this.addNodeBefore(e,n);else if(i==(n.isText()?n.textContent.length:1))this.addNodeAfter(e,n);else{const t=n.textContent,o=n.clone();n.textContent=t.substring(0,i),o.textContent=t.substring(i),this.addNodeAfter(o,n),this.addNodeBefore(e,o)}else if(o.allIsPlaceholder()&&t)this.addNodeBefore(e,o),o.toEmpty();else if(r.isEqual(n)&&0==i)this.addNodeBefore(e,o);else if(s.isEqual(n)&&i==(n.isText()?n.textContent.length:1))this.addNodeAfter(e,o);else{this.insertParagraph();const t=this.selection.start.node.getBlock();this.addNodeBefore(e,t)}this.setSelectionAfter(e,"all")}else this.delete(),this.insertNode(e,t)}delete(){if(this.selection.focused()){if(this.selection.collapsed()){const e=this.selection.start.node,t=this.selection.start.offset,n=this.getPreviousSelectionNode(e),i=e.getBlock();if(0==t)if(n){const e=n.getBlock();if(e.isEqual(i))return this.setSelectionAfter(n,"all"),void this.delete();i.fixed||this.mergeBlock(e,i)}else"function"==typeof this.onDeleteInStart&&this.onDeleteInStart.apply(this,[i]);else{if(e.isZeroWidthText()){if(e.toEmpty(),i.isEmpty()){const e=x.createPlaceholder();this.addNode(e,i),this.setSelectionBefore(e)}else this.setSelectionAfter(n,"all");return void this.delete()}if(e.isText()){const n=e.textContent.substring(t-1,t);if(e.textContent=e.textContent.substring(0,t-1)+e.textContent.substring(t),this.selection.start.offset=t-1,this.selection.end.offset=t-1,m(n))return void this.delete();if(i.isEmpty()){const e=x.createPlaceholder();this.addNode(e,i),this.setSelectionBefore(e)}}else if(e.isClosed()){const t=e.isPlaceholder();if(e.toEmpty(),i.isEmpty())if(t){if(i.fixed){const e=x.createPlaceholder();this.addNode(e,i),this.setSelectionBefore(e)}else if(!i.fixed&&!n){const e=x.createPlaceholder();this.addNode(e,i),this.setSelectionBefore(e),"function"==typeof this.onDeleteInStart&&this.onDeleteInStart.apply(this,[i])}}else{const e=x.createPlaceholder();this.addNode(e,i),this.setSelectionBefore(e)}}}}else{const e=this.getSelectedNodes().filter((e=>!this.voidRenderTags.includes(e.node.tag))),t=this.selection.start.node.getBlock(),n=this.selection.end.node.getBlock();if(e.forEach((e=>{const{node:t,offset:n}=e;n?t.textContent=t.textContent.substring(0,n[0])+t.textContent.substring(n[1]):t.isBlock()&&t.fixed?this.emptyFixedBlock(t):t.toEmpty()})),t.isEqual(n)){if(t.isEmpty()){const e=x.createPlaceholder();this.addNode(e,t),this.setSelectionBefore(e)}}else{if(t.isEmpty()){const e=x.createPlaceholder();this.addNode(e,t),this.setSelectionBefore(e,"start")}if(n.isEmpty()){const e=x.createPlaceholder();this.addNode(e,n),this.setSelectionBefore(e,"end")}n.fixed||this.mergeBlock(t,n)}}this.selection.start.node.isEmpty()&&this.updateSelectionRecently("start"),this.selection.end.node=this.selection.start.node,this.selection.end.offset=this.selection.start.offset,"function"==typeof this.onDeleteComplete&&this.onDeleteComplete.apply(this)}}async updateView(e=!1){if(!this.$el)return;_(this.stackNodes,this.oldStackNodes).forEach((e=>{let t=null;if(e.newNode)t=e.newNode.parent?e.newNode.parent:e.newNode;else if(e.oldNode&&e.oldNode.parent){const n=x.searchByKey(e.oldNode.parent.key,this.stackNodes);t=n||null}t&&this.formatRules.forEach((e=>{this.formatNodes(e,t.parent?t.parent.children:this.stackNodes)}))})),this.checkNodes();const t=this.$el.innerHTML;("function"!=typeof this.onUpdateView||await this.onUpdateView.apply(this,[!1]))&&ye.apply(this,[!1]);const n=this.$el.innerHTML;t!=n&&("function"==typeof this.onChange&&this.onChange.apply(this,[n,t]),e||this.history.setState(this.stackNodes,this.selection)),this.oldStackNodes=this.stackNodes.map((e=>e.fullClone())),await this.updateRealSelection(),"function"==typeof this.afterUpdateView&&this.afterUpdateView.apply(this)}async updateRealSelection(){const e=window.getSelection();if(e){if(this.selection.focused()){this.internalCauseSelectionChange=!0;const t=document.createRange(),n=this.findDom(this.selection.start.node),i=this.findDom(this.selection.end.node);if(this.selection.start.node.isText())t.setStart(n.childNodes[0],this.selection.start.offset);else if(this.selection.start.node.isClosed()){const e=this.selection.start.node.parent.children.findIndex((e=>this.selection.start.node.isEqual(e)));t.setStart(n.parentNode,this.selection.start.offset+e)}if(this.selection.end.node.isText())t.setEnd(i.childNodes[0],this.selection.end.offset);else if(this.selection.end.node.isClosed()){const e=this.selection.end.node.parent.children.findIndex((e=>this.selection.end.node.isEqual(e)));t.setEnd(i.parentNode,this.selection.end.offset+e)}e.removeAllRanges(),e.addRange(t)}else e.removeAllRanges();await b(),this.internalCauseSelectionChange=!1,this.scrollViewToSelection(),this.history.updateSelection(this.selection),"function"==typeof this.onSelectionUpdate&&this.onSelectionUpdate.apply(this,[this.selection])}}updateSelection(){if(!this.$el)return!1;const e=window.getSelection();if(e&&e.rangeCount){const t=e.getRangeAt(0);if(v(this.$el,t.startContainer)&&v(this.$el,t.endContainer)){if(3==t.startContainer.nodeType)this.selection.start={node:this.findNode(t.startContainer.parentNode),offset:t.startOffset};else if(1==t.startContainer.nodeType){const e=Array.from(t.startContainer.childNodes);if(e.length){const n=e[t.startOffset]?e[t.startOffset]:e[t.startOffset-1];1==n.nodeType?e[t.startOffset]?this.setSelectionBefore(this.findNode(n),"start"):this.setSelectionAfter(this.findNode(n),"start"):3==n.nodeType&&(this.selection.start={node:this.findNode(n.parentNode),offset:e[t.startOffset]?0:n.textContent.length})}else this.selection.start={node:this.findNode(t.startContainer),offset:0}}if(3==t.endContainer.nodeType)this.selection.end={node:this.findNode(t.endContainer.parentNode),offset:t.endOffset};else if(1==t.endContainer.nodeType){const e=Array.from(t.endContainer.childNodes);if(e.length){const n=e[t.endOffset]?e[t.endOffset]:e[t.endOffset-1];1==n.nodeType?e[t.endOffset]?this.setSelectionBefore(this.findNode(n),"end"):this.setSelectionAfter(this.findNode(n),"end"):3==n.nodeType&&(this.selection.end={node:this.findNode(n.parentNode),offset:e[t.endOffset]?0:n.textContent.length})}else this.selection.end={node:this.findNode(t.endContainer),offset:1}}return!0}}return!1}destroy(){this.setEditable(!1),h.off(document,`selectionchange.kaitify_${this.guid}`),h.off(this.$el,"beforeinput.kaitify compositionstart.kaitify compositionupdate.kaitify compositionend.kaitify keydown.kaitify keyup.kaitify copy.kaitify focus.kaitify blur.kaitify")}static async configure(e){const t=new be;t.$el=(e=>{if("string"==typeof e&&e&&(e=document.body.querySelector(e)),!r.isElement(e))throw new Error("You must specify a dom container to initialize the editor");if(a.get(e,"data-kaitify-init"))throw new Error("The element node has been initialized to the editor");return a.set(e,"data-kaitify-init",!0),e})(e.el),!1!==e.useDefaultCSS&&(t.$el.className="Kaitify"),"boolean"==typeof e.allowCopy&&(t.allowCopy=e.allowCopy),"boolean"==typeof e.allowCut&&(t.allowCut=e.allowCut),"boolean"==typeof e.allowPaste&&(t.allowPaste=e.allowPaste),"boolean"==typeof e.allowPasteHtml&&(t.allowPasteHtml=e.allowPasteHtml),e.textRenderTag&&(t.textRenderTag=e.textRenderTag),e.blockRenderTag&&(t.blockRenderTag=e.blockRenderTag),e.voidRenderTags&&(t.voidRenderTags=e.voidRenderTags),e.emptyRenderTags&&(t.emptyRenderTags=e.emptyRenderTags),e.extraKeepTags&&(t.extraKeepTags=e.extraKeepTags),e.extensions&&(t.extensions=[...t.extensions,...e.extensions]),e.formatRules&&(t.formatRules=[...e.formatRules,...t.formatRules]),e.domParseNodeCallback&&(t.domParseNodeCallback=e.domParseNodeCallback),e.onUpdateView&&(t.onUpdateView=e.onUpdateView),e.onPasteText&&(t.onPasteText=e.onPasteText),e.onPasteHtml&&(t.onPasteHtml=e.onPasteHtml),e.onPasteImage&&(t.onPasteImage=e.onPasteImage),e.onPasteVideo&&(t.onPasteVideo=e.onPasteVideo),e.onPasteFile&&(t.onPasteFile=e.onPasteFile),e.onChange&&(t.onChange=e.onChange),e.onSelectionUpdate&&(t.onSelectionUpdate=e.onSelectionUpdate),e.onInsertParagraph&&(t.onInsertParagraph=e.onInsertParagraph),e.onDeleteInStart&&(t.onDeleteInStart=e.onDeleteInStart),e.onDeleteComplete&&(t.onDeleteComplete=e.onDeleteComplete),e.onKeydown&&(t.onKeydown=e.onKeydown),e.onKeyup&&(t.onKeyup=e.onKeyup),e.onFocus&&(t.onFocus=e.onFocus),e.onBlur&&(t.onBlur=e.onBlur),e.pasteKeepMarks&&(t.pasteKeepMarks=e.pasteKeepMarks),e.pasteKeepStyles&&(t.pasteKeepStyles=e.pasteKeepStyles),e.afterUpdateView&&(t.afterUpdateView=e.afterUpdateView),t.extensions.forEach((e=>t.registerExtension(e))),t.setEditable("boolean"!=typeof e.editable||e.editable),t.stackNodes=t.htmlParseNode(e.value||""),t.formatRules.forEach((e=>{t.formatNodes(e,t.stackNodes)})),t.checkNodes();return("function"!=typeof t.onUpdateView||await t.onUpdateView.apply(t,[!0]))&&ye.apply(t,[!0]),t.history.setState(t.stackNodes,t.selection),t.oldStackNodes=t.stackNodes.map((e=>e.fullClone())),e.autofocus&&(t.setSelectionAfter(),await t.updateRealSelection()),"function"==typeof t.afterUpdateView&&t.afterUpdateView.apply(t),U(t),h.on(document,`selectionchange.kaitify_${t.guid}`,B.bind(t)),h.on(t.$el,"beforeinput.kaitify",F.bind(t)),h.on(t.$el,"compositionstart.kaitify compositionupdate.kaitify compositionend.kaitify",j.bind(t)),h.on(t.$el,"keydown.kaitify keyup.kaitify",L.bind(t)),h.on(t.$el,"focus.kaitify",q.bind(t)),h.on(t.$el,"blur.kaitify",K.bind(t)),h.on(t.$el,"copy.kaitify",W.bind(t)),t}}e.Editor=be,e.History=E,e.KNode=x,e.NODE_MARK=f,e.Selection=k,e.getNodeRenderOptions=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
!function(){"use strict";try{if("undefined"!=typeof document){var i=document.createElement("style");i.appendChild(document.createTextNode(".Kaitify{font-size:14px;font-family:PingFang SC,Helvetica Neue,Helvetica,Roboto,Segoe UI,Microsoft YaHei,Arial,sans-serif;color:#333;-webkit-font-smoothing:antialiased;text-size-adjust:none;line-height:1.5;border:1px solid #dedede;border-radius:3px;padding:10px;transition:border-color .5s;overflow-x:hidden;overflow-y:auto}.Kaitify:focus{border-color:#4bb4ba}.Kaitify ::selection{background-color:#4bb4ba66}.Kaitify *,.Kaitify *:before,.Kaitify *:after{box-sizing:border-box;-webkit-tap-highlight-color:transparent;outline:none}.Kaitify h1,.Kaitify h2,.Kaitify h3,.Kaitify h4,.Kaitify h5,.Kaitify h6,.Kaitify p{line-height:1.5;margin:0 0 15px!important}.Kaitify h1:last-child,.Kaitify h2:last-child,.Kaitify h3:last-child,.Kaitify h4:last-child,.Kaitify h5:last-child,.Kaitify h6:last-child,.Kaitify p:last-child{margin-bottom:0!important}.Kaitify h1{font-size:48px}.Kaitify h2{font-size:36px}.Kaitify h3{font-size:28px}.Kaitify h4{font-size:24px}.Kaitify h5{font-size:18px}.Kaitify h6{font-size:16px}.Kaitify ol,.Kaitify ul{margin:0 0 15px;padding:0 0 0 20px}.Kaitify ol li,.Kaitify ul li{margin:0 0 15px}.Kaitify ol li:last-child,.Kaitify ul li:last-child{margin-bottom:0}.Kaitify table{width:100%;border:1px solid #dedede;border-collapse:collapse;margin:0 0 15px}.Kaitify table th,.Kaitify table td{border:1px solid #dedede;padding:10px}.Kaitify video,.Kaitify img{display:inline-block;width:auto;max-width:100%;padding:0 2px}.Kaitify code{display:inline-block;padding:2px 4px;margin:0 4px;border-radius:3px;font-family:Consolas,monospace,Monaco,Andale Mono,Ubuntu Mono;background-color:#4bb4ba0f;border:1px solid rgba(222,222,222,.2)}")),document.head.appendChild(i)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}}();
