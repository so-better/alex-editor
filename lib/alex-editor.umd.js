!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlexEditor={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,s)=>(((e,n,s)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s})(e,"symbol"!=typeof n?n+"":n,s),s);const s={formatNumber(e){return this.isNumber(e)?e.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):e},isNumber:e=>"number"==typeof e&&!isNaN(e),add:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=0;try{n=e.toString().split(".")[1].length}catch(r){}try{s=t.toString().split(".")[1].length}catch(r){}return i=Math.pow(10,Math.max(n,s)),(e*i+t*i)/i})),subtract:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=0;try{n=e.toString().split(".")[1].length}catch(r){}try{s=t.toString().split(".")[1].length}catch(r){}return i=Math.pow(10,Math.max(n,s)),(e*i-t*i)/i})),mutiply:(...e)=>e.reduce(((e,t)=>{let n=0,s=e.toString(),i=t.toString();try{n+=s.split(".")[1].length}catch(r){}try{n+=i.split(".")[1].length}catch(r){}return Number(s.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,n)})),divide:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=e.toString(),r=t.toString();try{n=i.split(".")[1].length}catch(o){}try{s=r.split(".")[1].length}catch(o){}return Number(i.replace(".",""))/Number(r.replace(".",""))*Math.pow(10,s-n)}))},i={insert(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if("string"!=typeof t)throw new TypeError("The second argument must be a string");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,n)+t+e.substring(n,e.length)},delete(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,t)+e.substring(t+n,e.length)},replace(e,t,n,i){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");if("string"!=typeof i)throw new TypeError("The fourth argument must be a string");return e.substring(0,t)+i+e.substring(n,e.length)},trim(e,t){if("string"!=typeof e)throw new TypeError("The first argument must be a string");let n=e.replace(/(^\s+)|(\s+$)/g,"");return t&&(n=n.replace(/\s/g,"")),n}},r={isWindow:e=>e&&e instanceof Window,getElementPoint(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(this.isElement(t)||(t=document.body),!this.isContains(t,e))throw new Error("The second argument and the first argument have no hierarchical relationship");let n=e,s=0,i=0;for(;this.isElement(e)&&this.isContains(t,e)&&t!==e;)s+=e.offsetTop,i+=e.offsetLeft,e=e.offsetParent;return{top:s,left:i,right:t.offsetWidth-i-n.offsetWidth,bottom:t.offsetHeight-s-n.offsetHeight}},isContains(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e===t||(e.contains?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t)))},isParentNode(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e!==t&&t.parentNode===e},children(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");return[...e.querySelectorAll(t||"*")].filter((t=>t.parentNode===e))},siblings(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!e.parentNode)return[];return[...e.parentNode.querySelectorAll(t||"*")].filter((t=>t.parentNode===e.parentNode&&t!=e))},rem2px(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.mutiply(e,parseFloat(t))},px2rem(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.divide(e,parseFloat(t))},width(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientWidth,n=parseFloat(this.getCssStyle(e,"padding-left")),i=parseFloat(this.getCssStyle(e,"padding-right"));return s.subtract(t,n,i)},height(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientHeight,n=parseFloat(this.getCssStyle(e,"padding-top")),i=parseFloat(this.getCssStyle(e,"padding-bottom"));return s.subtract(t,n,i)},removeClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;i.trim(t).split(/\s+/).forEach((e=>{n.remove(e)}))},addClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;i.trim(t).split(/\s+/).forEach((e=>{n.add(e)}))},hasClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;return i.trim(t).split(/\s+/).every((e=>n.contains(e)))},scrollTopBottomTrigger(e,t){"string"==typeof e&&e&&(e=document.body.querySelector(e));let n=window;this.isElement(e)&&e!=document.body&&e!=document.documentElement&&(n=e),"function"==typeof e&&(t=e);let i=!0;n.addEventListener("scroll",(()=>{if(this.getScrollTop(n)<=0){if(!i)return;"function"==typeof t&&(i=!1,t({state:"top",target:n}))}else{let e={state:"bottom",target:n},r=0;if(r=n==window?window.innerHeight:n.clientHeight,s.add(this.getScrollTop(n),r)+1>=this.getScrollHeight(n)&&r!=this.getScrollHeight(n)){if(!i)return;"function"==typeof t&&(i=!1,t(e))}else i=!0}}))},getScrollWidth(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth,t},getScrollHeight(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight,t},setScrollTop(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let i=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise((e=>{if(r<=0)t?document.documentElement.scrollTop=document.body.scrollTop=i:n.scrollTop=i,e();else{let o=10,l=s.divide(r,o),a=this.getScrollTop(n),h=s.divide(s.subtract(i,a),l),c=setInterval((()=>{l>0?(l--,t?document.documentElement.scrollTop=document.body.scrollTop=a=s.add(a,h):n.scrollTop=a=s.add(a,h)):(clearInterval(c),e())}),o)}}))},getScrollTop(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,t},getScrollLeft(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,t},setScrollLeft(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let i=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise((e=>{if(r<=0)t?document.documentElement.scrollLeft=document.body.scrollLeft=i:n.scrollLeft=i,e();else{let o=10,l=s.divide(r,o),a=this.getScrollLeft(n),h=s.divide(s.subtract(i,a),l),c=setInterval((()=>{l>0?(l--,t?document.documentElement.scrollLeft=document.body.scrollLeft=a=s.add(a,h):n.scrollLeft=a=s.add(a,h)):(clearInterval(c),e())}),o)}}))},getCssStyle(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n="";return n=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e)[t]:e.currentStyle[t],n},getCssSelector(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a selector string");if(/^#{1}/.test(e))return{type:"id",value:e.substr(1)};if(/^\./.test(e))return{type:"class",value:e.substr(1)};if(/^\[(.+)\]$/.test(e)){let t="attribute",n="",s=i.trim(e,!0).substring(1,i.trim(e,!0).length-1).split("=");return 1==s.length&&(n=s[0]),2==s.length&&(n={attributeName:s[0],attributeValue:s[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:t,value:n}}return{type:"tag",value:e}},getElementBounding(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.getBoundingClientRect();return{top:t.top,bottom:s.subtract(document.documentElement.clientHeight||window.innerHeight,t.bottom),left:t.left,right:s.subtract(document.documentElement.clientWidth||window.innerWidth,t.right)}},isElement:e=>e&&e instanceof Node&&1===e.nodeType,string2dom(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be an HTML string");const t=document.createElement("template");return t.innerHTML=e,1==t.content.children.length?t.content.children[0]:Array.from(t.content.children)}},o="_dap-datas",l={remove(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};null==t||""===t?e[o]={}:(delete n[t],e[o]=n)},has(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");return(e[o]||{}).hasOwnProperty(t)},get(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};return null==t||""===t?n:n[t]},set(e,t,n){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");let s=e[o]||{};s[t]=n,e[o]=s}},a={matchingText(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=null;if("Chinese"==t&&(n=/^[\u4e00-\u9fa5]+$/),"chinese"==t&&(n=/[\u4e00-\u9fa5]/),"email"==t&&(n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/),"username"==t&&(n=/^[a-zA-Z0-9_]{4,16}$/),"int+"==t&&(n=/^\d+$/),"int-"==t&&(n=/^-\d+$/),"int"==t&&(n=/^-?\d+$/),"pos"==t&&(n=/^\d*\.?\d+$/),"neg"==t&&(n=/^-\d*\.?\d+$/),"number"==t&&(n=/^-?\d*\.?\d+$/),"phone"==t&&(n=/^1[0-9]\d{9}$/),"idCard"==t&&(n=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/),"url"==t&&(n=/^(https?|ftp):\/\/(-\.)?([^\s\/?\.#-]+\.?)+(\/[^\s]*)?$/),"IPv4"==t&&(n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),"hex"==t&&(n=/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/),"rgb"==t&&(n=/^rgb\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\)$/),"rgba"==t&&(n=/^rgba\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(0?\.\d|1(\.0)?|0)\)$/),"QQ"==t&&(n=/^[1-9][0-9]{4,10}$/),"weixin"==t&&(n=/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/),"plate"==t&&(n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/),!n)throw new Error("The second parameter is out of scope");return n.test(e)},getUrlParams(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1);if(!n){let e=window.location.hash.split("?");2==e.length&&(n=e[1])}let s=n.match(t);return s?decodeURIComponent(s[2]):null},isEmptyObject(e){return!!this.isObject(e)&&0==Object.keys(e).length},equal(e,t){if(typeof e!=typeof t)return!1;if(this.isObject(e)&&this.isObject(t)){let n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(n.length!=s.length)return!1;let i=n.length,r=!0;for(let o=0;o<i;o++){let s=n[o],i=e[s],l=t[s];if(!this.equal(i,l)){r=!1;break}}return r}return e===t},isObject:e=>!("object"!=typeof e||!e),copyText(e){if(!e||"string"!=typeof e)throw new TypeError("No text to copy is defined");if(!navigator.clipboard)throw new Error("navigator.clipboard must be obtained in a secure environment, such as localhost, 127.0.0.1, or https, so the method won't work");return navigator.clipboard.writeText(e)},clone(e){if(this.isObject(e)){if(Array.isArray(e))return e.map((e=>this.clone(e)));let t={};for(let n in e)t[n]=this.clone(e[n]);return t}return e}},h=e=>{let t=e.split(/[\s]+/g),n=[];return t.forEach((e=>{let t=e.split("."),s={eventName:t[0]};t.length>1&&(s.guid=t[1]),n.push(s)})),n},c=(e,t,n)=>{let s=l.get(e,"dap-defined-events")||{},i=Object.keys(s),r=i.length;for(let o=0;o<r;o++){let r=i[o];s[r].type==t&&(n?r==t+"."+n&&(e.removeEventListener(s[r].type,s[r].fn,s[r].options),s[r]=void 0):(e.removeEventListener(s[r].type,s[r].fn,s[r].options),s[r]=void 0))}s=(e=>{let t={};return Object.keys(e).forEach((n=>{e[n]&&(t[n]=e[n])})),t})(s),l.set(e,"dap-defined-events",s)},m={on(e,t,n,s){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!n||"function"!=typeof n)throw new TypeError("The third argument must be a function");a.isObject(s)||(s={});h(t).forEach((t=>{((e,t,n,s,i)=>{let r=l.get(e,"dap-defined-events")||{};n||(n=l.get(e,"dap-event-guid")||0,l.set(e,"dap-event-guid",n+1)),r[n=t+"."+n]&&r[n].type==t&&e.removeEventListener(t,r[n].fn,r[n].options),e.addEventListener(t,s,i),r[n]={type:t,fn:s,options:i},l.set(e,"dap-defined-events",r)})(e,t.eventName,t.guid,n.bind(e),s)}))},off(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=l.get(e,"dap-defined-events");if(!n)return;if(!t){let t=Object.keys(n),s=t.length;for(let i=0;i<s;i++){let s=t[i];e.removeEventListener(n[s].type,n[s].fn,n[s].options)}return l.remove(e,"dap-defined-events"),void l.remove(e,"dap-event-guid")}h(t).forEach((t=>{c(e,t.eventName,t.guid)}))},get(e){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let t=l.get(e,"dap-defined-events");if(t)return t}},d={getImageUrl(e){if(!(e&&e instanceof File))throw new TypeError("The argument must be a File object");return window.URL.createObjectURL(e)},dataFileToBase64:e=>new Promise(((t,n)=>{e&&e instanceof File||n(new TypeError("The argument must be a File object"));let s=new FileReader;s.readAsDataURL(e),s.onloadend=()=>{let e=s.result;t(e)}})),dataBase64toFile(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.split(","),s=n[0].match(/:(.*?);/)[1],i=atob(n[1]),r=i.length,o=new Uint8Array(r);for(;r--;)o[r]=i.charCodeAt(r);return new File([o],t,{type:s})},compressImage(e,t){const n={width:void 0,quality:.8,mimeType:"jpeg",maxSize:0,minSize:0};a.isObject(t)&&(s.isNumber(t.width)&&(n.width=t.width),s.isNumber(t.quality)&&t.quality>=0&&t.quality<=1&&(n.quality=t.quality),"jpeg"!=t.mimeType&&"webp"!=t.mimeType||(n.mimeType=t.mimeType),s.isNumber(t.maxSize)&&(n.maxSize=t.maxSize),s.isNumber(t.minSize)&&(n.minSize=t.minSize));const i=(e,t,s)=>{let r=e.toDataURL("image/"+n.mimeType,s),o=this.dataBase64toFile(r,t);if(n.maxSize>0&&o.size>1024*n.maxSize){s=s<=0?0:Number((s-.01).toFixed(2));const n=i(e,t,s);r=n.url,o=n.file,s=n.quality}return{file:o,url:r,quality:s}};return new Promise(((t,s)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>{let o=r.result,l=new Image;l.src=o,l.onload=()=>{if(n.minSize>0&&e.size<=1024*n.minSize)return void t({file:e,url:o,quality:1,width:l.width,height:l.height});let s=document.createElement("canvas"),r=s.getContext("2d");s.width=n.width||l.width,s.height=n.width?n.width/(l.width/l.height):l.height,r.drawImage(l,0,0,s.width,s.height);let a=e.name.lastIndexOf(".");const h=e.name.substring(0,a)+"."+n.mimeType;let c=i(s,h,n.quality);t({...c,width:s.width,height:s.height})},l.onerror=()=>{s(new Error("Failed to load image file"))}},r.onerror=()=>{s(new Error("Failed to load image file"))}}))}},u={language:()=>window.navigator.browserLanguage||window.navigator.language,device(){const e=window.navigator.userAgent;return{PC:!e.match(/AppleWebKit.*Mobile.*/),Mobile:!!e.match(/AppleWebKit.*Mobile.*/),iPhone:e.includes("iPhone"),Phone:e.includes("Android")&&/(?:Mobile)/.test(e)||e.includes("iPhone")||/(?:Windows Phone)/.test(e),iPad:e.includes("iPad"),Tablet:e.includes("iPad")||e.includes("Android")&&!/(?:Mobile)/.test(e)||e.includes("Firefox")&&/(?:Tablet)/.test(e),WindowsPhone:/(?:Windows Phone)/.test(e)}},browser(){const e=window.navigator.userAgent;return{Edge:!!e.match(/Edg\/([\d.]+)/),weixin:e.includes("MicroMessenger"),QQ:e.includes("QQ"),QQBrowser:e.includes("MQQBrowser"),UC:e.includes("UCBrowser"),Chrome:e.includes("Chrome"),Firefox:e.includes("Firefox"),sougou:e.toLocaleLowerCase().includes("se 2.x")||e.toLocaleLowerCase().includes("metasr")||e.toLocaleLowerCase().includes("sogou"),Safari:e.includes("Safari")&&!e.includes("Chrome")}},browserKernel(){const e=window.navigator.userAgent;return e.includes("Presto")?"opera":e.includes("AppleWebKit")?"webkit":e.includes("Gecko")&&!e.includes("KHTML")?"gecko":""},os(){const e=window.navigator.userAgent;return{Windows:e.includes("Windows"),Windows_CPU:e.toLocaleLowerCase().includes("win64")||e.toLocaleLowerCase().includes("wow64")?"x64":e.toLocaleLowerCase().includes("win32")||e.toLocaleLowerCase().includes("wow32")?"x32":"",Windows_Version:e.includes("Windows NT 6.1")||e.includes("Windows 7")?"Win7":e.includes("Windows NT 6.3")||e.includes("Windows NT 6.2")||e.includes("Windows NT 8")?"Win8":e.includes("Windows NT 10")||e.includes("Windows NT 6.4")?"Win10":"",Mac:e.includes("Macintosh"),Mac_Version:function(){if(e.includes("Macintosh")){const t=e.match(/Mac OS X ([^\s]+)\)/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ios_Version:function(){if(e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){const t=e.match(/CPU.+OS ([^\s]+) like Mac OS X/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),Android:e.includes("Android"),Android_Version:function(){const t=e.match(/Android ([^\s]+);/);return t&&t[1]?t[1].split(/_|\./).join("."):""}(),Linux:e.includes("Linux"),HarmonyOS:e.includes("HarmonyOS"),Ubuntu:e.includes("Ubuntu")}}},f=function(e){return/^[\uFEFF]+$/g.test(e)},p=function(e,t){return 3==t.nodeType?r.isContains(e,t.parentNode):r.isContains(e,t)},g=function(e,t){if(!e)return null;const n=t=>{let s=null;const i=t.length;for(let r=0;r<i;r++){const i=t[r];if(i&&i.key===e){s=i;break}if(i&&i.hasChildren()){const e=n(i.children);if(e){s=e;break}}}return s};return n(t)},y=class e{constructor(e,t,s,i,r){n(this,"key",function(){let e=l.get(window,"data-alex-editor-key")||0;return e++,l.set(window,"data-alex-editor-key",e),e}()),n(this,"type"),n(this,"parsedom"),n(this,"marks"),n(this,"styles"),n(this,"textContent"),n(this,"children",null),n(this,"parent",null),n(this,"behavior","default"),n(this,"namespace",null),n(this,"locked",!1),n(this,"elm",null),this.type=e,this.parsedom=t,this.marks=s,this.styles=i,this.textContent=r?r.replace(/\r\n/g,"\n"):r}isBlock(){return"block"==this.type}isInblock(){return"inblock"==this.type}isInline(){return"inline"==this.type}isClosed(){return"closed"==this.type}isText(){return"text"==this.type}isBreak(){return this.isClosed()&&"br"==this.parsedom}isEmpty(){return this.isText()?!this.textContent:!!(this.isBlock()||this.isInblock()||this.isInline())&&(!this.hasChildren()||this.children.every((e=>e.isEmpty())))}isSpaceText(){return!this.isEmpty()&&this.isText()&&f(this.textContent)}getUneditableElement(){return this.hasMarks()&&"false"==this.marks.contenteditable?this:this.parent?this.parent.getUneditableElement():null}isEqual(t){return!!e.isElement(t)&&this.key==t.key}isContains(e){return!!this.isEqual(e)||!!e.parent&&this.isContains(e.parent)}isOnlyHasBreak(){if(this.hasChildren()){const e=this.children.filter((e=>!e.isEmpty()));return e.length&&e.every((e=>e.isBreak()))}return!1}isPreStyle(){const e=this.getInblock()||this.getBlock();return"pre"==e.parsedom||(!(!e.hasStyles()||!["pre","pre-wrap"].includes(e.styles["white-space"]))||!!e.parent&&e.parent.isPreStyle())}hasMarks(){return!!this.marks&&(!!a.isObject(this.marks)&&!a.isEmptyObject(this.marks))}hasStyles(){return!!this.styles&&(!!a.isObject(this.styles)&&!a.isEmptyObject(this.styles))}hasChildren(){return!this.isClosed()&&!this.isText()&&(!!Array.isArray(this.children)&&!!this.children.length)}hasContains(e){return this.isContains(e)||e.isContains(this)}clone(t=!0){if("boolean"!=typeof t)throw new Error("The parameter must be a Boolean");let n=new e(this.type,this.parsedom,a.clone(this.marks),a.clone(this.styles),this.textContent);return n.behavior=this.behavior,n.namespace=this.namespace,n.locked=this.locked,t&&this.hasChildren()&&this.children.forEach((e=>{let s=e.clone(t);n.hasChildren()?n.children.push(s):n.children=[s],s.parent=n})),n}convertToBlock(){if(this.isBlock())return;let t=this.clone();this.type="block",this.parsedom=e.BLOCK_NODE,this.marks=null,this.styles=null,this.textContent=null,this.children=[t],t.parent=this}toEmpty(){if(!this.isEmpty())return this.isText()?(this.marks=null,this.styles=null,this.textContent=null,this.elm=null,this.namespace=null,void(this.locked=!1)):this.isClosed()?(this.type="text",this.parsedom=null,this.marks=null,this.styles=null,this.textContent=null,this.elm=null,this.namespace=null,void(this.locked=!1)):void(this.hasChildren()&&this.children.forEach((e=>{e.toEmpty()})))}getBlock(){return this.parent?this.parent.getBlock():this}getInblock(){return this.isInblock()?this:this.parent?this.parent.getInblock():null}getInline(){return this.isInline()?this:this.parent?this.parent.getInline():null}isEqualStyles(e){return!this.hasStyles()&&!e.hasStyles()||!!(this.hasStyles()&&e.hasStyles()&&a.equal(this.styles,e.styles))}isEqualMarks(e){return!this.hasMarks()&&!e.hasMarks()||!!(this.hasMarks()&&e.hasMarks()&&a.equal(this.marks,e.marks))}isFirst(t){if(!this.isText()&&!this.isClosed())return!1;if(t.isEqual(this))return!1;if(t.isContains(this)){const n=e.flatElements(t.children).filter((e=>e.isText()||e.isClosed()));return this.isEqual(n[0])}return!1}isLast(t){if(!this.isText()&&!this.isClosed())return!1;if(t.isEqual(this))return!1;if(t.isContains(this)){const n=e.flatElements(t.children).filter((e=>e.isText()||e.isClosed()));return this.isEqual(n[n.length-1])}return!1}__render(){let t=null;this.isText()?(t=this.namespace?document.createElementNS(this.namespace,e.TEXT_NODE):document.createElement(e.TEXT_NODE),t.textContent=this.textContent):(t=this.namespace?document.createElementNS(this.namespace,this.parsedom):document.createElement(this.parsedom),this.hasChildren()&&this.children.forEach((e=>{e.__render(),t.appendChild(e.elm)}))),this.hasMarks()&&Object.keys(this.marks).forEach((e=>{/(^on)|(^style$)|(^face$)/g.test(e)||t.setAttribute(e,this.marks[e])})),this.hasStyles()&&Object.keys(this.styles).forEach((e=>{t.style.setProperty(e,this.styles[e])})),l.set(t,"data-alex-editor-key",this.key),this.elm=t}__fullClone(){let t=new e(this.type,this.parsedom,a.clone(this.marks),a.clone(this.styles),this.textContent);return t.behavior=this.behavior,t.namespace=this.namespace,t.locked=this.locked,t.key=this.key,t.elm=this.elm,this.hasChildren()&&(t.children=this.children.map((e=>{const n=e.__fullClone();return n.parent=t,n}))),t}static isElement(t){return t instanceof e}static flatElements(e){const t=e=>{let n=[];const s=e.length;for(let i=0;i<s;i++)if(e[i]&&(n.push(e[i]),e[i].hasChildren())){const s=t(e[i].children);n.push(...s)}return n};return t(e)}static getSpaceElement(){return new e("text",null,null,null,"\ufeff")}static create(t){let n=null;return"text"==t.type?n=new e(t.type,null,t.marks?t.marks:null,t.styles?t.styles:null,t.textContent?t.textContent:null):(n=new e(t.type,t.parsedom,t.marks?t.marks:null,t.styles?t.styles:null,null),"inblock"==t.type&&t.behavior&&(n.behavior=t.behavior),"closed"!=t.type&&Array.isArray(t.children)&&(n.children=t.children.map((t=>{const s=e.create(t);return s.parent=n,s})))),t.namespace&&(n.namespace=t.namespace),"boolean"==typeof t.locked&&(n.locked=t.locked),n}};n(y,"BLOCK_NODE","p"),n(y,"TEXT_NODE","span"),n(y,"VOID_NODES",["colgroup","col"]),n(y,"EMPTY_NODES",["meta","link","style","script","title","base","noscript","template","annotation"]);let E=y;class b{constructor(e,t){n(this,"anchor"),n(this,"focus"),this.anchor=e,this.focus=t}}class w{constructor(e,t){if(n(this,"element"),n(this,"offset"),this.element=e,this.offset=t,this.element.isText()||this.element.isClosed()){if(E.VOID_NODES.includes(this.element.parsedom))throw new Error("Invisible element cannot be set as focal point")}else 0==this.offset?this.moveToStart(this.element):this.moveToEnd(this.element)}static isPoint(e){return e instanceof w}isEqual(e){return!!w.isPoint(e)&&(this.element.isEqual(e.element)&&this.offset==e.offset)}moveToEnd(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=e.textContent.length;else if(e.isClosed()){if(E.VOID_NODES.includes(e.parsedom))throw new Error("Invisible element cannot be set as focal point");this.element=e,this.offset=1}else if(e.hasChildren()){const t=E.flatElements(e.children).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom))),n=t.length;if(0==n)throw new Error("There is no element to set the focus");this.moveToEnd(t[n-1])}}moveToStart(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=0;else if(e.isClosed()){if(E.VOID_NODES.includes(e.parsedom))throw new Error("Invisible element cannot be set as focal point");this.element=e,this.offset=0}else if(e.hasChildren()){const t=E.flatElements(e.children).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom)));if(0==t.length)throw new Error("There is no element to set the focus");this.moveToStart(t[0])}}}class T{constructor(){n(this,"records",[]),n(this,"redoRecords",[])}cloneRange(e,t){if(t){const n=g(t.anchor.element.key,e),s=g(t.focus.element.key,e);if(n&&s){const e=new w(n,t.anchor.offset),i=new w(s,t.focus.offset);return new b(e,i)}}return null}setState(e,t){const n=e.map((e=>e.__fullClone())),s=this.cloneRange(n,t);this.records.push({stack:e.map((e=>e.__fullClone())),range:s}),this.redoRecords=[]}undo(){if(this.records.length>1){const e=this.records.pop();this.redoRecords.push(e);const t=this.records[this.records.length-1],n=t.stack.map((e=>e.__fullClone()));return{stack:n,range:this.cloneRange(n,t.range)}}return null}redo(){if(this.redoRecords.length>0){const e=this.redoRecords.pop();this.records.push(e);const t=e.stack.map((e=>e.__fullClone()));return{stack:t,range:this.cloneRange(t,e.range)}}return null}updateRange(e){const t=this.records[this.records.length-1],n=this.cloneRange(t.stack,e);this.records[this.records.length-1].range=n}}const x=[{parsedom:"p"},{parsedom:"div"},{parsedom:"table"},{parsedom:"ul"},{parsedom:"ol"},{parsedom:"h1"},{parsedom:"h2"},{parsedom:"h3"},{parsedom:"h4"},{parsedom:"h5"},{parsedom:"h6"},{parsedom:"blockquote"},{parsedom:"pre"},{parsedom:"address",parse:!0},{parsedom:"article",parse:!0},{parsedom:"aside",parse:!0},{parsedom:"nav",parse:!0},{parsedom:"section",parse:!0}],k=[{parsedom:"br"},{parsedom:"col"},{parsedom:"img"},{parsedom:"hr"},{parsedom:"video"},{parsedom:"audio"}],C=[{parsedom:"li",block:!0},{parsedom:"tfoot"},{parsedom:"tbody"},{parsedom:"thead"},{parsedom:"tr"},{parsedom:"th"},{parsedom:"td"},{parsedom:"colgroup"}],v=[{parsedom:"span"},{parsedom:"a"},{parsedom:"label"},{parsedom:"code"},{parsedom:"b",parse:{"font-weight":"bold"}},{parsedom:"strong",parse:{"font-weight":"bold"}},{parsedom:"sup",parse:{"vertical-align":"super"}},{parsedom:"sub",parse:{"vertical-align":"sub"}},{parsedom:"i",parse:{"font-style":"italic"}},{parsedom:"u",parse:{"text-decoration-line":"underline"}},{parsedom:"del",parse:{"text-decoration-line":"line-through"}},{parsedom:"abbr",parse:!0},{parsedom:"acronym",parse:!0},{parsedom:"bdo",parse:!0},{parsedom:"font",parse:{"font-family":e=>e.getAttribute("face")||""}}],_=function(e){if(e.hasChildren()){e.children.filter((e=>!e.isEmpty()&&e.isBlock())).forEach((t=>{t.type="inline"==e.type?"inline":"inblock","inblock"==t.type&&(t.behavior="block")}))}},S=function(e){if(e.hasChildren()){const t=e.children.filter((e=>!e.isEmpty())),n=t.filter((e=>e.isInblock()));n.length&&n.length!=t.length&&n.forEach((e=>{e.type="inline"}))}},P=function(e){if(e.isInline()&&e.hasChildren()){e.children.filter((e=>!e.isEmpty()&&e.isInblock())).forEach((e=>{e.type="inline"}))}},O=function(e){if(e.hasChildren()){const t=e.children.filter((e=>!e.isEmpty())),n=t.filter((e=>e.isBreak()));e.isInline()&&n.length?n.forEach((e=>{e.toEmpty()})):t.length>1&&n.length==t.length?(this.range&&e.isContains(this.range.anchor.element)&&this.range.anchor.moveToStart(n[0]),this.range&&e.isContains(this.range.focus.element)&&this.range.focus.moveToStart(n[0]),e.children=[n[0]]):t.length>1&&n.length&&n.forEach((e=>{e.toEmpty()}))}},I=function(e){const t=(e,t)=>{if(e.isEmpty()||t.isEmpty()){if(t.isEmpty()){this.range&&t.isContains(this.range.anchor.element)&&(e.isEmpty()?(this.range.anchor.element=e,this.range.anchor.offset=0):this.range.anchor.moveToEnd(e)),this.range&&t.isContains(this.range.focus.element)&&(e.isEmpty()?(this.range.focus.element=e,this.range.focus.offset=0):this.range.focus.moveToEnd(e));const n=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(n,1)}else if(e.isEmpty()){this.range&&e.isContains(this.range.anchor.element)&&(t.isEmpty()?(this.range.anchor.element=t,this.range.anchor.offset=0):this.range.anchor.moveToStart(t)),this.range&&e.isContains(this.range.focus.element)&&(t.isEmpty()?(this.range.focus.element=t,this.range.focus.offset=0):this.range.focus.moveToStart(t));const n=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(n,1)}}else if(e.isText()){this.range&&t.isEqual(this.range.anchor.element)&&(this.range.anchor.element=e,this.range.anchor.offset=e.textContent.length+this.range.anchor.offset),this.range&&t.isEqual(this.range.focus.element)&&(this.range.focus.element=e,this.range.focus.offset=e.textContent.length+this.range.focus.offset),e.textContent+=t.textContent;const n=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(n,1)}else if(e.isInline()){e.children.push(...t.children),e.children.forEach((t=>{t.parent=e})),n(e);const s=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(s,1)}},n=e=>{if(e.hasChildren()&&e.children.length>1){let i=0;for(;e.hasChildren()&&i<=e.children.length-2;)n=e.children[i],s=e.children[i+1],n.locked||s.locked||!(n.isEmpty()||s.isEmpty()||(n.isText()&&s.isText()?n.isEqualStyles(s)&&n.isEqualMarks(s):n.isInline()&&s.isInline()&&n.parsedom==s.parsedom&&n.isEqualMarks(s)&&n.isEqualStyles(s)))?i++:(t(e.children[i],e.children[i+1]),N.apply(this,[e]))}var n,s};n(e)},N=function(e){const t=(e,t)=>{t.isText()?(e.type="text",e.parsedom=null,t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,a.clone(t.marks)):e.marks=a.clone(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,a.clone(t.styles)):e.styles=a.clone(t.styles)),e.textContent=t.textContent,e.children=null,this.range&&t.isContains(this.range.anchor.element)&&(this.range.anchor.element=e),this.range&&t.isContains(this.range.focus.element)&&(this.range.focus.element=e)):(t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,a.clone(t.marks)):e.marks=a.clone(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,a.clone(t.styles)):e.styles=a.clone(t.styles)),t.hasChildren()&&(e.children=[...t.children],e.children.forEach((t=>{t.parent=e}))),n(e))},n=e=>{var n,s;e.hasChildren()&&1==e.children.length&&e.children[0]&&(n=e,s=e.children[0],!n.locked&&!s.locked&&(s.isText()&&n.isInline()?n.parsedom==E.TEXT_NODE:(n.isInline()&&s.isInline()||n.isInblock()&&s.isInblock())&&n.parsedom==s.parsedom))&&(t(e,e.children[0]),e.parent&&I.apply(this,[e.parent]))};n(e)},B=function(e){if(e.isText()&&!e.isEmpty()&&e.textContent.split("").some((e=>f(e)))){let t=e.textContent,n=0;for(;n<t.length;){const s=t.charAt(n);f(s)&&n>0&&f(t.charAt(n-1))?(this.range&&this.range.anchor.element.isEqual(e)&&this.range.anchor.offset>=n+1&&(this.range.anchor.offset-=1),this.range&&this.range.focus.element.isEqual(e)&&this.range.focus.offset>=n+1&&(this.range.focus.offset-=1),t=i.delete(t,n,1)):n++}e.textContent=t}},A=function(e,t){let n="",s="";return t.forEach((e=>{const t=e.element.clone();e.offset&&(t.textContent=t.textContent.substring(e.offset[0],e.offset[1])),t.__render(),n+=t.elm.outerHTML,s+=t.elm.innerText})),e.setData("text/plain",s),e.setData("text/html",n),{html:n,text:s}},D=async function(e,t,n){if(e)if(this.allowPasteHtml){const t=this.parseHtml(e).filter((e=>!e.isEmpty()));if("function"==typeof this.customHtmlPaste)await this.customHtmlPaste.apply(this,[t,e]);else{this.insertElement(t[0]);for(let e=t.length-1;e>=1;e--)this.addElementAfter(t[e],t[0]);this.range.anchor.moveToEnd(t[t.length-1]),this.range.focus.moveToEnd(t[t.length-1]),this.emit("pasteHtml",t,e)}}else t&&("function"==typeof this.customTextPaste?await this.customTextPaste.apply(this,[t]):(this.insertText(t),this.emit("pasteText",t)));else if(t)"function"==typeof this.customTextPaste?await this.customTextPaste.apply(this,[t]):(this.insertText(t),this.emit("pasteText",t));else{let e=n.length;for(let t=0;t<e;t++)if(n[t].type.startsWith("image/"))if("function"==typeof this.customImagePaste)await this.customImagePaste.apply(this,[n[t]]);else{const e=await d.dataFileToBase64(n[t]),s=new E("closed","img",{src:e},null,null);this.insertElement(s),this.emit("pasteImage",e)}else if(n[t].type.startsWith("video/"))if("function"==typeof this.customVideoPaste)await this.customVideoPaste.apply(this,[n[t]]);else{const e=await d.dataFileToBase64(n[t]),s=new E("closed","video",{src:e},null,null);this.insertElement(s),this.emit("pasteVideo",e)}else"function"==typeof this.customFilePaste&&await this.customFilePaste.apply(this,[n[t]])}},q=function(){for(var e;this.__illegalDoms.length>0;){const t=this.__illegalDoms[0];null==(e=t.parentNode)||e.removeChild(t),this.__illegalDoms.splice(0,1)}},L=function(){window.MutationObserver||console.warn("The current browser does not support MutationObserver"),this.__domObserver&&(this.__domObserver.disconnect(),this.__domObserver=null),this.__domObserver=new MutationObserver((e=>{let t=e.length;for(let n=0;n<t;n++)if("childList"==e[n].type){const t=e[n].addedNodes.length;for(let s=0;s<t;s++){const t=e[n].addedNodes[s];if(3==t.nodeType){const e=t.parentNode,n=e?l.get(e,"data-alex-editor-key"):null,s=n?this.getElementByKey(n):null;s&&!s.isText()&&this.__illegalDoms.push(t)}else r.isElement(t)&&!l.get(t,"data-alex-editor-key")&&this.__illegalDoms.push(t)}}})),this.__domObserver.observe(this.$el,{attributes:!1,childList:!0,subtree:!0})},R=function(){this.__domObserver&&(this.__domObserver.disconnect(),this.__domObserver=null)},M=function(){if(0==E.flatElements(this.stack).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom))).length){const e=new E("block",E.BLOCK_NODE,null,null,null),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e]}},H=function(e){const t=this.getPreviousElementOfPoint(e),n=this.getNextElementOfPoint(e),s=e.element.getBlock(),i=e.element.getInblock();t&&i&&i.isContains(t)?e.moveToEnd(t):n&&i&&i.isContains(n)?e.moveToStart(n):t&&s.isContains(t)?e.moveToEnd(t):n&&s.isContains(n)?e.moveToStart(n):t?e.moveToEnd(t):n&&e.moveToStart(n)},$=function(e){e.isInblock()&&"default"==e.behavior&&e.hasChildren()&&e.children.forEach((e=>{if(e.isInblock()&&"default"==e.behavior)$.apply(this,[e]);else if(e.toEmpty(),e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}}))},W=function(){const e=async e=>{const t=r.getScrollHeight(e),n=r.getScrollWidth(e);if(e.clientHeight<t||e.clientWidth<n){const s=window.getSelection();if(0==s.rangeCount)return;const i=s.getRangeAt(0),o=i.getClientRects();let l=i;0==o.length&&(l=this.range.focus.element.elm);const a=l.getBoundingClientRect(),h=e.getBoundingClientRect();if(e.clientHeight<t)if(a.top<h.top){await r.setScrollTop({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollTop({el:e,number:t.top-n.top})}else if(a.bottom>h.bottom){await r.setScrollTop({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollTop({el:e,number:t.bottom-n.bottom})}if(e.clientWidth<n)if(a.left<h.left){await r.setScrollLeft({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollLeft({el:e,number:t.left-n.left+20})}else if(a.right>h.right){await r.setScrollLeft({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollLeft({el:e,number:t.right-n.right+20})}}};if(this.range&&this.range.focus.element.elm){let t=this.range.focus.element.elm;for(;r.isElement(t)&&t!=document.documentElement;)e(t),t=t.parentNode}},F=function(){if(0==E.flatElements(this.stack).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom))).length){const e=new E("block",E.BLOCK_NODE,null,null,null),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e],this.range&&(this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t))}},j=function(e,t,n){const s=n.findIndex((t=>t.isEqual(e)));if(!(s<0))if(e.isEmpty())this.range&&e.isContains(this.range.anchor.element)&&H.apply(this,[this.range.anchor]),this.range&&e.isContains(this.range.focus.element)&&H.apply(this,[this.range.focus]),n.splice(s,1);else if(t.apply(this,[e]),e.isEmpty()){this.range&&e.isContains(this.range.anchor.element)&&H.apply(this,[this.range.anchor]),this.range&&e.isContains(this.range.focus.element)&&H.apply(this,[this.range.focus]);const t=n.findIndex((t=>t.isEqual(e)));n.splice(t,1)}else if(e.isBlock()||n!==this.stack||e.convertToBlock(),e.hasChildren()&&e.children.forEach((n=>{j.apply(this,[n,t,e.children])})),e.isEmpty()){this.range&&e.isContains(this.range.anchor.element)&&H.apply(this,[this.range.anchor]),this.range&&e.isContains(this.range.focus.element)&&H.apply(this,[this.range.focus]);const t=n.findIndex((t=>t.isEqual(e)));n.splice(t,1)}},{Mac:K}=u.os(),V=function(){if(this.__isInputChinese)return;if(this.__innerSelectionChange)return;const e=window.getSelection();if(e&&e.rangeCount){const t=e.getRangeAt(0);if(p(this.$el,t.startContainer)&&p(this.$el,t.endContainer)){let e=null,n=null,s=null,i=null;if(3==t.startContainer.nodeType)e=t.startContainer.parentNode,s=t.startOffset;else if(1==t.startContainer.nodeType){const n=Array.from(t.startContainer.childNodes);n.length?(e=n[t.startOffset]?n[t.startOffset]:n[t.startOffset-1],s=n[t.startOffset]?0:1,3==e.nodeType&&(s=0==s?0:e.textContent.length,e=e.parentNode)):(e=t.startContainer,s=0)}if(3==t.endContainer.nodeType)n=t.endContainer.parentNode,i=t.endOffset;else if(1==t.endContainer.nodeType){const e=Array.from(t.endContainer.childNodes);e.length?(n=e[t.endOffset]?e[t.endOffset]:e[t.endOffset-1],i=e[t.endOffset]?0:1,3==n.nodeType&&(i=0==i?0:n.textContent.length,n=n.parentNode)):(n=t.endContainer,i=1)}const r=l.get(e,"data-alex-editor-key"),o=l.get(n,"data-alex-editor-key"),a=this.getElementByKey(r),h=this.getElementByKey(o),c=new w(a,s),m=new w(h,i);this.range?(this.range.anchor=c,this.range.focus=m):this.range=new b(c,m),this.history.updateRange(this.range),this.emit("rangeUpdate",this.range)}}},z=function(e){const t=e;"deleteByCut"!=t.inputType&&"insertFromPaste"!=t.inputType&&"deleteByDrag"!=t.inputType&&"insertFromDrop"!=t.inputType&&(t.preventDefault(),this.disabled||("insertText"==t.inputType&&t.data?(this.insertText(t.data),this.domRender(),this.rangeRender()):"insertParagraph"==t.inputType||"insertLineBreak"==t.inputType?(this.insertParagraph(),this.domRender(),this.rangeRender()):"deleteContentBackward"==t.inputType&&(this.delete(),this.domRender(),this.rangeRender())))},U=function(e){const t=e;t.preventDefault(),this.disabled||("compositionstart"==t.type?(this.__chineseInputTimer&&(clearTimeout(this.__chineseInputTimer),this.__chineseInputTimer=null),this.__isInputChinese=!0):"compositionend"==t.type&&(t.data&&(this.insertText(t.data),this.domRender(),this.rangeRender()),this.__chineseInputTimer=setTimeout((()=>{this.__isInputChinese=!1}),0)))},X=function(e){if(this.__isInputChinese)return;const t=e;"keydown"==t.type?(!function(e){return K?"z"==e.key.toLocaleLowerCase()&&e.metaKey&&!e.shiftKey&&!e.altKey&&!e.ctrlKey:"z"==e.key.toLocaleLowerCase()&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey}(t)?function(e){return K?"z"==e.key.toLocaleLowerCase()&&e.metaKey&&e.shiftKey&&!e.altKey&&!e.ctrlKey:"y"==e.key.toLocaleLowerCase()&&e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey}(t)&&(t.preventDefault(),this.redo()):(t.preventDefault(),this.undo()),this.emit("keydown",this.value,t)):"keyup"==t.type&&this.emit("keyup",this.value,t)},Q=async function(e){const t=e;if(t.preventDefault(),!this.range)return;if(!this.allowCopy)return;const n=this.getElementsByRange().list;if(t.clipboardData&&n.length){const{text:e,html:s}=A.apply(this,[t.clipboardData,n]);this.emit("copy",e,s)}},Z=async function(e){const t=e;if(t.preventDefault(),!this.range)return;if(!this.allowCut)return;const n=this.getElementsByRange().list;if(t.clipboardData&&n.length){const{text:e,html:s}=A.apply(this,[t.clipboardData,n]);this.disabled||(this.delete(),this.domRender(),this.rangeRender()),this.emit("cut",e,s)}},Y=async function(e){const t=e;if(t.preventDefault(),!this.disabled&&this.range&&this.allowPaste&&t.clipboardData){const e=t.clipboardData.getData("text/html"),n=t.clipboardData.getData("text/plain"),s=t.clipboardData.files;await D.apply(this,[e,n,s]),this.domRender(),this.rangeRender()}},G=async function(e){if(e.preventDefault(),"drop"==e.type){if(this.disabled)return;if(!this.range)return;if(!this.allowPaste)return;const t=e;if(t.dataTransfer){const e=t.dataTransfer.getData("text/html"),n=t.dataTransfer.getData("text/plain"),s=t.dataTransfer.files;await D.apply(this,[e,n,s]),this.domRender(),this.rangeRender()}}},J=function(e){this.disabled||this.emit("focus",this.value,e)},ee=function(e){this.disabled||this.emit("blur",this.value,e)},te=(e,t,n)=>{let s=[];if(e.length&&t.length){let i=0,r=0,o=e.length-1,l=t.length-1;for(;i<=o&&r<=l;){if(t[r])if(t[l])if(e[i].key==t[r].key)s.push(...ne(e[i],t[r],n)),i++,r++;else if(e[o].key==t[l].key)s.push(...ne(e[o],t[l],n)),o--,l--;else if(e[i].key==t[l].key)s.push({type:"move",newElement:e[i],oldElement:t[l]},...ne(e[i],t[l],n)),i++,l--;else if(e[o].key==t[r].key)s.push({type:"move",newElement:e[o],oldElement:t[r]},...ne(e[o],t[r],n)),o--,r++;else{let r=t.findIndex((t=>t&&t.key===e[i].key));r>=0?(s.push({type:"move",newElement:e[i],oldElement:t[r]},...ne(e[i],t[r],n)),t[r]=void 0):s.push({type:"insert",newElement:e[i]}),i++}else l--;else r++;if(r>l)for(;i<=o;i++)s.push({type:"insert",newElement:e[i]});else if(i>o)for(;r<=l;r++)t[r]&&s.push({type:"remove",oldElement:t[r]})}}else e.length?s=e.map((e=>({type:"insert",newElement:e}))):t.length&&(s=t.map((e=>({type:"remove",oldElement:e}))));return s},ne=(e,t,n)=>{const s=[];return n||!e.isEmpty()&&!t.isEmpty()?n||e.type==t.type&&e.locked==t.locked?n&&e.namespace!=t.namespace?s.push({type:"replace",oldElement:t,newElement:e}):e.isText()||e.parsedom==t.parsedom?!n&&e.isInblock()&&e.behavior!=t.behavior||e.hasChildren()&&!t.hasChildren()||t.hasChildren()&&!e.hasChildren()?s.push({type:"replace",oldElement:t,newElement:e}):(e.isText()&&e.textContent!=t.textContent&&s.push({type:"update",oldElement:t,newElement:e,update:"textContent"}),e.isEqualStyles(t)||s.push({type:"update",oldElement:t,newElement:e,update:"styles"}),e.isEqualMarks(t)||s.push({type:"update",oldElement:t,newElement:e,update:"marks"}),e.hasChildren()&&t.hasChildren()&&s.push(...te(e.children,t.children,n))):s.push({type:"replace",oldElement:t,newElement:e}):s.push({type:"replace",oldElement:t,newElement:e}):s.push({type:"empty",oldElement:t,newElement:e}),s};class se{constructor(e,t){n(this,"$el"),n(this,"disabled"),n(this,"value"),n(this,"renderRules"),n(this,"allowCopy"),n(this,"allowPaste"),n(this,"allowCut"),n(this,"allowPasteHtml"),n(this,"customTextPaste"),n(this,"customHtmlPaste"),n(this,"customImagePaste"),n(this,"customVideoPaste"),n(this,"customFilePaste"),n(this,"customMerge"),n(this,"customParseNode"),n(this,"extraKeepTags"),n(this,"history",new T),n(this,"stack"),n(this,"range",null),n(this,"__guid",function(){let e=l.get(window,"data-alex-editor-guid")||0;return e++,l.set(window,"data-alex-editor-guid",e),e}()),n(this,"__events",{}),n(this,"__oldStack",[]),n(this,"__isInputChinese",!1),n(this,"__innerSelectionChange",!1),n(this,"__chineseInputTimer",null),n(this,"__domObserver",null),n(this,"__illegalDoms",[]),this.$el=function(e){if("string"==typeof e&&e&&(e=document.body.querySelector(e)),!r.isElement(e))throw new Error("You must specify a dom container to initialize the editor");if(l.get(e,"data-alex-editor-init"))throw new Error("The element node has been initialized to the editor");return l.set(e,"data-alex-editor-init",!0),e}(e);const s=function(e){const t={value:"",disabled:!1,allowCopy:!0,allowPaste:!0,allowCut:!0,allowPasteHtml:!1,extraKeepTags:[],renderRules:[],customTextPaste:null,customHtmlPaste:null,customImagePaste:null,customVideoPaste:null,customFilePaste:null,customMerge:null,customParseNode:null};return a.isObject(e)&&("string"==typeof e.value&&e.value&&(t.value=e.value),"boolean"==typeof e.disabled&&(t.disabled=e.disabled),"boolean"==typeof e.allowCopy&&(t.allowCopy=e.allowCopy),"boolean"==typeof e.allowPaste&&(t.allowPaste=e.allowPaste),"boolean"==typeof e.allowCut&&(t.allowCut=e.allowCut),"boolean"==typeof e.allowPasteHtml&&(t.allowPasteHtml=e.allowPasteHtml),Array.isArray(e.extraKeepTags)&&(t.extraKeepTags=e.extraKeepTags),Array.isArray(e.renderRules)&&(t.renderRules=e.renderRules),"function"==typeof e.customTextPaste&&(t.customTextPaste=e.customTextPaste),"function"==typeof e.customHtmlPaste&&(t.customHtmlPaste=e.customHtmlPaste),"function"==typeof e.customImagePaste&&(t.customImagePaste=e.customImagePaste),"function"==typeof e.customVideoPaste&&(t.customVideoPaste=e.customVideoPaste),"function"==typeof e.customFilePaste&&(t.customFilePaste=e.customFilePaste),"function"==typeof e.customMerge&&(t.customMerge=e.customMerge),"function"==typeof e.customParseNode&&(t.customParseNode=e.customParseNode)),t}(t);this.disabled=s.disabled,this.value=s.value,this.renderRules=s.renderRules,this.allowCopy=s.allowCopy,this.allowPaste=s.allowPaste,this.allowCut=s.allowCut,this.allowPasteHtml=s.allowPasteHtml,this.customTextPaste=s.customTextPaste,this.customHtmlPaste=s.customHtmlPaste,this.customImagePaste=s.customImagePaste,this.customVideoPaste=s.customVideoPaste,this.customFilePaste=s.customFilePaste,this.customMerge=s.customMerge,this.customParseNode=s.customParseNode,this.extraKeepTags=s.extraKeepTags,this.stack=this.parseHtml(this.value),M.apply(this),this.disabled?this.setDisabled():this.setEnabled(),L.apply(this),m.on(document,`selectionchange.alex_editor_${this.__guid}`,V.bind(this)),m.on(this.$el,"beforeinput.alex_editor",z.bind(this)),m.on(this.$el,"compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor",U.bind(this)),m.on(this.$el,"keydown.alex_editor keyup.alex_editor",X.bind(this)),m.on(this.$el,"cut.alex_editor",Z.bind(this)),m.on(this.$el,"paste.alex_editor",Y.bind(this)),m.on(this.$el,"copy.alex_editor",Q.bind(this)),m.on(this.$el,"dragstart.alex_editor drop.alex_editor",G.bind(this)),m.on(this.$el,"focus.alex_editor",J.bind(this)),m.on(this.$el,"blur.alex_editor",ee.bind(this))}initRange(){const e=E.flatElements(this.stack).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom)))[0],t=new w(e,0),n=new w(e,0);this.range=new b(t,n)}delete(){if(this.range){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.range.anchor.element.getBlock(),n=this.range.anchor.element.getInblock();if(n)if(0==this.range.anchor.offset)if(e){if(n.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();if("block"==n.behavior){const t=e.getBlock(),s=e.getInblock();s?this.merge(n,s):this.merge(n,t)}}else this.emit("deleteInStart",n);else{if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),n.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}else this.range.anchor.offset=0,this.range.focus.offset=0;return void this.delete()}if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const t=f(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,t)return void this.delete();if(n.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const t=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),n.isEmpty()&&(!t||!e)){const e=new E("closed","br",null,null,null);if(this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e),t)return void this.delete()}}}else if(0==this.range.anchor.offset)if(e){if(t.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();{const n=e.getInblock(),s=e.getBlock();n?this.merge(t,n):this.merge(t,s)}}else this.emit("deleteInStart",t);else{if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),t.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}else this.range.anchor.offset=0,this.range.focus.offset=0;return void this.delete()}if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const n=f(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,n)return void this.delete();if(t.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const n=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),t.isEmpty()&&(!n||!e)){const e=new E("closed","br",null,null,null);if(this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e),n)return void this.delete()}}}}else{const e=this.getElementsByRange().list.filter((e=>!E.VOID_NODES.includes(e.element.parsedom))),t=this.range.anchor.element.getInblock(),n=this.range.focus.element.getInblock(),s=this.range.anchor.element.getBlock(),i=this.range.focus.element.getBlock();t&&n&&t.isEqual(n)?e.forEach((e=>{if(e.offset?e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]):e.element.toEmpty(),t.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,t)}})):t&&n?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)$.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),"block"==n.behavior&&this.merge(n,t)):t?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)$.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),this.merge(i,t)):n?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)$.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),"block"==n.behavior&&this.merge(n,s)):s.isEqual(i)?e.forEach((e=>{if(e.offset?e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]):e.element.toEmpty(),s.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,s)}})):(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)$.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),this.merge(i,s))}this.range.anchor.element.isEmpty()&&H.apply(this,[this.range.anchor]),this.range.focus.element=this.range.anchor.element,this.range.focus.offset=this.range.anchor.offset,F.apply(this),this.emit("deleteComplete")}}insertText(e){if(this.range){if(!e||"string"!=typeof e)throw new Error("The argument must be a string");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isPreStyle()||(e=e.replace(/\s/g,(()=>{const e=document.createElement("span");return e.innerHTML="&nbsp;",e.innerText}))),this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset)+e.replace(/\r\n/g,"\n")+t.substring(this.range.anchor.offset),this.range.anchor.offset=this.range.anchor.offset+e.length,this.range.focus.offset=this.range.anchor.offset}else{const t=new E("text",null,null,null,e);0==this.range.anchor.offset?this.addElementBefore(t,this.range.anchor.element):this.addElementAfter(t,this.range.anchor.element),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}else this.delete(),this.insertText(e)}}insertParagraph(){if(this.range)if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.getNextElementOfPoint(this.range.anchor),n=this.range.anchor.element.getBlock(),s=this.range.anchor.element.getInblock(),i=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(s){if(this.range.anchor.element.isPreStyle()){this.insertText("\n");const e=E.getSpaceElement();this.insertElement(e),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this.emit("insertParagraph",s,s)}else if("block"==s.behavior)if(0!=this.range.anchor.offset||e&&s.isContains(e))if(this.range.anchor.offset!=i||t&&s.isContains(t)){const e=s.clone();this.addElementAfter(e,s);const t=E.flatElements(s.children).findIndex((e=>this.range.anchor.element.isEqual(e)));this.range.focus.moveToEnd(s),this.delete();const n=E.flatElements(e.children);this.range.focus.element=n[t],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,s),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,s),this.emit("insertParagraph",s,e)}}else if(this.range.anchor.element.isPreStyle()){this.insertText("\n");const e=E.getSpaceElement();this.insertElement(e),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this.emit("insertParagraph",n,n)}else if(0!=this.range.anchor.offset||e&&n.isContains(e))if(this.range.anchor.offset!=i||t&&n.isContains(t)){const e=n.clone();this.addElementAfter(e,n);const t=E.flatElements(n.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=this.range.anchor.offset;this.range.focus.moveToEnd(n),this.delete();const i=E.flatElements(e.children);this.range.focus.element=i[t],this.range.focus.offset=s,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,n),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,n),this.emit("insertParagraph",n,e)}}else this.delete(),this.insertParagraph()}insertElement(e,t=!0){if(this.range){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(!e.isEmpty())if(this.range.anchor.isEqual(this.range.focus)){const n=this.getPreviousElementOfPoint(this.range.anchor),s=this.getNextElementOfPoint(this.range.anchor),i=this.range.anchor.element.getBlock(),r=this.range.anchor.element.getInblock(),o=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(e.isInblock()&&"block"==e.behavior&&r&&"block"==r.behavior)if(r.isOnlyHasBreak()&&t)this.addElementBefore(e,r),r.toEmpty();else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=E.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,r);else this.addElementBefore(e,r);else if(e.isInblock()&&r)if(r.isOnlyHasBreak())this.addElementTo(e,r,0);else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=E.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.merge(t,r)}else this.addElementTo(e,r,r.children.length);else this.addElementTo(e,r,0);else if(e.isInblock())if(i.isOnlyHasBreak())this.addElementTo(e,i,0);else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=E.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.merge(t,i)}else this.addElementTo(e,i,i.children.length);else this.addElementTo(e,i,0);else if(e.isBlock())if(i.isOnlyHasBreak()&&t)this.addElementBefore(e,i),i.toEmpty();else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=E.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,i);else this.addElementBefore(e,i);else if(this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent,n=this.range.anchor.element.clone();this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset),n.textContent=t.substring(this.range.anchor.offset),this.addElementAfter(n,this.range.anchor.element),this.addElementBefore(e,n)}else 0==this.range.anchor.offset?this.addElementBefore(e,this.range.anchor.element):this.addElementAfter(e,this.range.anchor.element);this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else this.delete(),this.insertElement(e,t)}}domRender(e=!1){this.emit("beforeRender");const t=!this.__oldStack.length,n=[_,S,P,O,N,I,B,...this.renderRules.filter((e=>"function"==typeof e))];if(t||e){this.stack.forEach((e=>{n.forEach((t=>{j.apply(this,[e,t,this.stack])}))})),F.apply(this);const e=document.createDocumentFragment();this.stack.forEach((t=>{t.__render(),e.appendChild(t.elm)})),this.$el.innerHTML="",this.$el.appendChild(e)}else q.apply(this),te(this.stack,this.__oldStack,!1).forEach((e=>{let t=null;if(e.newElement)t=e.newElement.parent?e.newElement.parent:e.newElement;else if(e.oldElement&&e.oldElement.parent){const n=g(e.oldElement.parent.key,this.stack);t=n||null}t&&n.forEach((e=>{j.apply(this,[t,e,t.parent?t.parent.children:this.stack])}))})),F.apply(this),te(this.stack,this.__oldStack,!0).forEach((e=>{if("insert"==e.type){e.newElement.__render();const t=this.getPreviousElement(e.newElement),n=e.newElement.parent?e.newElement.parent.elm:this.$el;t?t.elm.nextElementSibling?n.insertBefore(e.newElement.elm,t.elm.nextElementSibling):n.appendChild(e.newElement.elm):n.firstElementChild?n.insertBefore(e.newElement.elm,n.firstElementChild):n.appendChild(e.newElement.elm)}else if("remove"==e.type)e.oldElement.elm.remove();else if("update"==e.type){if("textContent"==e.update)e.newElement.elm.textContent=e.newElement.textContent;else if("styles"==e.update){const{setStyles:t,removeStyles:n}=((e,t)=>{const n={},s={};return e.hasStyles()&&Object.keys(e.styles).forEach((s=>{t.hasStyles()&&t.styles.hasOwnProperty(s)&&t.styles[s]===e.styles[s]||(n[s]=e.styles[s])})),t.hasStyles()&&Object.keys(t.styles).forEach((n=>{e.hasStyles()&&e.styles.hasOwnProperty(n)||(s[n]=t.styles[n])})),{setStyles:n,removeStyles:s}})(e.newElement,e.oldElement);for(let s in n)e.newElement.elm.style.removeProperty(s);for(let s in t)e.newElement.elm.style.setProperty(s,t[s])}else if("marks"==e.update){const{setMarks:t,removeMarks:n}=((e,t)=>{const n={},s={};return e.hasMarks()&&Object.keys(e.marks).forEach((s=>{t.hasMarks()&&t.marks.hasOwnProperty(s)&&t.marks[s]===e.marks[s]||(n[s]=e.marks[s])})),t.hasMarks()&&Object.keys(t.marks).forEach((n=>{e.hasMarks()&&e.marks.hasOwnProperty(n)||(s[n]=t.marks[n])})),{setMarks:n,removeMarks:s}})(e.newElement,e.oldElement);for(let s in n)e.newElement.elm.removeAttribute(s);for(let s in t)/(^on)|(^style$)|(^face$)/g.test(s)||e.newElement.elm.setAttribute(s,t[s])}}else if("replace"==e.type){e.newElement.__render();(e.oldElement.parent?e.oldElement.parent.elm:this.$el).insertBefore(e.newElement.elm,e.oldElement.elm),e.oldElement.elm.remove()}else if("move"==e.type){const t=this.getPreviousElement(e.newElement),n=e.newElement.parent?e.newElement.parent.elm:this.$el;t?t.elm.nextElementSibling?n.insertBefore(e.newElement.elm,t.elm.nextElementSibling):n.appendChild(e.newElement.elm):n.firstElementChild?n.insertBefore(e.newElement.elm,n.firstElementChild):n.appendChild(e.newElement.elm)}}));const s=this.value;this.value=this.$el.innerHTML,this.__oldStack=this.stack.map((e=>e.__fullClone())),(t||s!=this.value)&&(t||this.emit("change",this.value,s),e||this.history.setState(this.stack,this.range)),this.emit("afterRender")}rangeRender(){return new Promise((e=>{if(this.disabled)return e();const t=window.getSelection();if(!t)return e();if(this.range){const e=e=>{let t=null,n=null;if(e.element.isText())t=e.element.elm.childNodes[0],n=e.offset;else{t=e.element.parent.elm;const s=e.element.parent.children.findIndex((t=>e.element.isEqual(t)));n=e.offset+s}return{node:t,offset:n}};this.__innerSelectionChange=!0;const n=e(this.range.anchor),s=e(this.range.focus),i=document.createRange();i.setStart(n.node,n.offset),i.setEnd(s.node,s.offset),t.removeAllRanges(),t.addRange(i)}else t.removeAllRanges();setTimeout((()=>{W.apply(this),this.__innerSelectionChange=!1,this.history.updateRange(this.range),this.emit("rangeUpdate",this.range),e()}),0)}))}parseHtml(e){e||(e="<p><br/></p>");const t=document.createElement("template");t.innerHTML=e;let n=[];return t.content.childNodes.forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);n.push(t)}})),n}parseNode(e){if(!(e instanceof Node))throw new Error("The argument must be an node");if(1!=e.nodeType&&3!=e.nodeType)throw new Error("The argument must be an element node or text node");if(3==e.nodeType)return new E("text",null,null,null,e.textContent);const t=function(e){let t={};const n=e.attributes.length;for(let s=0;s<n;s++){const n=e.attributes[s];/(^on)|(^style$)|(^face$)/g.test(n.nodeName)||(t[n.nodeName]=n.nodeValue)}return t}(e),n=function(e){let t={};const n=e.getAttribute("style");if(n){let e=0,s=0,i=[];for(;e<n.length;)";"==n[e]&&"base64,"!=n.substring(e+1,e+8)&&(i.push(n.substring(s,e)),s=e+1),e==n.length-1&&s<e&&i.push(n.substring(s,e)),e++;i.forEach((e=>{const n=e.indexOf(":"),s=e.substring(0,n).trim(),i=e.substring(n+1).trim();t[s]=i}))}return t}(e),s=e.nodeName.toLocaleLowerCase(),i=e.namespaceURI;if(E.EMPTY_NODES.includes(s))return new E("text",null,null,null,null);if(s==E.TEXT_NODE&&e.childNodes.length&&Array.from(e.childNodes).every((e=>3==e.nodeType)))return new E("text",null,t,n,e.textContent);const r=x.find((e=>e.parsedom==s)),o=C.find((e=>e.parsedom==s)),l=v.find((e=>e.parsedom==s)),h=k.find((e=>e.parsedom==s));let c=null,m={type:"inline",parsedom:s,marks:t,styles:n,behavior:"default",namespace:i};if(r)m.type="block",r.parse&&(m.parsedom=E.BLOCK_NODE);else if(o)m.type="inblock",o.block&&(m.behavior="block");else if(l){if(m.type="inline",l.parse&&(m.parsedom=E.TEXT_NODE,a.isObject(l.parse))){const t=l.parse;for(let n in t)"function"==typeof t[n]?m.styles[n]=t[n].apply(this,[e]):m.styles[n]=t[n]}}else h?m.type="closed":this.extraKeepTags.includes(m.parsedom)||(m.type="inline",m.parsedom=E.TEXT_NODE,m.namespace=null);return c=new E(m.type,m.parsedom,m.marks,m.styles,null),c.behavior=m.behavior,c.namespace=m.namespace,h||Array.from(e.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);t.parent=c,c.hasChildren()?c.children.push(t):c.children=[t]}})),"function"==typeof this.customParseNode&&(c=this.customParseNode.apply(this,[c])),c}merge(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(!e.isBlock()&&!e.isInblock()||!t.isBlock()&&!t.isInblock())throw new Error('Elements that are not "block" or "inblock" cannot be merged');"function"==typeof this.customMerge?this.customMerge.apply(this,[e,t]):(t.children.push(...e.children),t.children.forEach((e=>{e.parent=t})),e.children=null)}getElementByKey(e){if(!e)throw new Error("You need to specify a key to do the query");return g(e,this.stack)}getPreviousElement(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t<=0?null:this.stack[t-1].isEmpty()?this.getPreviousElement(this.stack[t-1]):this.stack[t-1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t<=0?null:e.parent.children[t-1].isEmpty()?this.getPreviousElement(e.parent.children[t-1]):e.parent.children[t-1]}}getNextElement(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t>=this.stack.length-1?null:this.stack[t+1].isEmpty()?this.getNextElement(this.stack[t+1]):this.stack[t+1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t>=e.parent.children.length-1?null:e.parent.children[t+1].isEmpty()?this.getNextElement(e.parent.children[t+1]):e.parent.children[t+1]}}getPreviousElementOfPoint(e){if(!w.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=e=>{let n=null;for(let s=e.length-1;s>=0;s--){const i=e[s];if(!i.isEmpty()&&(i.isText()||!E.VOID_NODES.includes(i.parsedom))){if(i.isText()||i.isClosed()){n=i;break}if(n=t(i.children),n)break}}return n},n=e=>{const s=this.getPreviousElement(e);return s?s.isEmpty()||!s.isText()&&E.VOID_NODES.includes(s.parsedom)?n(s):s.isText()||s.isClosed()?s:t(s.children):e.parent?n(e.parent):null};return n(e.element)}getNextElementOfPoint(e){if(!w.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=e=>{let n=null;const s=e.length;for(let i=0;i<s;i++){const s=e[i];if(!s.isEmpty()&&(s.isText()||!E.VOID_NODES.includes(s.parsedom))){if(s.isText()||s.isClosed()){n=s;break}if(n=t(s.children),n)break}}return n},n=e=>{const s=this.getNextElement(e);return s?s.isEmpty()||!s.isText()&&E.VOID_NODES.includes(s.parsedom)?n(s):s.isText()||s.isClosed()?s:t(s.children):e.parent?n(e.parent):null};return n(e.element)}getElementsByRange(){if(!this.range)return{list:[],flatList:[]};if(this.range.anchor.isEqual(this.range.focus))return{list:[],flatList:[]};if(this.range.anchor.element.isEqual(this.range.focus.element)){const e=0==this.range.anchor.offset,t=this.range.focus.offset==(this.range.focus.element.isText()?this.range.focus.element.textContent.length:1),n={element:this.range.anchor.element,offset:(!e||!t)&&[this.range.anchor.offset,this.range.focus.offset]};return{list:[n],flatList:[n]}}const e=(()=>{let e=[];const t=0==this.range.anchor.offset,n=this.range.focus.offset==(this.range.focus.element.isText()?this.range.focus.element.textContent.length:1),s=this.range.anchor.element.getBlock(),i=this.range.focus.element.getBlock(),r=this.stack.findIndex((e=>s.isEqual(e))),o=this.stack.findIndex((e=>i.isEqual(e)));let l=E.flatElements(this.stack.slice(r,o+1));const a=function(e){let t=e.element;for(;t.parent&&e.element.isFirst(t.parent);)t=t.parent;return t}(this.range.anchor),h=l.findIndex((e=>e.isEqual(a||this.range.anchor.element))),c=l.findIndex((e=>e.isEqual(this.range.focus.element)));(h>0||c<l.length-1)&&(l=l.slice(h,c+1));const m=l.length;for(let d=0;d<m;d++)if(this.range.anchor.element.isEqual(l[d]))t?e.push({element:this.range.anchor.element,offset:!1}):this.range.anchor.element.isText()&&this.range.anchor.offset<this.range.anchor.element.textContent.length&&e.push({element:this.range.anchor.element,offset:[this.range.anchor.offset,this.range.anchor.element.textContent.length]});else if(l[d].isContains(this.range.anchor.element)){const s=this.range.anchor.element.isFirst(l[d]),i=l[d].isContains(this.range.focus.element),r=this.range.focus.element.isLast(l[d]);(t&&s&&i&&r&&n||t&&s&&!i)&&e.push({element:l[d],offset:!1})}else if(this.range.focus.element.isEqual(l[d]))n?e.push({element:this.range.focus.element,offset:!1}):this.range.focus.offset>0&&e.push({element:this.range.focus.element,offset:[0,this.range.focus.offset]});else if(l[d].isContains(this.range.focus.element)){this.range.focus.element.isLast(l[d])&&n&&e.push({element:l[d],offset:!1})}else e.push({element:l[d],offset:!1});return e})();return{list:(e=>{let t=[],n=[],s=[];const i=e.length;for(let r=0;r<i;r++)if(e[r].element.isBlock())t.push(e[r]),n.push(e[r].element);else{const i=e[r].element.getBlock();let o=!1;for(let e=n.length-1;e>=0;e--)if(n[e].isEqual(i)){o=!0;break}if(!o){s.some((t=>t.isContains(e[r].element)))||(t.push(e[r]),(e[r].element.isInblock()||e[r].element.isInline())&&s.push(e[r].element))}}return t})(e),flatList:e}}addElementTo(e,t,n=0){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if("number"!=typeof n||isNaN(n)||n<0)throw new Error("The third argument must be an integer not less than 0");t.hasChildren()?n>=t.children.length?t.children.push(e):t.children.splice(n,0,e):t.children=[e],e.parent=t}addElementBefore(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));this.stack.splice(n,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n)}}addElementAfter(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));n>=this.stack.length-1?this.stack.push(e):this.stack.splice(n+1,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n+1)}}collapseToStart(e){let t=!1;if(this.range||(this.initRange(),t=!0),E.isElement(e))this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e);else{const e=E.flatElements(this.stack).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom)));if(0==e.length)throw new Error("There is no element to set the focus");this.range.anchor.moveToStart(e[0]),this.range.focus.moveToStart(e[0])}t&&this.history.updateRange(this.range)}collapseToEnd(e){let t=!1;if(this.range||(this.initRange(),t=!0),E.isElement(e))this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e);else{const e=E.flatElements(this.stack).filter((e=>!e.isEmpty()&&!E.VOID_NODES.includes(e.parsedom))),t=e.length;if(0==t)throw new Error("There is no element to set the focus");this.range.anchor.moveToEnd(e[t-1]),this.range.focus.moveToEnd(e[t-1])}t&&this.history.updateRange(this.range)}setDisabled(){this.disabled=!0,this.$el.removeAttribute("contenteditable")}setEnabled(){this.disabled=!1,this.$el.setAttribute("contenteditable","true")}undo(){const e=this.history.undo();e&&(this.stack=e.stack,this.range=e.range,this.domRender(!0),this.rangeRender())}redo(){const e=this.history.redo();e&&(this.stack=e.stack,this.range=e.range,this.domRender(!0),this.rangeRender())}emit(e,...t){return!!Array.isArray(this.__events[e])&&(this.__events[e].forEach((e=>{e.apply(this,[...t])})),!0)}on(e,t){this.__events[e]||(this.__events[e]=[]),this.__events[e].push(t)}off(e,t){if(this.__events[e])if(t){const n=this.__events[e].findIndex((e=>e===t));n>-1&&this.__events[e].splice(n,1)}else this.__events[e]=[]}destroy(){R.apply(this),this.setDisabled(),m.off(document,`selectionchange.alex_editor_${this.__guid}`),m.off(this.$el,"beforeinput.alex_editor compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor keydown.alex_editor cut.alex_editor paste.alex_editor copy.alex_editor dragstart.alex_editor drop.alex_editor focus.alex_editor blur.alex_editor")}}const ie="1.4.40";console.log(`%c alex-editor %c v${ie} `,"padding: 2px 1px; border-radius: 3px 0 0 3px; color: #fff; background: #606060; font-weight: bold;","padding: 2px 1px; border-radius: 0 3px 3px 0; color: #fff; background: #42c02e; font-weight: bold;"),e.AlexEditor=se,e.AlexElement=E,e.AlexHistory=T,e.AlexPoint=w,e.AlexRange=b,e.default=se,e.version=ie,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
